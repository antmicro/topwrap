"use strict";(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[637],{1954:(e,n,t)=>{t.d(n,{A:()=>p});var o=t(20641),i=t(90033),a=t(53751);const s=["src"],r=["innerHTML"];var l=t(63491),c=t(42838),u=t.n(c);const d=(0,o.pM)({props:{title:{type:String,required:!0},iconPath:{type:String,required:!1},depth:{type:Number,required:!0},isCategory:{type:Boolean,required:!1},isDragged:{type:Boolean,required:!1},hitSubstring:{type:String,required:!1},mask:{required:!1}},setup(e){const{viewModel:n}=(0,l.if)(),t=e=>n.value.cache[`./${e}`]??e,i=(0,o.EW)((()=>t(e.iconPath))),a=(0,o.EW)((()=>`padding-left: ${10+20*e.depth}px`)),s=(0,o.EW)((()=>u().sanitize(e.hitSubstring??e.title)));return{nodeIcon:i,padding:a,getIconPath:t,titleSanitized:s}}}),p=(0,t(66262).A)(d,[["render",function(e,n,t,l,c,u){return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:(0,i.C4)(["__entry __node-entry",{__category:e.isCategory,__dragged:e.isDragged}]),style:(0,i.Tr)(e.padding)},[void 0!==e.nodeIcon?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.nodeIcon,draggable:"false"},null,8,s)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.titleSanitized},null,8,r)],6)),[[a.aG,void 0===e.mask||e.mask]])}],["__scopeId","data-v-6fa34012"]])},5419:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(20641),i=t(90033),a=t(50953);const s=(0,o.pM)({setup(){const e=(0,a.KR)(!1),n=(0,a.KR)({x:0,y:0}),t=(0,a.KR)({x:0,y:0}),i=(0,o.EW)((()=>({xBegin:n?.value.x<t?.value.x?n?.value.x:t?.value.x,yBegin:n?.value.y<t?.value.y?n?.value.y:t?.value.y,xEnd:n?.value.x>=t?.value.x?n?.value.x:t?.value.x,yEnd:n?.value.y>=t?.value.y?n?.value.y:t?.value.y})));return{styles:(0,o.EW)((()=>({position:"absolute",visibility:e.value?"visible":"hidden",top:`${i.value.yBegin}px`,left:`${i.value.xBegin}px`,width:`${Math.abs(i.value.xEnd-i.value.xBegin)??0}px`,height:`${Math.abs(i.value.yEnd-i.value.yBegin)??0}px`}))),onPointerDown:o=>{e.value=!0,n.value={x:o.pageX,y:o.pageY},t.value={x:o.pageX,y:o.pageY}},onPointerMove:n=>{e.value&&(t.value={x:n.pageX,y:n.pageY})},onPointerUp:()=>{e.value=!1,n.value={x:0,y:0},t.value={x:0,y:0}},selecting:e,boundingRect:i}}}),r=(0,t(66262).A)(s,[["render",function(e,n,t,a,s,r){return(0,o.uX)(),(0,o.CE)("div",{class:"rectangle-selection-border",style:(0,i.Tr)(e.styles)},n[0]||(n[0]=[(0,o.Lk)("div",{class:"rectangle-selection"},null,-1)]),4)}]])},35334:(e,n,t)=>{t.d(n,{A:()=>r});var o=t(20641),i=t(63491),a=t(49690);const s={extends:i.XF.TemporaryConnection,components:{ConnectionView:a.A},setup(e){const{d:n,status:t}=i.XF.TemporaryConnection.setup(e),a=(0,o.EW)((()=>{let{input:t,output:o}=n.value;return e.connection.from.isInput&&([t,o]=[o,t]),{input:t,output:o}}));return{d:n,swappedD:a,status:t}}},r=(0,t(66262).A)(s,[["render",function(e,n,t,i,a,s){const r=(0,o.g2)("ConnectionView");return(0,o.uX)(),(0,o.Wv)(r,{x1:i.swappedD.input[0],y1:i.swappedD.input[1],x2:i.swappedD.output[0],y2:i.swappedD.output[1],state:i.status,connection:e.connection,"is-temporary":""},null,8,["x1","y1","x2","y2","state","connection"])}]])},49690:(e,n,t)=>{t.d(n,{A:()=>b});var o=t(20641),i=t(53751),a=t(90033);const s={key:0},r=["d"],l=["onPointerdown"],c=["d"],u=["d"],d=["d"],p=["d"];var g=t(50953),v=t(63491),y=t(41426),h=t(60524),f=t(34580);const m=(0,o.pM)({extends:v.XF.Connection,props:{isHighlighted:{default:!1},connection:{required:!0},hover:{default:!1}},components:{Anchor:h.A},setup(e){const{classes:n}=v.XF.Connection.setup(e),{graph:t}=(0,v.uU)(),{viewModel:i}=(0,v.if)(),{interfaceTypes:a}=i.value,s=f.Ay.getEditorManagerInstance(),r=(0,g.lW)(e,"hover"),l=a.getConnectionStyle(e.connection.from,e.connection.to),c=(0,o.EW)((()=>({...n.value,"--hover":e.isHighlighted||r.value,"--dashed":"dashed"===l.interfaceConnectionPattern,"--dotted":"dotted"===l.interfaceConnectionPattern}))),u=(0,o.EW)((()=>({"--color":l.interfaceConnectionColor}))),d=(0,y.A)(700,(n=>{i.value.editor.readonly||(n.preventDefault(),t.value.removeConnection(e.connection))})),p=(e,n)=>[(e+t.value.panning.x)*t.value.scaling,(n+t.value.panning.y)*t.value.scaling],h=(0,o.EW)((()=>{const[n,t]=p(e.x1,e.y1),[o,a]=p(e.x2,e.y2);return i.value.connectionRenderer.render(n,t,o,a,e.connection)}));return{cssClasses:c,parsedNewD:(0,o.EW)((()=>{const e=h.value;if(Array.isArray(e)&&e.length){const n=[];for(let t=0;t<e.length-1;t+=1)n.push(`M ${e[t].x} ${e[t].y} L ${e[t+1].x} ${e[t+1].y}`);return n}return e})),onMouseDown:d,onMouseCtrlDown:(n,o)=>{if(i.value.editor.readonly||!i.value.connectionRenderer.supportsAnchors())return;n.preventDefault();const a={x:n.offsetX/t.value.scaling-t.value.panning.x,y:n.offsetY/t.value.scaling-t.value.panning.y,id:Date.now()};t.value.addAnchor(a,e.connection,Math.trunc((o-1)/3))},style:u,hasAnchors:(0,o.EW)((()=>void 0!==e.connection.anchors&&e.connection.anchors.length&&i.value.connectionRenderer.supportsAnchors())),removeAnchor:n=>{i.value.editor.readonly||(t.value.events.removeAnchor.emit([e.connection,n]),e.connection.anchors.splice(n,1))},editorManager:s}}}),b=(0,t(66262).A)(m,[["render",function(e,n,t,g,v,y){const h=(0,o.g2)("Anchor");return e.hasAnchors?((0,o.uX)(),(0,o.CE)("g",s,[(0,o.Lk)("path",{d:e.parsedNewD,class:"connection-wrapper baklava-connection"},null,8,r),e.hasAnchors?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.parsedNewD,((t,s)=>((0,o.uX)(),(0,o.CE)("g",{onPointerdown:[n[0]||(n[0]=(0,i.D$)(((...n)=>e.onMouseDown&&e.onMouseDown(...n)),["left","exact"])),n[1]||(n[1]=n=>{"touch"===n.pointerType&&e.onMouseDown(n)}),(0,i.D$)((n=>e.onMouseCtrlDown(n,s)),["left","ctrl","exact"])]},[(0,o.Lk)("path",{d:t,class:"connection-wrapper baklava-connection"},null,8,c),(0,o.Lk)("path",{d:t,class:(0,a.C4)(["baklava-connection",e.cssClasses]),style:(0,a.Tr)(e.style)},null,14,u)],40,l)))),256)),e.hover||!e.editorManager.baklavaView.settings.hideAnchors?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.connection.anchors,((n,t)=>((0,o.uX)(),(0,o.Wv)(h,{key:n.id,position:n,rightclickCallback:()=>e.removeAnchor(t)},null,8,["position","rightclickCallback"])))),128)):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("g",{key:1,onPointerdown:[n[2]||(n[2]=(0,i.D$)(((...n)=>e.onMouseDown&&e.onMouseDown(...n)),["left","exact"])),n[3]||(n[3]=n=>{"touch"===n.pointerType&&e.onMouseDown(n)}),n[4]||(n[4]=(0,i.D$)((n=>e.onMouseCtrlDown(n,0)),["left","ctrl","exact"]))]},[(0,o.Lk)("path",{d:e.parsedNewD,class:"connection-wrapper baklava-connection"},null,8,d),(0,o.Lk)("path",{d:e.parsedNewD,class:(0,a.C4)(["baklava-connection",e.cssClasses]),style:(0,a.Tr)(e.style)},null,14,p)],32))}]])},57759:(e,n,t)=>{t.d(n,{L:()=>s,i:()=>a});const o={},i=(e,n)=>({beforeMount:(t,i)=>{const a={timeout:null,newEvent:null,longPress:!1,moveEvents:0};o[t]={pointerdown:n=>{"touch"===n.pointerType&&null===a.timeout&&(a.moveEvents=0,a.longPress=!1,e(t,i,n,a),a.timeout=setTimeout((()=>{a.longPress=!0}),i.arg??500))},pointermove:()=>{a.moveEvents+=1},pointerup:e=>{"touch"===e.pointerType&&(a.longPress&&a.moveEvents<10&&n(t,i,e,a),a.timeout&&(clearTimeout(a.timeout),a.timeout=null))}},t.addEventListener("pointerdown",o[t].pointerdown),t.addEventListener("pointermove",o[t].pointermove),t.addEventListener("pointerup",o[t].pointerup)},unmounted:e=>{e.removeEventListener("pointerdown",o[e].pointerdown),e.removeEventListener("pointermove",o[e].pointermove),e.removeEventListener("pointerup",o[e].pointerup)}}),a=i(((e,n,t,o)=>{o.newEvent=t}),((e,n,t,o)=>{setTimeout((()=>n.value(o.newEvent)),50)})),s=i(((e,n,t,o)=>{o.newEvent=new PointerEvent("pointerdown",{button:2,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,pointerType:"mouse",relatedTarget:t.relatedTarget})}),((e,n,t,o)=>{setTimeout((()=>{e.dispatchEvent(o.newEvent)}),50)}))},62789:(e,n,t)=>{t.d(n,{A:()=>u});var o=t(20641),i=t(50953),a=t(63491),s=t(49690);function r(e){const n=document.getElementById(e.id),t=n?.getElementsByClassName("__port");return{node:n?.closest(".baklava-node")??null,interface:n,port:t&&t.length>0?t[0]:null}}var l=t(274);const c=(0,o.pM)({extends:a.XF.ConnectionWrapper,props:{connection:{required:!0},isHighlighted:{default:!1}},components:{ConnectionView:s.A},setup(e){const n=(0,i.KR)(null),{graph:t}=(0,a.uU)();let s;const c=(0,i.KR)({x1:0,y1:0,x2:0,y2:0}),u=(0,o.EW)((()=>e.connection.isInDanger?l.J.FORBIDDEN:l.J.NONE)),d=(0,i.KR)(!1),p=(0,o.EW)((()=>t.value.findNodeById(e.connection.from.nodeId)?.position)),g=(0,o.EW)((()=>t.value.findNodeById(e.connection.to.nodeId)?.position)),v=(0,o.EW)((()=>t.value.findNodeById(e.connection.from.nodeId))),y=(0,o.EW)((()=>t.value.findNodeById(e.connection.to.nodeId))),h=(0,o.EW)((()=>[...Object.values(v.value?.inputs??{}),...Object.values(v.value?.outputs??{})].map((e=>[e.side,e.sidePosition])))),f=(0,o.EW)((()=>[...Object.values(y.value?.inputs??{}),...Object.values(y.value?.outputs??{})].map((e=>[e.side,e.sidePosition])))),m=e=>e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0],b=()=>{const n=r(e.connection.from),t=r(e.connection.to);n.node&&t.node&&(s||(s=new ResizeObserver((()=>{b()})),s.observe(n.node),s.observe(t.node)));const[o,i]=m(n),[a,l]=m(t);c.value={x1:o,y1:i,x2:a,y2:l}};return(0,o.wB)([h,f],(async()=>{await(0,o.dY)(),b()})),(0,o.wB)([p,g],(async()=>{await(0,o.dY)(),b()}),{deep:!0}),(0,o.sV)((async()=>{await(0,o.dY)(),b()})),(0,o.xo)((()=>{s&&s.disconnect()})),{d:c,state:u,containsPoint:e=>e.includes(n.value.$el.firstChild),conn:n,hover:d}}}),u=(0,t(66262).A)(c,[["render",function(e,n,t,i,a,s){const r=(0,o.g2)("ConnectionView");return(0,o.uX)(),(0,o.Wv)(r,{ref:"conn",x1:e.d.x1,y1:e.d.y1,x2:e.d.x2,y2:e.d.y2,state:e.state,connection:e.connection,isHighlighted:e.isHighlighted,hover:e.hover,onMouseover:n[0]||(n[0]=n=>e.hover=!0),onMouseleave:n[1]||(n[1]=n=>e.hover=!1)},null,8,["x1","y1","x2","y2","state","connection","isHighlighted","hover"])}]])},67185:(e,n,t)=>{t.d(n,{A:()=>Z});var o=t(20641),i=t(53751),a=t(90033);const s={class:"nodes entries"};var r=t(50953),l=t(63491),c=t(97786);const u={key:0},d=["onPointerdown"],p=["src"],g=["innerHTML"],v=["onClick"],y={class:"__icondiv"},h=["onClick"],f=["onClick","onPointerdown"],m=["src"],b=["innerHTML"],C=["onClick"],E={class:"__icondiv"},w=["innerHTML"],k=["onPointerdown"],x=["src"],M=["innerHTML"],T=["onClick"],_={class:"__icondiv"},P={key:1,class:"__title"};var N=t(42838),D=t.n(N),L=t(22007),S=t(42573),X=t(53701),A=t(13700),W=t(34580),I=t(1691),O=t(33007),R=t(15531),j=t.n(R);const B=e=>{const n={},t={};return e.forEach((e=>{const[n,...o]=e.split(/(?<!\\)\//),i=n.trim();Object.keys(t).includes(i)||(t[i]=[]),o.length>0&&t[i].push(o.join("/"))})),Object.entries(t).forEach((([e,t])=>{n[e]=B(new Set(t))})),n},$=e=>{const[n,t]=e;t.hitSubstring=n,void 0!==t.categoryNode&&(t.categoryNode.hitSubstring=t.categoryNode.title),void 0!==t.nodes.nodeTypes&&Object.entries(t.nodes.nodeTypes).forEach((([,e])=>{e.hitSubstring=e.title})),Object.entries(t.subcategories).forEach((e=>$(e)))},H=e=>{e.mask=!0,void 0!==e.categoryNode&&(e.categoryNode.mask=!0),void 0!==e.nodes.nodeTypes&&Object.values(e.nodes.nodeTypes).forEach((e=>{e.mask=!0})),Object.values(e.subcategories).forEach((e=>H(e)))},K=(e,n,t="")=>{const o={};return Object.entries(e).forEach((([e,i])=>{var a;let s="";s=""===t?e:`${t}/${e}`;const r=null!==(a=n.find((e=>e.categoryName===s)))&&void 0!==a?a:{};if(0!==Object.keys(r).length){const t=[];Object.entries(r.nodeTypes).forEach((([e,n])=>{n.isCategory&&t.push(e)}));const a=Object.keys(r.nodeTypes),l={categoryName:r.categoryName,nodeTypes:{}};let c;a.forEach((e=>{t.includes(e)?c=r.nodeTypes[e]:l.nodeTypes[e]=r.nodeTypes[e]})),o[e]={subcategories:K(i,n,s),nodes:l,categoryNode:c,hitSubstring:e,mask:!0}}else o[e]={subcategories:K(i,n,s),nodes:{},categoryNode:void 0,hitSubstring:e,mask:!0}})),o},F=(e,n,t)=>Object.entries(e).map((([e,o])=>{var i;let a=!1;const s=j().single(n,e);null!==s&&s.score>-50?(o.hitSubstring=null!==(i=j().highlight(s,"<span>","</span>"))&&void 0!==i?i:"",a=!0):o.hitSubstring=e;let r=!1;return void 0!==o.nodes.nodeTypes&&0!==Object.keys(o.nodes.nodeTypes).length&&(r=Object.values(o.nodes.nodeTypes).map((e=>{var o;const i=j().single(n,e.title);return e.mask=null!==i&&i.score>-50||a||t,e.hitSubstring=null!==i?null!==(o=j().highlight(i,"<span>","</span>"))&&void 0!==o?o:"":e.title,e.mask})).includes(!0)),o.mask=F(o.subcategories,n,a||t)||a||r||t,o.mask})).includes(!0);let V;const q=[W.Wx,W.dH],Y=(0,o.pM)({components:{Arrow:L.A,LinkMenu:X.A,VerticalEllipsis:S.A,Cross:I.A,CustomContextMenu:A.A},props:{nodeTree:{required:!0},onDragStart:{required:!0},depth:{type:Number,default:0},defaultCollapse:{type:Boolean,default:!0},tooltip:{required:!1},nodeSearch:{type:String,required:!0}},data:()=>({DOMPurify:D()}),setup(e){const{viewModel:n}=(0,l.if)(),t=e=>0!==Object.keys(e.nodes.nodeTypes??{}).length||0!==Object.keys(e.subcategories).length,i=(0,r.KR)(Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!e.defaultCollapse));let a=i.value;(0,o.wB)((()=>e.nodeTree),(()=>{i.value=Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!e.defaultCollapse)})),(0,o.wB)((()=>e.nodeSearch),((n,t)=>{""!==n&&""===t?(a=i.value,i.value=Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!0)):""===n&&""!==t&&(i.value=a)}));const s=e=>q.includes(e),c=(0,o.WQ)("menu"),u=W.Ay.getEditorManagerInstance(),d=(0,o.EW)((()=>u.specificationLoaded.value)),p=(0,r.Kh)({}),g=(0,r.KR)(!1),v=(0,r.KR)(0),y=(0,r.KR)(0),h=(0,r.KR)(""),f=(0,r.Kh)({isHovered:!1,hoveredItemValue:void 0}),m=(0,o.EW)((()=>{const e=()=>!u.editor.additionalNodeTypes.has(h.value),n=[];return n.push({value:"delete",label:"Delete",icon:O.A,disabled:e(),onPointerEmit:e(),tooltipMsg:e()&&"Node type can't be deleted"}),n}));return{padding:(e,n=!1)=>n?"padding-left: 0":`padding-left: ${10+30*e}px`,mask:i,onMouseDown:e=>{i.value.splice(e,1,!i.value[e])},getRotation:e=>i.value[e]?"left":"right",sortedEntries:(e,n=!1)=>Object.entries(e).sort((([e,o],[i,a])=>{if(e===W.Wx)return-1;if(i===W.Wx)return 1;if(!s(e)&&s(i))return 1;if(s(e)&&!s(i))return-1;if(n){if(t(o)&&!t(a))return 1;if(!t(o)&&t(a))return-1}return e.toLowerCase().localeCompare(i.toLowerCase())})),prettyTitle:e=>e.replace("\\/","/"),getIconPath:e=>n.value.cache[`./${e}`]??e,isCategoryNode:e=>void 0!==e?.categoryNode,notEmptyCategory:t,showMenu:c,showMenuClick:e=>{c.value=c.value.hitSubstring!==e.hitSubstring&&e},closeMenu:()=>{c.value&&(c.value=!1)},specificationLoaded:d,nodeEntryClasses:e=>({__entry:!0,"__node-entry":!0,"__top-level-node-entry":s(e)}),isTopLevelNode:s,openContextMenu:e=>{if(!1===g.value&&!s(e)&&u.baklavaView.settings.editableNodeTypes){h.value=e,g.value=!0;const n=p[e],t=document.createRange();t.selectNodeContents(n);const o=t.getBoundingClientRect();v.value=o.right+20,y.value=o.top-5.15*o.height}},showContextMenu:g,contextMenuX:v,contextMenuY:y,contextMenuItems:m,onContextMenuClick:()=>{u.removeNodeType(h.value)},onPointerOver:e=>{f.hoveredItemValue=e,f.isHovered=!0},onPointerLeave:e=>{f.hoveredItemValue===e&&(f.hoveredItemValue=void 0,f.isHovered=!1)},labelRefs:p}}});var Q=t(66262);const U=(0,Q.A)(Y,[["render",function(e,n,t,s,r,l){const c=(0,o.g2)("Cross"),N=(0,o.g2)("VerticalEllipsis"),D=(0,o.g2)("LinkMenu"),L=(0,o.g2)("CustomContextMenu"),S=(0,o.g2)("Arrow"),X=(0,o.g2)("PaletteCategory",!0),A=(0,o.gN)("click-outside");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bo)((0,o.Lk)("div",null,[e.nodeTree.nodes.nodeTypes?((0,o.uX)(),(0,o.CE)("div",u,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sortedEntries(e.nodeTree.nodes.nodeTypes),(([t,s])=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{style:(0,a.Tr)([{width:"100%"},e.padding(e.depth)]),class:(0,a.C4)(e.nodeEntryClasses(t)),key:t},[(0,o.Lk)("div",{onPointerdown:[(0,i.D$)((n=>e.onDragStart(t,s,s.iconPath)),["left"]),(0,i.D$)((n=>e.openContextMenu(t)),["right"])],class:(0,a.C4)(e.nodeEntryClasses(t))},[e.isTopLevelNode(t)?((0,o.uX)(),(0,o.Wv)(c,{key:1,color:"white",rotate:45,class:"__title-icon"})):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[void 0!==s.iconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.iconPath),draggable:"false"},null,8,p)):(0,o.Q3)("",!0)],64)),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.DOMPurify.sanitize(e.prettyTitle(s.hitSubstring)),ref_for:!0,ref:n=>e.labelRefs[t]=n},null,8,g)],42,d),0!==s.URLs.length?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:n[0]||(n[0]=(0,i.D$)((()=>{}),["stop"])),onClick:(0,i.D$)((()=>e.showMenuClick(s)),["stop"])},[(0,o.bF)(N,{class:"smaller_svg"})],40,v)):(0,o.Q3)("",!0),(0,o.Lk)("div",y,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(D,{key:0,node:e.showMenu,style:{width:"18em"}},null,8,["node"])),[[A,e.closeMenu]]):(0,o.Q3)("",!0)])],6)),[[i.aG,s.mask]]))),128))])):(0,o.Q3)("",!0)],512),[[i.aG,e.nodeTree.mask]]),e.showContextMenu?((0,o.uX)(),(0,o.Wv)(L,{key:0,modelValue:e.showContextMenu,"onUpdate:modelValue":n[1]||(n[1]=n=>e.showContextMenu=n),x:e.contextMenuX,y:e.contextMenuY,items:e.contextMenuItems,style:(0,a.Tr)(e.contextMenuStyle),onClick:e.onContextMenuClick,onPointerover:e.onPointerOver,onPointerleave:e.onPointerLeave},null,8,["modelValue","x","y","items","style","onClick","onPointerover","onPointerleave"])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.sortedEntries(e.nodeTree.subcategories,!0),(([t,s],r)=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{key:t},[e.notEmptyCategory(s)?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",{class:"__entry __category",onClick:n=>e.onMouseDown(r),style:(0,a.Tr)(e.padding(e.depth))},[(0,o.bF)(S,{rotate:e.getRotation(r),scale:"small"},null,8,["rotate"]),e.isCategoryNode(s)?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:"__entry __node-entry",key:s.title,onClick:n=>e.onMouseDown(r),onPointerdown:[(0,i.D$)((n=>e.onDragStart(s.title,s.categoryNode,s.iconPath)),["left"]),(0,i.D$)((n=>e.openContextMenu(t)),["right"])]},[void 0!==s.categoryNode.iconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.categoryNode.iconPath),draggable:"false"},null,8,m)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.DOMPurify.sanitize(e.prettyTitle(s.hitSubstring)),ref_for:!0,ref:n=>e.labelRefs[t]=n},null,8,b),0!==s.categoryNode.URLs.length?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:n[2]||(n[2]=(0,i.D$)((()=>{}),["stop"])),onClick:(0,i.D$)((()=>e.showMenuClick(s)),["stop"])},[(0,o.bF)(N,{class:"smaller_svg"})],40,C)):(0,o.Q3)("",!0)],40,f)),[[i.aG,s.mask]]),(0,o.Lk)("div",E,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(D,{key:0,node:e.showMenu.categoryNode,style:{width:"18em"}},null,8,["node"])),[[A,e.closeMenu]]):(0,o.Q3)("",!0)])],64)):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__title",innerHTML:e.DOMPurify.sanitize(e.prettyTitle(s.hitSubstring))},null,8,w))],12,h),(0,o.bo)((0,o.Lk)("div",null,[(0,o.bF)(X,{nodeTree:s,onDragStart:e.onDragStart,depth:e.depth+1,defaultCollapse:e.defaultCollapse,tooltip:e.tooltip,nodeSearch:e.nodeSearch},null,8,["nodeTree","onDragStart","depth","defaultCollapse","tooltip","nodeSearch"])],512),[[i.aG,e.mask[r]]])],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[e.isCategoryNode(s)?(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:(0,a.C4)(e.nodeEntryClasses(s.title)),style:(0,a.Tr)(e.padding(e.depth)),key:s.title,onPointerdown:n=>e.onDragStart(s.title,s.categoryNode,s.iconPath)},[void 0!==s.categoryNode.iconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.categoryNode.iconPath),draggable:"false"},null,8,x)):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"__title-label",innerHTML:e.DOMPurify.sanitize(s.hitSubstring)},null,8,M),0!==s.categoryNode.URLs.length?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:n[3]||(n[3]=(0,i.D$)((()=>{}),["stop"])),onClick:(0,i.D$)((()=>e.showMenuClick(s)),["stop"])},[(0,o.bF)(N,{class:"smaller_svg"})],40,T)):(0,o.Q3)("",!0),(0,o.Lk)("div",_,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(D,{key:0,node:e.showMenu.categoryNode,style:{width:"18em"}},null,8,["node"])),[[A,e.closeMenu]]):(0,o.Q3)("",!0)])],46,k)),[[i.aG,s.mask]]):((0,o.uX)(),(0,o.CE)("div",P,(0,a.v_)(e.prettyTitle(s.hitSubstring)),1))],64))])),[[i.aG,s.mask]]))),128))],64)}]]);var z=t(1954),G=t(8328);const J=(0,o.pM)({components:{PaletteCategory:U,PaletteEntry:z.A},props:{paletteRef:{required:!0},paletteSearch:{required:!0}},setup(e){const{viewModel:n}=(0,l.if)(),{editor:t}=n.value,{x:i,y:a}=(0,c.RcE)(),{transform:s}=(0,l.Gy)(),u=(0,o.EW)((()=>e.paletteSearch)),d=(0,o.WQ)("editorEl"),p=(0,r.KR)(null),g=(0,r.KR)(null),v=(0,r.KR)(null),y=(0,r.KR)(null);g.value={top:0,left:0,visible:!1,text:""};const h=(0,o.EW)((()=>{if(!p.value||!d?.value)return{};const{left:e,top:n}=d.value.getBoundingClientRect();return{top:a.value-n+"px",left:i.value-e+"px"}}));function f(e){n.value.displayedGraph.addNode(e),e.position.x=v.value,e.position.y=y.value}(0,o.wB)((()=>G.x.configurationMenu.visible),(async(e,n)=>{if(!0===n&&!1===e&&G.x.configurationMenu.placeNode){const e=G.c.nodeData.name,n=new(t.nodeTypes.get(e).type);G.x.configurationMenu.addNode&&G.c.success&&f(n)}}));const m=n=>{if(!document.elementsFromPoint(n.clientX,n.clientY).includes(e.paletteRef)){const e=d.value.getBoundingClientRect();[v.value,y.value]=s(i.value-e.left,a.value-e.top),p.value.type===W.Wx?(G.x.configurationMenu.visible=!G.x.configurationMenu.visible,G.x.configurationMenu.addNode=!0,G.x.configurationMenu.placeNode=!0):f(new p.value.nodeInformation.type),p.value=null,document.removeEventListener("pointerup",m),document.removeEventListener("keydown",b)}},b=e=>{"Escape"===e.key&&(p.value=null,document.removeEventListener("pointerup",m),document.removeEventListener("keydown",b))},C=(0,r.KR)(0),E=(0,r.KR)(!1);(0,o.Gt)("menu",E);const w=(0,o.EW)((()=>function(e){const{viewModel:n}=(0,l.if)(),{editor:t}=n.value,i=W.Ay.getEditorManagerInstance(),a=Array.from(t.nodeTypes.entries()),s=new Set(a.map((([,e])=>e.category))),r={categoryName:"TopLevel",nodeTypes:{}},c=[];s.forEach((e=>{if(""===e)return void a.filter((([,e])=>""===e.category)).forEach((([e,n])=>{r.nodeTypes[e]=Object.assign(Object.assign({},n),{isCategory:n.isCategory,mask:!0,hitSubstring:n.title,iconPath:t.getNodeIconPath(e),URLs:t.getNodeURLs(e)})}));let n=a.filter((([,n])=>n.category===e));const o=Object.fromEntries(n.map((e=>{const[n]=e;return[n,t.getNodeURLs(n)]}))),s=Object.fromEntries(n.map((e=>{const[n]=e;return[n,t.getNodeIconPath(n)]})));let l=n.filter((([e,n])=>q.includes(e)));if(n=n.filter((([e,n])=>!q.includes(e))),i.baklavaView.settings.editableNodeTypes||(l=l.filter((([e,n])=>e!==W.Wx))),i.baklavaView.settings.newGraphNode||(l=l.filter((([e,n])=>e!==W.dH))),n.length>0){const t=n.map((([e,n])=>[e,Object.assign(Object.assign({},n),{isCategory:n.isCategory,mask:!0,hitSubstring:n.title,iconPath:s[e],URLs:o[e]})]));c.push({categoryName:e,nodeTypes:Object.fromEntries(t)})}l.forEach((([e,n])=>{r.nodeTypes[e]=Object.assign(Object.assign({},n),{isCategory:n.isCategory,mask:!0,hitSubstring:n.title,iconPath:s[e],URLs:o[e]})}))}));const u=new Set(c.map((e=>e.categoryName))),d=B(u),p=K(d,c);V&&V();const g={subcategories:p,nodes:r,categoryNode:void 0,hitSubstring:"TopLevel",mask:!0},v={All:g};return V=(0,o.wB)(e,(e=>{""===e?(Object.entries(v).forEach((e=>$(e))),Object.values(v).forEach((e=>H(e)))):F(v,e.toLowerCase(),!1)})),g}(u))),k=(0,o.EW)((()=>n.value.collapseSidebar));return(0,o.sV)((()=>{(0,o.EW)((()=>document.querySelector(".nodes"))).value.addEventListener("scroll",(e=>{C.value=e.target.scrollTop;const n=document.getElementsByClassName("__icondiv");for(let e=0;e<n.length;e+=1)n[e].style.translate=`0px -${C.value.toString()}px`}))})),{draggedNodeStyles:h,draggedNode:p,onDragStart:(e,n,t)=>{p.value={type:e,nodeInformation:n,iconPath:t},document.addEventListener("pointerup",m),document.addEventListener("keydown",b)},nodeTree:w,collapse:k,tooltip:g,nodeSearch:u,scroll:C}}}),Z=(0,Q.A)(J,[["render",function(e,n,t,r,l,c){const u=(0,o.g2)("PaletteCategory"),d=(0,o.g2)("PaletteEntry");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.bF)(u,{nodeTree:e.nodeTree,onDragStart:e.onDragStart,defaultCollapse:e.collapse,tooltip:e.tooltip,nodeSearch:e.nodeSearch},null,8,["nodeTree","onDragStart","defaultCollapse","tooltip","nodeSearch"]),(0,o.bF)(i.eB,{name:"fade"},{default:(0,o.k6)((()=>[e.draggedNode?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"baklava-dragged-node",style:(0,a.Tr)(e.draggedNodeStyles)},[(0,o.bF)(d,{title:e.draggedNode.nodeInformation.title,iconPath:e.draggedNode.iconPath,isDragged:!0,depth:0},null,8,["title","iconPath"])],4)):(0,o.Q3)("",!0)])),_:1})])}]])},80768:(e,n,t)=>{function o(e,n,t){const o=document.getElementById(n.id),i=t,a=e.panning.x,s=e.panning.y,{scaling:r}=e,l=r*(a+n.position.x),c=r*(s+n.position.y+60),u=o.offsetWidth,d=o.offsetHeight;return l+.09999999999999998*l>i.xBegin&&l+u*r-.09999999999999998*l<i.xEnd&&c+.09999999999999998*c>i.yBegin&&c+d*r-.09999999999999998*c<i.yEnd}t.d(n,{A:()=>o})},92125:(e,n,t)=>{t.d(n,{A:()=>s});var o=t(20641),i=t(63491),a=t(58365);function s(){const{graph:e}=(0,i.uU)();let n=[],t=-1,s={x:0,y:0};const r=()=>e.value.size().graphWidth<=500||e.value.size().graphHeight<=500;let l=4;const c=(0,o.EW)((()=>e.value.panning)),u=(0,a.A)(c),d=(n,t,o)=>{if(o<=0)return;r()&&(l=8);const i=[n/e.value.scaling-e.value.panning.x,t/e.value.scaling-e.value.panning.y],a=[n/o-e.value.panning.x,t/o-e.value.panning.y],s=[a[0]-i[0],a[1]-i[1]],c=window.innerHeight,u=window.innerWidth;(l*e.value.size().graphWidth>u/o||l*e.value.size().graphHeight>c/o||o>e.value.scaling&&e.value.size().graphHeight!==-1/0)&&(e.value.scaling=o,e.value.panning.x+=s[0],e.value.panning.y+=s[1])},p=()=>({ax:n[0].clientX,ay:n[0].clientY,bx:n[1].clientX,by:n[1].clientY});return{...u,onPointerDown:e=>{if(u.onPointerDown(e),n.length<=1&&n.push(e),2===n.length){const{ax:e,ay:n,bx:o,by:i}=p(),a=e-o,r=n-i;t=Math.sqrt(a*a+r*r),s={x:e+(o-e)/2,y:n+(i-n)/2}}},onPointerMove:o=>{if(2===n.length){for(let e=0;e<n.length;e+=1)if(o.pointerId===n[e].pointerId){n[e]=o;break}const{ax:i,ay:a,bx:r,by:l}=p(),c=i-r,u=a-l,g=Math.sqrt(c*c+u*u);if(t>0){const n=e.value.scaling*(1+(g-t)/500);d(s.x,s.y,n)}t=g}else u.onPointerMove(o)},onPointerUp:e=>{u.onPointerUp(),n=n.filter((n=>n.pointerId!==e.pointerId)),t=-1},onMouseWheel:n=>{if("textarea"===n.target.type&&"baklava-input"===n.target.className)return;n.preventDefault();let t=n.deltaY;1===n.deltaMode&&(t*=32);const o=(n=>{const t=r()?2:1.5,o=e.value.scaling*(1-n/3e3);return Math.min(o,t)})(t);d(n.clientX,n.clientY,o)},onZoomIn:()=>{const n=Math.min(1.2*e.value.scaling,1.5);d(window.innerWidth/2,window.innerHeight/2,n)},onZoomOut:()=>{d(window.innerWidth/2,window.innerHeight/2,.8*e.value.scaling)}}}}}]);
//# sourceMappingURL=index-37de9766.0c438950.js.map