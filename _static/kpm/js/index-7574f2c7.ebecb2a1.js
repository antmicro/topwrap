"use strict";(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[257],{4636:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(20641),a=n(90033),i=n(53751);const r=["id"],s={key:1},l={key:2,class:"__property_name"};var d=n(50953),u=n(63491),c=n(22007),p=n(41426),h=n(14121),v=n(57565);const f=(0,o.pM)({extends:u.XF.NodeInterface,props:{highlighted:Boolean,picked:Boolean,switchSides:{},toggleGroup:{default:()=>{},required:!1},updateDynamicInterfaces:{default:()=>{},required:!1},sidebar:{default:!1,required:!1},tabindexValue:{default:-1,required:!1}},components:{Arrow:c.A},setup(e){const{el:t,isConnected:n,showComponent:a,startHover:i,endHover:r,openSidebar:s}=u.XF.NodeInterface.setup(e),{viewModel:l}=(0,u.if)(),{graph:c}=(0,u.uU)();e.intf.events.beforeSetValue.unsubscribe(e.intf),e.intf.events.beforeSetValue.subscribe(e.intf,((t,n)=>{l.value.editor.readonly&&n(),(void 0!==e.intf.min&&t<e.intf.min||void 0!==e.intf.max&&t>e.intf.max)&&n()})),e.intf.group&&(e.toggleGroup(e.intf),e.intf.events.setValue.unsubscribe(e.intf),e.intf.events.setValue.subscribe(e.intf,(()=>e.toggleGroup(e.intf)))),e.intf.name.endsWith(h.Yg)&&(e.updateDynamicInterfaces(e.intf),e.intf.events.setValue.unsubscribe(e.intf),e.intf.events.setValue.subscribe(e.intf,(()=>e.updateDynamicInterfaces(e.intf))));const f=(0,d.KR)(!1),g=(0,d.KR)(!1),m=(0,p.A)(700,(()=>{l.value.editor.readonly||(e.switchSides(e.intf),r())})),y=e.intf.port&&"inout"!==e.intf.direction,b=(0,o.EW)((()=>{if("input"===e.intf.direction){if("left"===e.intf.side)return"right";if("right"===e.intf.side)return"down"}if("output"===e.intf.direction){if("left"===e.intf.side)return"down";if("right"===e.intf.side)return"right"}return"down"})),w=(0,o.EW)((()=>({"--input":"left"===e.intf.side,"--output":"right"===e.intf.side,"--connected":n.value,__readonly:l.value.editor.readonly}))),E=(0,o.EW)((()=>void 0!==e.intf.externalName));new u.lo("External name",e.intf.externalName).setPort(!1).componentName="TextInterface";const _=(0,d.KR)(!1),C=(0,d.KR)(!1),k=(0,d.KR)(null),N=[],x=(0,d.KR)(e.intf.externalName);return{arrowRotation:b,displayArrow:y,editExternalName:_,el:t,enableExternalNameEdit:t=>{N.splice(0,N.length),N.push(...c.value.obtainExposedNames()),N.splice(N.indexOf(e.intf.externalName),1),_.value=!0,t.preventDefault(),(0,o.dY)().then((()=>{k.value.focus(),k.value.select(),C.value=c.value.isIncorrectExternalName(e.intf.externalName,N)}))},endHover:r,endHoverWrapper:()=>{f.value=!1,l.value.editor.readonly||r()},externalNameInput:k,externalNameInputIncorrect:C,externalNameInputCallback:e=>{C.value=c.value.isIncorrectExternalName(e.target.value,N)},externalNameFocusOutCallback:()=>{if(_.value=!1,C.value=!1,x.value===e.intf.externalName)return;const t=c.value.resolveNewExposedName(x.value);x.value=t,l.value.editor.exposeInterface(c.value.id,e.intf,t)},hovered:f,isConnected:n,inputExternalName:x,newClasses:w,onMouseDown:m,openSidebar:s,showComponent:a,isExposed:E,startHover:i,startHoverWrapper:()=>{f.value=!0,l.value.editor.readonly||i()},propertyHovered:g,startPropertyHover:()=>{g.value=!0},endPropertyHover:()=>{g.value=!1},setValue:()=>{if(!e.intf.value)return;if(!E.value&&!v.ir.isRegistered(e.intf.id))return;const{editor:t}=l.value;Array.from(t.graphs).map((e=>e.nodes)).flat().map((e=>Object.entries(e.inputs))).flat().filter((([e,t])=>e.startsWith("property_"))).map((([e,t])=>t)).filter((t=>t.id===e.intf.id)).forEach((t=>t.value=e.intf.value))}}}}),g=(0,n(66262).A)(f,[["render",function(e,t,n,d,u,c){const p=(0,o.g2)("Arrow");return(0,o.uX)(),(0,o.CE)("div",{id:e.intf.id,ref:"el",class:(0,a.C4)(["baklava-node-interface",e.newClasses])},[e.intf.port?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,a.C4)(["__port",{greyedout_arrow:e.highlighted,picked:e.picked,__square:e.isExposed}]),onMouseenter:t[8]||(t[8]=(...t)=>e.startHoverWrapper&&e.startHoverWrapper(...t)),onMouseleave:t[9]||(t[9]=(...t)=>e.endHoverWrapper&&e.endHoverWrapper(...t)),onPointerdown:t[10]||(t[10]=(0,i.D$)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left"]))},[e.isExposed&&(e.hovered||e.editExternalName)?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,a.C4)({__port_name_left:"left"===e.intf.side,__port_name_right:"right"===e.intf.side})},[e.editExternalName?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=t=>e.inputExternalName=t),ref:"externalNameInput",type:"text",spellcheck:"false",autocomplete:"off",class:(0,a.C4)(["__port_input",{__error:e.externalNameInputIncorrect}]),placeholder:"External name",onFocusout:t[1]||(t[1]=(...t)=>e.externalNameFocusOutCallback&&e.externalNameFocusOutCallback(...t)),onKeydown:[t[2]||(t[2]=(0,i.jR)((0,i.D$)((e=>{e.target.blur()}),["exact","stop"]),["enter"])),t[5]||(t[5]=(0,i.D$)((e=>e.stopPropagation()),["ctrl","stop"]))],onInput:t[3]||(t[3]=(...t)=>e.externalNameInputCallback&&e.externalNameInputCallback(...t)),onPointerdown:t[4]||(t[4]=(0,i.D$)((e=>e.stopPropagation()),["left","stop"]))},null,34)),[[i.Jo,e.inputExternalName]]):((0,o.uX)(),(0,o.CE)("span",{key:1,onPointerdown:t[6]||(t[6]=(0,i.D$)(((...t)=>e.enableExternalNameEdit&&e.enableExternalNameEdit(...t)),["left","stop"])),onKeydown:t[7]||(t[7]=(0,i.D$)((()=>{}),["stop"]))},(0,a.v_)(e.intf.externalName),33))],2)):(0,o.Q3)("",!0),e.displayArrow?((0,o.uX)(),(0,o.Wv)(p,{key:1,noninteractable:!0,color:"black",scale:"big",rotate:e.arrowRotation},null,8,["rotate"])):(0,o.Q3)("",!0)],34)):(0,o.Q3)("",!0),(0,o.Lk)("div",{onMouseenter:t[21]||(t[21]=(...t)=>e.startPropertyHover&&e.startPropertyHover(...t)),onMouseleave:t[22]||(t[22]=(...t)=>e.endPropertyHover&&e.endPropertyHover(...t))},[e.showComponent?((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.intf.component),{key:0,modelValue:e.intf.value,"onUpdate:modelValue":t[11]||(t[11]=t=>e.intf.value=t),node:e.node,intf:e.intf,onKeydown:t[12]||(t[12]=(0,i.D$)((()=>{}),["stop"])),tabindex:e.tabindexValue,onClick:e.setValue,onInput:e.setValue},null,40,["modelValue","node","intf","tabindex","onClick","onInput"])):((0,o.uX)(),(0,o.CE)("span",s,(0,a.v_)(e.intf.name),1)),!e.isExposed||!e.propertyHovered&&!e.editExternalName||e.intf.port||e.sidebar?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",l,[e.editExternalName?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:0,"onUpdate:modelValue":t[13]||(t[13]=t=>e.inputExternalName=t),ref:"externalNameInput",type:"text",spellcheck:"false",autocomplete:"off",class:(0,a.C4)(["__property_input",{__error:e.externalNameInputIncorrect}]),placeholder:"External name",onFocusout:t[14]||(t[14]=(...t)=>e.externalNameFocusOutCallback&&e.externalNameFocusOutCallback(...t)),onKeydown:[t[15]||(t[15]=(0,i.jR)((0,i.D$)((e=>{e.target.blur()}),["exact","stop"]),["enter"])),t[18]||(t[18]=(0,i.D$)((e=>e.stopPropagation()),["ctrl","stop"]))],onInput:t[16]||(t[16]=(...t)=>e.externalNameInputCallback&&e.externalNameInputCallback(...t)),onPointerdown:t[17]||(t[17]=(0,i.D$)((e=>e.stopPropagation()),["left","stop"]))},null,34)),[[i.Jo,e.inputExternalName]]):((0,o.uX)(),(0,o.CE)("span",{key:1,onPointerdown:t[19]||(t[19]=(0,i.D$)(((...t)=>e.enableExternalNameEdit&&e.enableExternalNameEdit(...t)),["left","stop"])),onKeydown:t[20]||(t[20]=(0,i.D$)((()=>{}),["stop"]))},(0,a.v_)(e.intf.externalName),33))]))],32)],10,r)}]])},13700:(e,t,n)=>{n.d(t,{A:()=>y});var o=n(90033),a=n(20641),i=n(53751);const r={key:0,class:"readonly item",style:{cursor:"default"}},s=["onClick","onPointerover","onPointerleave"],l={class:"icon"},d={class:"text"},u={class:(0,o.C4)("tooltip")},c=["href","onClick"],p={class:"icon"},h=["src","alt"],v={class:"text"};var f=n(50953),g=n(63491);const m=(0,a.pM)({extends:g.XF.ContextMenu,props:{urls:{required:!1,default:[]}},emits:["update:modelValue","click","sizeUpdate","onpointerover","onpointerleave"],setup(e,t){const{el:n,styles:o,classes:i,itemsWithHoverProperty:r}=g.XF.ContextMenu.setup(e,t),{viewModel:s}=(0,g.if)(),l=(0,f.KR)(!0);(0,a.sV)((async()=>{await(0,a.dY)();const e=n.value.getBoundingClientRect();t.emit("sizeUpdate",e)}));const d=o=>{!0===e.modelValue&&(!1===l.value?(document.elementsFromPoint(o.clientX,o.clientY).includes(n.value)||(window.removeEventListener("wheel",d),window.removeEventListener("pointerdown",d),t.emit("update:modelValue",!1)),l.value=!0):l.value=!1)};return window.addEventListener("wheel",d),window.addEventListener("pointerdown",d),{el:n,styles:o,classes:i,itemsWithHoverProperty:r,onClick:e=>{t.emit("click",e.value),t.emit("update:modelValue",!1)},getIconPath:e=>s.value.cache[`./${e}`]??e,onPointerOver:e=>{e.onPointerEmit&&t.emit("pointerover",e)},onPointerLeave:e=>{e.onPointerEmit&&t.emit("pointerleave",e)}}}}),y=(0,n(66262).A)(m,[["render",function(e,t,n,f,g,m){return(0,a.uX)(),(0,a.Wv)(i.eB,{name:"slide-fade"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.Lk)("div",{ref:"el",class:(0,o.C4)(["baklava-context-menu",e.classes]),style:(0,o.Tr)(e.styles)},[0===e.itemsWithHoverProperty.length?((0,a.uX)(),(0,a.CE)("div",r,t[0]||(t[0]=[(0,a.Lk)("div",{class:"text"},[(0,a.Lk)("i",null,"No resources")],-1)]))):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.itemsWithHoverProperty,((t,n)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[void 0===t.url?((0,a.uX)(),(0,a.CE)("div",{key:`i-${n}`,class:(0,o.C4)(["item",{submenu:!!t.submenu,"--disabled":!!t.disabled,hoverbox:!!t.tooltipMsg}]),onClick:(0,i.D$)((n=>t.disabled?null:e.onClick(t)),["stop"]),onPointerover:n=>e.onPointerOver(t),onPointerleave:n=>e.onPointerLeave(t)},[(0,a.Lk)("div",l,[void 0!==t.icon?((0,a.uX)(),(0,a.Wv)((0,a.$y)(t.icon),{key:0})):(0,a.Q3)("",!0)]),(0,a.Lk)("div",d,(0,o.v_)(t.label),1),(0,a.Lk)("div",u,[(0,a.Lk)("span",null,(0,o.v_)(t.tooltipMsg),1)])],42,s)):((0,a.uX)(),(0,a.CE)("a",{key:t.name,href:t.url,class:"item",target:"_blank",draggable:"false",onClick:(0,i.D$)((n=>e.onClick(t)),["stop"])},[(0,a.Lk)("div",p,[void 0!==e.getIconPath(t.icon)?((0,a.uX)(),(0,a.CE)("img",{key:0,src:e.getIconPath(t.icon),alt:t.name,draggable:"false"},null,8,h)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",v,(0,o.v_)(t.name),1)],8,c)),t.endSection?((0,a.uX)(),(0,a.CE)("hr",{key:`hr-${n}`})):(0,a.Q3)("",!0)],64)))),256))],6),[[i.aG,e.modelValue]])])),_:1})}],["__scopeId","data-v-02cc508d"]])},15502:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(46171);class a extends o.b1{_name="";constructor(e,t){super(e,t),e.name&&(this.name=e.name)}}},51970:(e,t,n)=>{n.d(t,{A:()=>f});var o=n(46171),a=n(63491),i=n(20641),r=n(42302),s=n(34250),l=n(50953),d=n(41857),u=n(96422),c=n(15502),p=n(54320),h=n(70380),v=n(57565);class f extends o.KE{preview=!1;_hideHud=!1;get hideHud(){return this._hideHud||this.preview}set hideHud(e){this._hideHud=e}_readonly=!1;get readonly(){return this._readonly||this.preview}set readonly(e){this._readonly=e}allowLoopbacks=!1;nodeIcons=new Map;nodeColors=new Map;baseURLs=new Map;baseIconUrls=new Map;nodeURLs=new Map;nodeStyles=new Map;layoutManager=new p.A;subgraphStack=[];parentNodes=new Map;additionalNodeTypes=new Set;subgraphStackGraphTypeEnum={SUBGRAPH:"subgraph",RELATEDGRAPH:"relatedGraph"};editorManager=null;newRootGraph=void 0;registerGraph(e){const t=function(e){return e.events.addAnchor=new s.Hx,e.events.removeAnchor=new s.Hx,e.events.editNode=new s.Hx,e.graphNode=void 0,e.checkConnection=function(e,t){if(!e||!t)return{connectionAllowed:!1,error:"Invalid from and to references."};const n=this.findNodeById(e.nodeId),a=this.findNodeById(t.nodeId);if(n&&a&&n===a&&!this.editor.allowLoopbacks)return{connectionAllowed:!1,error:"Loopbacks are not allowed."};if("input"===e.direction&&"output"===t.direction||"input"===e.direction&&"inout"===t.direction||"inout"===e.direction&&"output"===t.direction){const n=e;e=t,t=n}if(e.isInput&&"inout"!==e.direction)return{connectionAllowed:!1,error:"Connections are only allowed from output or inout interfaces."};if(!t.isInput)return{connectionAllowed:!1,error:"Connections are only allowed to input or inout interfaces."};if(this.connections.some((n=>n.from===e&&n.to===t)))return{connectionAllowed:!1,error:"Duplicate connections are not allowed."};if(e.maxConnectionsCount>0&&e.connectionCount+1>e.maxConnectionsCount)return{connectionAllowed:!1,error:`Too many connections from an input interface '${e.id}', maximum of '${e.maxConnectionsCount}' are allowed.`};if((0===t.maxConnectionsCount||void 0===t.maxConnectionsCount)&&t.connectionCount>0)return{connectionAllowed:!1,error:`By default only one connection to an input interface '${t.id}' allowed.`};if(t.maxConnectionsCount>0&&t.connectionCount+1>t.maxConnectionsCount)return{connectionAllowed:!1,error:`Too many connections to an output interface '${t.id}', maximum of '${t.maxConnectionsCount}' are allowed.`};if(e.type&&t.type){const n="string"==typeof e.type||e.type instanceof String?[e.type]:e.type,o="string"==typeof t.type||t.type instanceof String?[t.type]:t.type;if(void 0===n.find((e=>o.includes(e))))return{connectionAllowed:!1,error:`No common types between interfaces. Interface '${e.id}' supports types '${n}' and interface '${t.id}' supports types '${o}'.`}}return this.events.checkConnection.emit({from:e,to:t}).prevented?{connectionAllowed:!1,error:`Connection between an input interface '${e.id}' and an output interface '${t.id}' was prevented`}:this.hooks.checkConnection.execute({from:e,to:t}).some((e=>!e.connectionAllowed))?{connectionAllowed:!1,errors:`Connection between an input interface '${e.id}' and an output interface '${t.id}' was prevented`}:{connectionAllowed:!0,dummyConnection:new o.pB(e,t),connectionsInDanger:[]}},e.addAnchor=function(t,n,o){const a={x:t.x,y:t.y,id:(0,r.A)()};void 0===n.anchors&&(n.anchors=[]),n.anchors.splice(o,0,a),e.events.addAnchor.emit([n,3*o+1])},e.replaceNode=function(e,t){const n=e.position,a=new(this.editor.nodeTypes.get(t).type);e.title!==e.type&&(a.title=e.title),Object.entries({...e.inputs,...e.outputs}).forEach((([e,t])=>{void 0!==t.direction?(Object.prototype.hasOwnProperty.call(a.inputs,e)&&(0,u.q6)(a,a.inputs[e],t.side,t.sidePosition,!1,!1),Object.prototype.hasOwnProperty.call(a.outputs,e)&&(0,u.q6)(a,a.outputs[e],t.side,t.sidePosition,!1,!1)):Object.prototype.hasOwnProperty.call(a.inputs,e)&&a.inputs[e].componentName===t.componentName&&(a.inputs[e].value=t.value)}));const i=[...Object.values(e.inputs),...Object.values(e.outputs)],r=this.connections.filter((e=>i.includes(e.from)||i.includes(e.to))),s=[];return Object.entries({...e.inputs,...e.outputs}).forEach((([e,t])=>{void 0!==t.direction&&r.forEach((n=>{if(Object.prototype.hasOwnProperty.call(a.inputs,e))if(n.from===t){const t=new o.Ng(a.inputs[e],n.to);t.anchors=n.anchors,s.push(t)}else if(n.to===t){const t=new o.Ng(n.from,a.inputs[e]);t.anchors=n.anchors,s.push(t)}if(Object.prototype.hasOwnProperty.call(a.outputs,e))if(n.from===t){const t=new o.Ng(a.outputs[e],n.to);t.anchors=n.anchors,s.push(t)}else if(n.to===t){const t=new o.Ng(n.from,a.outputs[e]);t.anchors=n.anchors,s.push(t)}}))})),a.position=n,(0,d.nb)(),this.removeNode(e),this.addNode(a),s.forEach((e=>this.internalAddConnection(e))),(0,d.wH)(),a},e.addNode=function(e,t,n){if(!this.events.beforeAddNode.emit(e).prevented){if(this.nodeEvents.addTarget(e.events),this.nodeHooks.addTarget(e.hooks),e.registerGraph(this),void 0!==e.template){const t=JSON.parse(JSON.stringify(e.template.save()));t.id??=(0,r.A)(),e.template=new c.A(t,this.editor)}return this._nodes.push(e),(e=this.nodes.find((t=>t.id===e.id))).onPlaced(t,n),this.events.addNode.emit(e),e}},e.destroy=function(){},e.load=function(t){const n=[];for(let e=this.connections.length-1;e>=0;e-=1)this.removeConnection(this.connections[e]);for(let e=this.nodes.length-1;e>=0;e-=1)this.removeNode(this.nodes[e]);this.id=t.id??(0,r.A)(),this.name=t.name??void 0;const a=(e,t)=>e?e.has(t)?`'${e.get(t)}'`:`'${t}' (generated)`:t,i=[];t.nodes.forEach((e=>{const n=this.editor.nodeTypes.get(e.name);if(n){const o=new n.type;if(e.id??=(0,r.A)(),e.subgraph&&e.graphState){const n=new Set([...this.editor.graphs].map(l.ux));this.addNode(o,t.graphLoadingState,e.id),[...this.editor.graphs].map(l.ux).filter((e=>!n.has(e))).filter((e=>e!==o.subgraph)).forEach((e=>this.editor.unregisterGraph(e)))}else if(e.subgraph&&!t.graphLoadingState){const t=e.interfaces.filter((e=>e.id)).map((e=>[e.name,e.id])),n={newToSpecNodeIds:new Map([[e.id,e.id]]),newInterfaceIds:new Map([[e.id,new Map(t)]]),newToSpecConnIds:new Map,newToSpecIntfIds:new Map};this.addNode(o,n,e.id)}else this.addNode(o,t.graphLoadingState,e.id);const s=o.load(e);Array.isArray(s)&&s.length&&i.push(`Node '${o.type}' with id ${a(t.graphLoadingState?.newToSpecNodeIds,e.id)} is invalid:`,...s.map((e=>`    ${e}`)))}else i.push(`Node type ${e.name} is not registered`)})),i.length&&n.push("Node errors:",...i.map((e=>`    ${e}`))),t.connections.forEach((e=>{e.id??=(0,r.A)()}));const s=[];return t.connections.forEach((i=>{const r=[],l=this.findNodeInterface(i.from),d=this.findNodeInterface(i.to);t.connections.some((e=>e.id===i.id&&(e.from!==i.from||e.to!==i.to)))&&r.push("ID is already taken.");const u=(e,n,o)=>{n||r.push(`Missing ${e} ${a(t.graphLoadingState?.newToSpecIntfIds,o)}`)};if(u("src",l,i.from),u("dst",d,i.to),r.length){const e=(e,n)=>{if(!n)return;const o=this.nodes.find((({id:e})=>e===n.nodeId)),i=a(t.graphLoadingState?.newToSpecIntfIds,n.id),s=a(t.graphLoadingState?.newToSpecNodeIds,o.id);r.push(`Found   ${e} ${i} '${n.name}' in node '${o.type}' with id ${s}`)};e("src",l),e("dst",d);const n=a(t.graphLoadingState?.newToSpecConnIds,i.id);s.push(`Connection ${n} is invalid:`,...r.map((e=>`    ${e}`)))}else{const t=this.checkConnection(l,d);if(t.connectionAllowed){t.connectionsInDanger.forEach((e=>{const t=this.connections.find((t=>t.id===e.id));t&&this.removeConnection(t)}));const n=new o.Ng(t.dummyConnection.from,t.dummyConnection.to);i.anchors?.forEach(((t,o)=>{e.addAnchor(t,n,o)})),this.internalAddConnection(n)}else n.push(`Could not create connection of id '${i.id}'. ${t.error}`)}})),s.length&&n.push("Connection errors:",...s.map((e=>`    ${e}`))),this.hooks.load.execute(t),n},e.size=function(){const e=this.nodes.map((e=>{const t=document.getElementById(e.id);return{width:t.offsetWidth,height:t.offsetHeight,position:e.position}})),t=100,n=Math.max(...e.map((e=>e.position.x+e.width)))+t,o=Math.min(...e.map((e=>e.position.x)))-t,a=Math.max(...e.map((e=>e.position.y+e.height)))+t,i=Math.min(...e.map((e=>e.position.y)))-t;return{graphHeight:a-i,graphWidth:n-o,rightmostX:n,leftmostX:o,bottommostY:a,topmostY:i}},e.save=function(){const e={id:this.id,name:""!==this.name?this.name:void 0,nodes:this.nodes.map((e=>e.save())),connections:this.connections.map((e=>({id:e.id,from:e.from.id,to:e.to.id,anchors:e.anchors?.map((e=>({x:e.x,y:e.y})))}))),scaling:this.scaling,panning:this.panning};return this.hooks.save.execute(e)},e.removeSelectedNodes=function(){for(let e=this.selectedNodes.length-1;e>=0;e-=1)this.removeNode(this.selectedNodes[e])},e.removeNode=function(e){if(this.nodes.includes(e)){if(this.events.beforeRemoveNode.emit(e).prevented)return;const t=[...Object.values(e.inputs),...Object.values(e.outputs)];this.connections.filter((e=>t.includes(e.from)||t.includes(e.to))).forEach((e=>this.removeConnection(e))),this._nodes.splice(this.nodes.indexOf(e),1),this.events.removeNode.emit(e),e.onDestroy(),this.nodeEvents.removeTarget(e.events),this.nodeHooks.removeTarget(e.hooks)}},e.removeNodeOnly=function(e){this._nodes.splice(this.nodes.indexOf(e),1),this.events.removeNode.emit(e),e.onDestroy(),this.nodeEvents.removeTarget(e),this.nodeHooks.removeTarget(e)},e.editNode=function(e){this.events.editNode.emit(e)},e.obtainExposedNames=function(){const e=[];return this._nodes.forEach((t=>{Object.values({...t.inputs,...t.outputs}).forEach((t=>{void 0!==t.externalName&&e.push(t.externalName)}))})),e},e.isIncorrectExternalName=function(e,t){if(void 0===this.graphNode)return!1;const n=t.filter((t=>t===e)).length,o=[...Object.keys(this.graphNode.inputs),...Object.keys(this.graphNode.outputs)].map((e=>e.split("_"))).filter((e=>"property"!==e[0])).map((e=>e[1])).filter((t=>t===e)).length;return 0===e.length||0!==n||0!==o},e.resolveNewExposedName=function(e){const t=this.obtainExposedNames();let n=1,o=e;for(;this.isIncorrectExternalName(o,t);)o=`${e}_${n}`,n+=1;return o},e}(e);super.registerGraph(t)}save(){const e=[];for(;this.isInSubgraph();)void 0===this._graph.graphNode?e.push({type:this.subgraphStackGraphTypeEnum.RELATEDGRAPH,frame:this._graph.id}):e.push({type:this.subgraphStackGraphTypeEnum.SUBGRAPH,frame:this._graph.graphNode}),this.backFromSubgraph();let t=this._graph.id,n=this.graph.save();n.panning=this._graph.panning,n.scaling=this._graph.scaling,void 0!==this.newRootGraph&&(t=this.newRootGraph.id,n=this.newRootGraph.save());const o={graphs:[]},a=e=>{void 0!==e.subgraph&&(o.graphs.push(e.graphState),e.graphState.nodes.forEach(a)),delete e.graphState};return n.nodes.forEach(a),this.nodeTypes.forEach(((e,t)=>{e.relatedGraphs?.forEach((({id:e})=>{const t=Array.from(this.graphs).find((t=>e===t.id));t&&!o.graphs.find((e=>e.id===t.id))&&o.graphs.push(t.save())}))})),n.nodes.forEach((e=>{e.color=this.getNodeColor(e)})),o.graphs.length&&(o.entryGraph=t),o.graphs=[n,...o.graphs],e.reverse().forEach((({frame:e,type:t})=>{switch(t){case this.subgraphStackGraphTypeEnum.RELATEDGRAPH:this.switchToRelatedGraph(e);break;case this.subgraphStackGraphTypeEnum.SUBGRAPH:this.switchToSubgraph(e)}})),o}deepCleanEditor(e=!0){this.subgraphStack.forEach(this.backFromSubgraph.bind(this)),this.cleanEditor(e),this.graphName=void 0}cleanEditor(e=!0){for(;this.isInSubgraph();)this.backFromSubgraph();const t=this._graph;(0,d.$4)(e);for(let e=t.connections.length-1;e>=0;e-=1)t.removeConnection(t.connections[e]);for(let e=t.nodes.length-1;e>=0;e-=1)t.removeNode(t.nodes[e]);(0,d.$4)(!1)}unregisterGraphs(){[...this.graphs].filter((e=>e!==this._graph)).forEach((e=>this.unregisterGraph(e))),this.subgraphStack=[]}unregisterNodes(){this.nodeTypes.forEach(((e,t)=>{this.unregisterNodeType(t)}))}registerNodeType(e,t){if(this.events.beforeRegisterNodeType.emit({type:e,options:t}).prevented)return;const n=new e;this._nodeTypes.set(n.type,{type:e,category:t?.category??"default",title:t?.title??n.title,isCategory:t?.isCategory??!1,color:t?.color,subgraphId:t?.subgraphId,relatedGraphs:t?.relatedGraphs,style:t?.style,pill:t?.pill}),this.events.registerNodeType.emit({type:e,options:t})}async load(e,t=!1,n=!1,a=null){this.unregisterGraphs(),v.ir.clearRegistry();const r=this.readonly;this.readonly=!0;const s=[];if(!e.graphs.length)return["No graphs found"];let l;if(e.entryGraph){if(l=e.graphs.find((t=>t.id===e.entryGraph)),!l)return[`No entry graph found of id '${e.entryGraph}'`]}else l=e.graphs[0];const{panning:d,scaling:u}=l,c=new Set;this.nodeColors.clear(),e.graphs.forEach((t=>{t.nodes.forEach((t=>{if(void 0!==t.subgraph){const n=e.graphs.filter((e=>e.id===t.subgraph));1!==n.length&&s.push([`Expected exactly one template with ID ${t.name}, got ${n.length}`]),c.add(t.subgraph);const{subgraphId:o}=this.nodeTypes.get(t.name)??{};(t.subgraph!==o||void 0===o)&&([t.graphState]=n)}t.relatedGraphs?.filter((({id:t})=>void 0===e.graphs.find((e=>e.id===t)))).forEach((({id:e})=>s.push([`The related graph of id ${e} is not defined`]))),this.setNodeColor(t.id,t.color)}))}));try{if(s.length)return s;if(e.graphs?.forEach((e=>{if(!c.has(e.id)&&l.id!==e.id){const t=new o.TS(this);s.push(...t.load(e)),this.registerGraph(t)}})),!s.length){let t;if(a){const e=new(this._nodeTypes.get(a).type),{state:n,errors:o}=(0,h.d)(e.template);s.push(...o),t=n}else e=this.hooks.load.execute(e),t=l;s.length||s.push(...this._graph.load(t))}}catch(e){return this.cleanEditor(),this.readonly=r,[e.toString()]}if(Array.isArray(s)&&s.length)return this.cleanEditor(),this.readonly=r,s;if(this.events.loaded.emit(),this.graphName=l.name,this.readonly=r,"undefined"==typeof window||n)return s;const p=(e,t)=>{if(void 0!==e?.nodes)for(let n=0;n<e.nodes.length;n+=1)if(void 0!==e.nodes[n].subgraph){if(e.nodes[n].subgraph.id===l.id)return[...t,e.nodes[n]];const o=p(e.nodes[n].subgraph,[...t,e.nodes[n]]);if(o.length)return o}return[]},f=p(this._graph,[]);try{f.forEach((e=>{this.switchToSubgraph(e)}))}catch(e){s.push(e.toString())}return"NoLayout"!==this.layoutManager.layoutEngine.activeAlgorithm&&(await(0,i.dY)(),await this.applyAutolayout(!1)),await(0,i.dY)(),void 0!==d&&(this._graph.panning=d),void 0!==u&&(this._graph.scaling=u),t||void 0!==u||void 0!==d||this.centerZoom(),s}privatizeInterface(e,t){if(void 0===t.externalName)return;let n=[...this.graphs].find((t=>t.id===e)),o=n.graphNode;if(t.externalName=void 0,void 0===o)return;const{graphIds:a,sharedInterface:i}=v.ir.getRegisteredInterface(t.id),r=a.findIndex((e=>e===o.graph.id));a.splice(r,a.length-r),o.updateExposedInterfaces(void 0,void 0,!0);for(let e=r+1;e<a.length;e+=1)n=[...this.graphs].find((e=>e.id===a[r])),o=n.graphNode,o.updateExposedInterfaces(void 0,void 0,!0);i===t&&v.ir.deleteRegisteredInterface(t.id)}exposeInterface(e,t,n=void 0){const o=[...this.graphs].find((t=>t.id===e)),a=o.graphNode;t.externalName=n??o.resolveNewExposedName(t.name),void 0!==a&&a.updateExposedInterfaces()}getExposedProperties(){return this._graph.nodes.map((e=>Object.values(e.inputs))).flat().filter((e=>!e.port&&e.externalName))}static editorSize(){if("undefined"==typeof document)throw new Error("The editor is in browserless mode. Cannot obtain editor size.");const e=document.getElementsByClassName("terminal-wrapper")[0]?.offsetHeight??0,t=document.getElementsByClassName("wrapper")[0]?.offsetHeight??0,n=document.getElementsByClassName("baklava-node-palette");let o=0;if(0!==n.length){const e=n[0].getBoundingClientRect();o=Math.max(e.right,0)}const a=window.innerHeight-e-t;return{editorWidth:window.innerWidth-o,editorHeight:a,sideBarWidth:o}}centerZoom(){if(!Array.isArray(this._graph.nodes)||0===this._graph.nodes.length)return;if("undefined"==typeof document)throw new Error("The editor is in browserless mode. Cannot obtain editor size.");const{editorWidth:e,editorHeight:t,sideBarWidth:n}=f.editorSize(),{graphHeight:o,graphWidth:a,leftmostX:i,topmostY:r}=this._graph.size(),s=100,l=t/(o+200),d=e/(a+200);if(d>l){const t=e/2*(1/l)-(a+200)/2;this._graph.panning={x:-(i-s-t-n/l),y:-(r-s)},this._graph.scaling=l}else{const e=t/2*(1/d)-(o+200)/2;this._graph.panning={x:-(i-s-n/d),y:-(r-s-e)},this._graph.scaling=d}}nodeURLsEmpty(){return 0===this.nodeURLs.size}getNodeURLs(e){const t=this.nodeURLs.get(e)||{},n=[];return Object.entries(t).forEach((([e,t])=>{const o={...this.baseURLs.get(e)};o.url+=t,n.push(o)})),n}getNodeIconPath(e){return this.nodeIcons.get(e)||void 0}getPillText(e){const t=this.nodeTypes.get(e);return void 0!==t?.pill?t.pill?.text:void 0!==t?.style?this.getNodeStyle(t.style)?.pill?.text:void 0}getNodeCategory(e){return this.nodeTypes.get(e).category||void 0}getNodeColor(e){const t=this.nodeColors.get(e.id);if(void 0!==t)return t;const n=this.nodeTypes.get(e.type);return void 0!==n?.color?n.color:void 0!==n?.style?this.getNodeStyle(n.style)?.color:void 0}setNodeColor(e,t){void 0!==t&&this.nodeColors.set(e,t)}getStyleIcon(e){const t=this.nodeTypes.get(e);if(void 0!==t?.style)return this.getNodeStyle(t.style)?.icon}getNodeStyle(e){return Array.isArray(e)||(e=[e]),Object.assign({},...e.map((e=>this.nodeStyles.get(e))).filter((e=>void 0!==e)))}getPillColor(e){const t=this.nodeTypes.get(e),n=void 0!==t?.pill?t.pill:this.getNodeStyle(t.style).pill;if(void 0!==n)return n.color??"#ffffff"}getTextColor(e){if(!e)return"white";const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),n=parseInt(t[1],16)/255,o=parseInt(t[2],16)/255,a=parseInt(t[3],16)/255;return(Math.max(n,o,a)+Math.min(n,o,a))/2>.5?"black":"white"}isGraphNode(e){return!!this.nodeTypes.has(e)&&void 0!==this.nodeTypes.get(e).subgraphId}nodeHasRelatedGraphs(e){return void 0!==(e.relatedGraphs??this.nodeTypes.get(e.type)?.relatedGraphs)}addGraphTemplate(e,t){if(this.events.beforeAddGraphTemplate.emit(e).prevented)return;this._graphTemplates.push(e),this.graphTemplateEvents.addTarget(e.events),this.graphTemplateHooks.addTarget(e.hooks);const n=(0,h.A)(e,t);this.registerNodeType(n,{category:t.category,title:t.title,isCategory:t.isCategory,color:t.color,style:t.style,pill:t.pill,subgraphId:t.subgraphId,relatedGraphs:t?.relatedGraphs}),this.events.addGraphTemplate.emit(e)}switchGraph(e){if(void 0===this._switchGraph){const{switchGraph:e}=(0,a.uU)();this._switchGraph=e}if((0,d.$4)(!0),void 0===e.subgraph)throw Error(`Node "${e.name}" does contain a subgraph.`);this._graph=e.subgraph,this._switchGraph(e.subgraph),this.graphName=this._graph.name,(0,d.$4)(!1),(0,i.dY)().then((()=>{const e=this.graph.save();this.layoutManager.registerGraph(e),this.layoutManager.computeLayout(e).then(this.updateNodesPosition.bind(this)).then((()=>{(0,i.dY)().then((()=>{this._graph.wasCentered||(this.centerZoom(),this._graph.wasCentered=!0)}))}))}))}switchToSubgraph(e){e&&e.subgraph&&(this.subgraphStack.push(e.graph),this.switchGraph(e))}switchToGraph(e,t=!1){if(e){if(void 0===this._switchGraph){const{switchGraph:e}=(0,a.uU)();this._switchGraph=e}(0,d.$4)(!0),t?this.subgraphStack.push(this._graph):this.subgraphStack.length>0&&this.subgraphStack.pop(),this._graph=e,this._switchGraph(this._graph),this.graphName=this._graph.name,(0,i.dY)().then((()=>{const e=this.graph.save();this.layoutManager.registerGraph(e),this.layoutManager.computeLayout(e).then(this.updateNodesPosition.bind(this)).then((()=>{(0,i.dY)().then((()=>{this._graph.wasCentered||(this.centerZoom(),this._graph.wasCentered=!0)}))}))})),(0,d.$4)(!1)}}switchToRelatedGraph(e){if(this.editorManager?.baklavaView.displayedGraph.id===e)return;const t=Array.from(this.graphs).find((t=>t.id===e));this.switchToGraph(t,!0)}backFromSubgraph(){const e=this.subgraphStack.pop();(0,d.$4)(!0),this._graph=e,this._switchGraph(this._graph),this.graphName=this._graph.name,(0,d.$4)(!1)}changeTopLevelGraph(e){const t=Array.from(this.graphs).find((t=>t.id===e));this.newRootGraph=t}findInterface(e){for(let t=0;t<this.graph.nodes.length;t+=1){const n=Object.values(this.graph.nodes[t].inputs).concat(Object.values(this.graph.nodes[t].outputs)).find((t=>t.id===e));if(n)return n}return null}unwrapSubgraph(e){const t=Object.values(e.subgraph._nodes),n=t.map((e=>e.position.x)).reduce(((e,t)=>e+t),0)/t.length,o=t.map((e=>e.position.y)).reduce(((e,t)=>e+t),0)/t.length;this.graph.selectedNodes=[],t.forEach((t=>{const a=t.save(),i=this.graph.addNode(t);i&&(i.position.x+=e.position.x-n,i.position.y+=e.position.y-o,this.graph.selectedNodes.push(i),Object.values(i.inputs).concat(Object.values(i.outputs)).forEach((e=>{e.connectionCount=0})),i.load(a))}));const a=this.graph.connections.filter((t=>t.from.nodeId===e.id||t.to.nodeId===e.id));this.graph.removeNode(e),Object.values(e.subgraph.connections).concat(a).forEach((t=>{if("Connection"===t.from.name||"Connection"===t.to.name)return;const a=this.findInterface(t.from.id),i=this.findInterface(t.to.id);if(a&&i){const r=this.graph.addConnection(a,i);(t.anchors??[]).forEach(((a,i)=>{let s;s=e.subgraph.connections.includes(t)?{x:a.x+e.position.x-n,y:a.y+e.position.y-o}:{x:a.x,y:a.y},this.graph.addAnchor(s,r,i)}))}}))}isInSubgraph(){return this.subgraphStack.length>0}async applyAutolayout(e=!0){const t=this.graph.save();e&&t.nodes.forEach((e=>{e.position=void 0})),this.layoutManager.registerGraph(t);const n=await this.layoutManager.computeLayout(t);this.updateNodesPosition(n)}updateNodesPosition(e){e.nodes.forEach((e=>{this.graph.nodes.filter((t=>e.id===t.id))[0].position=e.position}))}updateCurrentSubgraphName(e){this._graph.name=e}}},53701:(e,t,n)=>{n.d(t,{A:()=>h});var o=n(20641),a=n(53751),i=n(90033);const r={ref:"el"},s=["href"],l={class:"link_item"},d=["src"];var u=n(50953),c=n(63491);const p=(0,o.pM)({props:{node:{required:!0}},setup(e){const t=(0,u.KR)(null),{viewModel:n}=(0,c.if)();return{el:t,getIconPath:e=>n.value.cache[`./${e}`]??e,nodeRef:(0,u.KR)(e.node)}}}),h=(0,n(66262).A)(p,[["render",function(e,t,n,u,c,p){return(0,o.uX)(),(0,o.Wv)(a.eB,{name:"slide-fade"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",r,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.nodeRef.URLs,(n=>((0,o.uX)(),(0,o.CE)("a",{key:n.name,href:n.url,class:"__url",target:"_blank",draggable:"false",onPointerdown:t[0]||(t[0]=(0,a.D$)((()=>{}),["left","stop"]))},[(0,o.Lk)("div",l,[void 0!==n.icon?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.getIconPath(n.icon),draggable:"false"},null,8,d)):(0,o.Q3)("",!0),(0,o.Lk)("span",null,(0,i.v_)(n.name),1),t[1]||(t[1]=(0,o.Lk)("br",null,null,-1))])],40,s)))),128))],512)])),_:1})}],["__scopeId","data-v-28f02260"]])},54570:(e,t,n)=>{n.d(t,{A:()=>H});var o=n(20641),a=n(53751),i=n(90033);const r={key:0,class:"__content"},s={class:"__header"},l=["src"],d={class:"__node-name"},u=["href","onPointerover"],c=["src","alt"],p={key:0,class:"__id"},h={class:"__value"},v={key:0,class:"__title"},f={key:1,class:"__value"},g={class:"__category"},m={class:"__category-name"},y={key:1,class:"__replace"},b={key:0,class:"__replace_entry"},w={key:1,class:"__replace_entry"},E={key:2,class:"__replace_entry"},_={key:2,class:"__properties"},C={class:"__property-name"},k={class:"__markdown-content"},N=["innerHTML"],x={key:3,class:"__interface_groups"},A={class:"__group-assign"},I={class:"__error_outputs"};var S=n(50953),P=n(63491),L=n(41552),T=n.n(L),R=n(4636),W=n(1691),M=n(3972),O=n(34580),$=n(14121),G=n(96422),D=n(30001);const X=(0,o.pM)({components:{Cross:W.A,CustomInterface:R.A,CheckboxInterface:P.b,NodeSpecificationEditor:D.A,Tooltip:M.A},emits:["sidebar-open"],setup(e,{emit:t}){const n=O.Ay.getEditorManagerInstance(),a=(0,o.EW)((()=>n.baklavaView)),i=(0,o.EW)((()=>a.value.displayedGraph)),r=new(T().Converter)({smartIndentationFix:!0,simpleLineBreaks:!0}),s=(0,S.KR)(300),l=(0,o.EW)((()=>{const e=i.value.sidebar.nodeId;return i.value.nodes.find((t=>t.id===e))})),d=(0,o.EW)((()=>i.value.editor.nodeTypes.get(l.value.type).category)),u=(0,o.EW)((()=>`${d.value.split(/(?<!\\)\//).map((e=>e.replace("\\/","/"))).join(" / ")}`)),c=(0,o.EW)((()=>i.value.editor.nodeTypes.get(l.value.type).subgraphId)),p=(0,o.EW)((()=>{let e=r.makeHtml(l.value?.description??"");return e.match(/<a href="[a-zA-Z0-9-$_.+!*'()/&?=:%]+">/gm)?.forEach((t=>{const n=t.split('"'),o=` tabindex="-1" target="_blank"${n[2]}`,a=[n[0],n[1],o].join('"');e=e.replace(t,a)})),e})),h=(0,o.EW)((()=>a.value.editor.getNodeIconPath(l.value?.type))),v=(0,o.EW)((()=>a.value.editor.getNodeURLs(l.value?.type))),f=e=>a.value.cache[`./${e}`]??e,g=(0,o.EW)((()=>f(h.value))),m=(0,o.EW)((()=>i.value.sidebar.visible));(0,o.wB)(l,(()=>{void 0===l.value&&(i.value.sidebar.visible=!1)})),(0,o.wB)(m,(e=>{e&&t("sidebar-open")}));const y=(0,S.KR)(null),b=(0,S.KR)(null),w=(0,S.KR)(null);b.value={top:0,left:0,visible:!1,text:""};const E=(0,o.EW)((()=>({width:`${s.value}px`}))),_=e=>{e.preventDefault(),s.value-=e.movementX},C=(0,o.EW)((()=>Object.values(l.value.inputs).filter((e=>!e.port)))),k=(0,o.EW)((()=>Object.values({...l.value.inputs,...l.value.outputs}).filter((e=>void 0!==e.interfaces)))),N=(0,S.KR)(""),x=(0,o.EW)((()=>({"--disabled":""!==N.value}))),A=(0,o.EW)((()=>{const e=(0,S.KR)([]);return i.value.sidebar.visible,k.value.forEach((t=>{const n=new P.b(t.name,!t.hidden).setPort(!1);n.events.setValue.subscribe(this,(()=>{const e=(0,$.Sb)(I.value,l.value.inputs,l.value.outputs);e.length?N.value=e.map((([e,t,n])=>`Reused ${t} - ${e} for interface group ${n}`)):N.value=""})),n.componentName="CheckboxInterface",n.intfG=t,e.value.push(n)})),e.value})),I=(0,o.EW)((()=>{const e=[];return A.value.forEach((t=>{t.value&&e.push(`${t.intfG.direction}_${t.intfG.name}`)})),e})),L=(0,o.EW)((()=>{const e=new P.aw("Assign",(()=>{A.value.forEach((e=>{l.value.toggleInterfaceGroup(e.intfG,e.value)})),N.value=""}));return e.componentName="ButtonInterface",e})),R=e=>{const t=(0,S.KR)([]);return(e??[]).forEach((e=>{const o=new P.aw(e,(()=>{if(n.baklavaView.editor.parentNodes.has(e)){const t=i.value.replaceNode(l.value,e);i.value.sidebar.nodeId=t.id}}));o.componentName="ButtonInterface",t.value.push(o)})),t.value},W=(0,o.EW)((()=>{const e=new Set;return(l.value.extends??[]).forEach((t=>{const o=n.baklavaView.editor.parentNodes.get(t);void 0!==o&&o.extending?.forEach((t=>e.add(t)))})),e.delete(l.value.type),Array.from(e)})),M=(0,o.EW)((()=>R(l.value.extends))),D=(0,o.EW)((()=>R(l.value.extending))),X=(0,o.EW)((()=>R(W.value))),H=(0,o.EW)((()=>""===l.value.title||void 0===l.value.title?l.value.type:l.value.title));return{graph:i,node:l,styles:E,startResize:()=>{s.value=w.value.offsetWidth,window.addEventListener("mousemove",_),window.addEventListener("mouseup",(e=>{e.preventDefault(),window.removeEventListener("mousemove",_)}),{once:!0})},close:()=>{i.value.sidebar.visible=!1},displayedProperties:C,interfaceGroups:k,interfaceGroupsCheckboxes:A,interfaceGroupsButton:L,interfaceGroupsOutput:N,interfaceGroupsButtonClasses:x,nodeIconPath:g,nodeURLs:v,getIconPath:f,desc:p,tooltip:b,onPointerOver:(e,t)=>{b.value.text=e,b.value.visible=!0,(0,o.dY)().then((()=>{const e=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2+y.value.$el.clientWidth;b.value.top=t.clientY-t.offsetY+t.currentTarget.offsetHeight,e>window.innerWidth?b.value.left=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2-y.value.$el.clientWidth/2:b.value.left=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2}))},onPointerLeave:()=>{b.value.visible=!1},tooltipRef:y,sidebarRef:w,toggleGroup:e=>{e.group.forEach((t=>{l.value.inputs[t].hidden=!e.value}))},getOptionName:G.BW,prettyCategory:u,replacementParents:M,replacementChildren:D,replacementSiblings:X,editorManager:n,displayedName:H,updateDynamicInterfaces:e=>{l.value.updateDynamicInterfaces(e)},subgraphId:c}}}),H=(0,n(66262).A)(X,[["render",function(e,t,n,S,P,L){const T=(0,o.g2)("Tooltip"),R=(0,o.g2)("Cross"),W=(0,o.g2)("CustomInterface"),M=(0,o.g2)("NodeSpecificationEditor");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bo)((0,o.bF)(T,{ref:"tooltipRef",left:e.tooltip.left,top:e.tooltip.top,text:e.tooltip.text},null,8,["left","top","text"]),[[a.aG,e.tooltip.visible]]),(0,o.Lk)("div",{class:(0,i.C4)(["baklava-sidebar prevent-select",{"--open":e.graph.sidebar.visible,"--hidehud":e.editorManager.editor.hideHud,"--preview":e.editorManager.editor.preview,"hidden-navbar":e.$isMobile}]),ref:"sidebarRef",style:(0,i.Tr)(e.styles)},[(0,o.Lk)("div",{class:"__resizer",onMousedown:t[0]||(t[0]=(...t)=>e.startResize&&e.startResize(...t))},null,32),e.node?((0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("div",s,[(0,o.bF)(R,{tabindex:"-1",class:"__close",onClick:e.close},null,8,["onClick"]),void 0!==e.nodeIconPath?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__node-icon",src:e.nodeIconPath},null,8,l)):(0,o.Q3)("",!0),(0,o.Lk)("div",d,(0,i.v_)(e.displayedName),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.nodeURLs,(n=>((0,o.uX)(),(0,o.CE)("a",{key:n.name,href:n.url,class:"__url",target:"_blank",draggable:"false",onPointerover:t=>e.onPointerOver(n.name,t),onPointerleave:t[1]||(t[1]=(...t)=>e.onPointerLeave&&e.onPointerLeave(...t)),tabindex:"-1"},[void 0!==n.icon?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.getIconPath(n.icon),alt:n.name,draggable:"false"},null,8,c)):(0,o.Q3)("",!0)],40,u)))),128))]),e.editorManager.baklavaView.settings.showIds?((0,o.uX)(),(0,o.CE)("div",p,[t[2]||(t[2]=(0,o.Lk)("div",{class:"__title"},"Node ID",-1)),(0,o.Lk)("div",h,(0,i.v_)(e.node.id),1),e.subgraphId?((0,o.uX)(),(0,o.CE)("div",v,"Subgraph ID")):(0,o.Q3)("",!0),e.subgraphId?((0,o.uX)(),(0,o.CE)("div",f,(0,i.v_)(e.subgraphId),1)):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",g,[t[3]||(t[3]=(0,o.Lk)("div",{class:"__title"},"Category",-1)),(0,o.Lk)("div",m,(0,i.v_)(e.prettyCategory),1)],512),[[a.aG,e.prettyCategory]]),e.editorManager.editor.readonly?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",y,[e.replacementParents.length?((0,o.uX)(),(0,o.CE)("div",b,[t[4]||(t[4]=(0,o.Lk)("div",{class:"__replace_title"},"Generalize:",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.replacementParents,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"__replace_button"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.Q3)("",!0),e.replacementChildren.length?((0,o.uX)(),(0,o.CE)("div",w,[t[5]||(t[5]=(0,o.Lk)("div",{class:"__replace_title"},"Specialize:",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.replacementChildren,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"__replace_button"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.Q3)("",!0),e.replacementSiblings.length?((0,o.uX)(),(0,o.CE)("div",E,[t[6]||(t[6]=(0,o.Lk)("div",{class:"__replace_title"},"Choose other type:",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.replacementSiblings,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"__replace_button"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.Q3)("",!0)])),e.displayedProperties.length?((0,o.uX)(),(0,o.CE)("div",_,[t[7]||(t[7]=(0,o.Lk)("div",{class:"__title"},"Properties",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.displayedProperties,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:"__property"},[(0,o.Lk)("div",C,(0,i.v_)(e.getOptionName(t.componentName)?`${t.name}:`:""),1),(0,o.bF)(W,{node:e.node,intf:t,toggleGroup:e.toggleGroup,updateDynamicInterfaces:e.updateDynamicInterfaces,sidebar:"true",tabindex:"-1"},null,8,["node","intf","toggleGroup","updateDynamicInterfaces"])])))),128))])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",null,[t[8]||(t[8]=(0,o.Lk)("div",{class:"__title"}," Description ",-1)),(0,o.Lk)("div",k,[(0,o.Lk)("span",{innerHTML:e.desc,class:"node_description"},null,8,N)])],512),[[a.aG,e.desc]]),e.interfaceGroupsCheckboxes.length>0&&!e.editorManager.editor.readonly?((0,o.uX)(),(0,o.CE)("div",x,[t[9]||(t[9]=(0,o.Lk)("div",{class:"__title"},"Interface Groups",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.interfaceGroupsCheckboxes,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"__group"},[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.component),{intf:e},null,8,["intf"]))])))),128)),(0,o.Lk)("div",A,[((0,o.uX)(),(0,o.Wv)((0,o.$y)(e.interfaceGroupsButton.component),{intf:e.interfaceGroupsButton,class:(0,i.C4)(e.interfaceGroupsButtonClasses),tabindex:"-1"},null,8,["intf","class"]))])])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",I,[t[10]||(t[10]=(0,o.Lk)("div",{class:"__title"},"Conflicts:",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.interfaceGroupsOutput,(e=>((0,o.uX)(),(0,o.CE)("p",null,(0,i.v_)(e),1)))),256))],512),[[a.aG,e.interfaceGroupsOutput.length]]),(0,o.bF)(M,{node:e.node,scrollHandle:e.sidebarRef},null,8,["node","scrollHandle"])])):(0,o.Q3)("",!0)],6)],64)}],["__scopeId","data-v-f928b04a"]])},70380:(e,t,n)=>{n.d(t,{A:()=>u,d:()=>d});var o=n(46171),a=n(42302),i=n(14121),r=n(96422),s=n(8239),l=n(57565);function d(e,{graphLoadingState:t,newSubgraphNodeId:n,mode:o}={}){o??="resolved";const i=[];if(e.nodes.some((e=>void 0!==e.subgraph&&void 0===e.id))&&i.push("Node defining a nested graph in a subgraph template should have their own ID"),i.length)return{errors:i};const r=void 0===t;t??={newToSpecNodeIds:new Map,newInterfaceIds:new Map,newToSpecConnIds:new Map,newToSpecIntfIds:new Map};const{newToSpecNodeIds:s}=t,l=s.get(n),d=e=>{const t=(0,a.A)();return e.id&&s.set(t,e.id),t},u=e.connections.map((e=>{const n=(0,a.A)();return e.id&&t.newToSpecConnIds.set(n,e.id),{...e,id:n}})),{newInterfaceIds:c}=t,p=(e,t,n=a.A)=>(e.has(t)||e.set(t,n()),e.get(t)),h=(e,n)=>{const i=("resolved"===o?Object.values(n.inputs).concat(Object.values(n.outputs)):n.interfaces).find((t=>t.id===e)),s=((e,t)=>{const n=void 0!==e.subgraph?e.id:l,o=p(c,n,(()=>new Map)),i=void 0===e.subgraph&&void 0===t.externalName,s=!(r||void 0===t.externalName||void 0!==l&&o.has(t.externalName));return i||s?(0,a.A)():p(o,t.externalName??t.name)})(n,i);return i.id&&t.newToSpecIntfIds.set(s,i.id),u.filter((t=>t.from===e)).forEach((e=>{e.from=s})),u.filter((t=>t.to===e)).forEach((e=>{e.to=s})),s},v=(e,t)=>({...e,id:h(e.id,t)}),f=(e,t)=>Object.entries(e).reduce(((e,[n,o])=>({...e,[n]:v(o,t)})),{}),g="resolved"===o?e=>({...e,inputs:f(e.inputs,e),outputs:f(e.outputs,e)}):e=>({...e,interfaces:e.interfaces.map((t=>v(t,e)))});return{state:{id:(0,a.A)(),name:e.name,nodes:e.nodes.map(g).map((e=>({...e,id:d(e)}))),connections:u,graphLoadingState:t},errors:i}}function u(e,t){const[n,a]=function(e){const t=e.interfaces??[],n=(0,i.Cy)(t,[],[]);return Array.isArray(n)&&n.length?n.map((t=>`Node ${e.name} invalid. ${t}`)):(0,s.j4)(n)}(t),u=function(e){const t=e.properties??[],n=(0,s.$9)(t);return Array.isArray(n)&&n.length?n.map((t=>`Node ${e.name} invalid. ${t}`)):(0,s.eC)(n)}(t),c={...n,...u};return class extends s.y5{type=t.name;title=t.name;template=e;nodeInterfaces={...c,...a};constructor(){super(t.name,t.layer,c,a,t.twoColumn??e.editor.editorManager.baklavaView.twoColumn??!1,t.description??"",t.extends??[],t.extending??[],t.siblings??[],t.width??300,t.relatedGraphs)}save(){const e=super.save();return e.subgraph=this.subgraph.id,e.graphState=this.subgraph.save(),e}load(e){this.hooks.beforeLoad.execute(e);const t=(0,i.Cy)(e.interfaces??[],[],[]);if(Array.isArray(t)&&t.length)return t;let{inputs:n,outputs:o}=t;if(n=Object.values(n),o=Object.values(o),void 0!==e.graphState){delete e.graphState.interfaces,delete e.subgraph;const t=this.subgraph.load(e.graphState);if(t.length)return t}this.updateExposedInterfaces(n,o),this.position=e.position,this.title=e.instanceName??"";const a=super.load(e);return this.events.loaded.emit(this),a}updateExposedInterfaces(e=void 0,t=void 0,n=!1){const o=(0,s.Sx)(this.subgraph.nodes,e??Object.values(this.inputs),t??Object.values(this.outputs));if(Array.isArray(o)&&o.length)throw new Error(`Internal error occurred while exposing an interface.\nReason: ${o.join(". ")}`);const a=(0,s.fk)(this.subgraph.nodes,e??Object.values(this.inputs));this.updateInterfaces(o.inputs,o.outputs,n),this.updateProperties(a)}onPlaced(e,t){this.initialize(e,t)}initialize(e,t){this.subgraph&&this.subgraph.destroy();const n=new o.TS(this.template.editor),{state:a,errors:i}=d(this.template,{graphLoadingState:e,newSubgraphNodeId:t});if(i.length||i.push(...n.load(a)),i.length)throw new Error(`Internal error occurred while initializing ${n.type} graph. Reason: ${i.join(". ")}`);n.template=this.template,this.subgraph=n,n.graphNode=this,this.updateExposedInterfaces([],[]),this._title=this.template.name,this.events.update.emit(null)}privatizeInterfaces(e,t){Object.entries(t).forEach((([t,n])=>{if(void 0===e.find((e=>e.id===n.id))&&!Object.keys(this.nodeInterfaces).some((e=>e===t))){const e="output"===n.direction?"output":"input";this.removeInterface(e,t)}}))}updateInterfaces(e,t,n=!1){const a=[...e,...t],i={...this.inputs,...this.outputs};n&&this.privatizeInterfaces(a,i),a.forEach((e=>{const t=Object.values(i).find((t=>t.id===e.id));if(void 0===t){const t=new o.gZ(e.name);Object.assign(t,e),l.ir.pushGraphIdToRegistry(t.id,this.subgraph.id),l.ir.createSharedInterface(t);const n="output"===e.direction?"output":"input";this.addInterface(n,`${e.direction}_${e.name}`,t)}else Object.assign(t,e)})),Object.values(i).forEach((e=>{(0,r.q6)(this,e,e.side,void 0,!1,!1)}))}updateProperties(e,t=!1){t&&this.privatizeInterfaces(e,this.inputs),e.forEach((e=>{const t=Object.values(this.inputs).find((t=>t.id===e.id));if(void 0===t){const t=(0,s.gv)(e);Object.assign(t,e),this.addInput(`property_${e.name}`,t)}else Object.assign(t,e)}))}}}},91031:(e,t,n)=>{n.d(t,{A:()=>ne});var o=n(20641),a=n(90033),i=n(53751);const r={class:"selection-container"};var s=n(63491),l=n(50953),d=n(15531),u=n.n(d),c=n(34250),p=n(13773),h=n(92125),v=n(46171),f=n(42838),g=n.n(f),m=n(5828),y=n(4636),b=n(13700),w=n(45825),E=n(49617),_=n(41426),C=n(96422),k=n(41857),N=n(34580),x=n(93617),A=n(323),I=n(8328);const S=["id","data-node-type"],P={class:"interface-cursor"},L=["src"],T=["innerHTML"],R=["src"],W=["innerHTML"],M={class:"__properties"},O=["onPointerdown"],$={class:"__interfaces"},G={key:1,class:"baklava-node-interface --output"},D={key:1,class:"baklava-node-interface --input"},X={__name:"CustomNode",props:{node:v.hZ,selected:Boolean,greyedOut:Boolean,hidden:Boolean,interfaces:Array},emits:["select"],setup(e,{emit:t}){const n=e,r=t,{viewModel:d}=(0,s.if)(),{graph:u}=(0,s.uU)(),c=(0,o.EW)((()=>d.value.movementStep)),p=(0,l.KR)(null),h=(0,l.KR)(null),v=(0,l.KR)(!1),f=(0,l.KR)(null),X=(0,l.KR)(""),H=(0,l.lW)(n,"node"),j=d.value.editor.getNodeURLs(n.node.type),U=(0,o.EW)((()=>d.value.editor.getNodeColor(H.value))),V=(0,o.EW)((()=>d.value.editor.getTextColor(U.value))),K=d.value.editor.getNodeCategory(n.node.type),F=d.value.editor.isGraphNode(n.node.type),B=(0,o.EW)((()=>d.value.editor.nodeHasRelatedGraphs(H.value))),z=(0,o.EW)((()=>d.value.editor.getPillText(H.value.type))),Q=(0,o.EW)((()=>d.value.editor.getPillColor(H.value.type))),Y=(0,o.EW)((()=>d.value.editor.getTextColor(Q.value))),q=!d.value.editor.nodeURLsEmpty(),Z=N.Ay.getEditorManagerInstance(),J=(0,o.EW)((()=>Object.values(n.node.inputs).filter((e=>!e.hidden)))),ee=(0,o.EW)((()=>Object.values(n.node.outputs).filter((e=>!e.hidden)))),te=(0,o.EW)((()=>Object.values(J.value).filter((e=>!e.port)))),ne=(0,o.EW)((()=>Z.baklavaView.settings.showHiddenProperties?te.value:te.value.filter((e=>!(e.hideOnDefault&&(!e.value||e.value===e.default)))))),oe=(0,A.A)();Object.entries(n.node.inputs).forEach((([e,t])=>{if(e.startsWith("property_")){let e=!0;(0,o.wB)(t,(async t=>{if(!oe.isConnected())return void(e=!0);if(e||!Z.notifyWhenChanged)return void(e=!1);const o={graph_id:n.node.graphInstance.id,node_id:n.node.id,properties:[]};o.properties.push({id:t.id,new_value:t.value}),await oe.notifyAboutChange("properties_on_change",o)}))}})),(0,o.wB)(n.node.position,(e=>{oe.isConnected()&&oe.notifyAboutChange("position_on_change",{graph_id:n.node.graphInstance.id,node_id:n.node.id,position:{x:e.x,y:e.y}})}));const ae=(0,l.KR)(!1),ie=(0,l.KR)(0),re=(0,l.KR)(0),se=(0,l.KR)("hidden"),le=(0,l.KR)(0),de=(0,o.EW)((()=>({"transform-origin":"0 0",transform:`scale(${1/u.value.scaling})`,visible:se.value}))),ue=(0,o.EW)((()=>{const e=[];if(e.push({value:"sidebar",label:"Details",icon:E.A.Sidebar,endSection:!0}),Z.baklavaView.settings.editableNodeTypes&&H.value.type!==N.dH&&!d.value.editor.readonly&&(e.push({value:"configure",label:"Configure"},{value:"property",label:"Add property"},{value:"interface",label:"Add interface"},{value:"layer",label:"Set layer"},{value:"delete-property",label:"Delete property"},{value:"delete-interface",label:"Delete interface",endSection:!0}),F||Z.editor.preview||e.push({value:"addSubgraph",label:"Add subgraph",icon:E.A.Subgraph},{value:"addAndEditSubgraph",label:"Add and edit subgraph",icon:E.A.Subgraph})),F&&e.push({value:"editSubgraph",label:"Go to graph",icon:E.A.Subgraph}),B.value){const t=H.value,o=d.value.editor.nodeTypes.get(n.node.type),a=e=>e?.map((({id:e,name:t})=>[e,t]))??[];Object.entries({...Object.fromEntries(a(o.relatedGraphs)),...Object.fromEntries(a(t.relatedGraphs))}).forEach((([t,n])=>{e.push({value:`gotoRelatedGraph ${t}`,label:`Go to ${n} graph`,icon:E.A.Subgraph})}))}return e.length>1&&(e.at(-1).endSection=!0),e.push(...j),d.value.editor.readonly||(e.length>1&&(e.at(-1).endSection=!0),e.push({value:"rename",label:"Rename",icon:E.A.Pencil},{value:"disconnect",label:"Disconnect",icon:E.A.Disconnect},{value:"delete",label:"Delete",icon:E.A.Bin})),e})),ce=()=>{const{sidebar:e}=d.value.displayedGraph;e.nodeId=n.node.id,e.visible=!0},pe=async e=>{if("delete"!==e&&"disconnect"!==e){const e={name:n.node.type,category:K,layer:n.node.layer,color:U};I.c.editedType=e.name,I.c.nodeData=e;let t=[...J.value,...ee.value];t=t.filter((e=>void 0!==e.direction));const o=t?.map((e=>({name:e?.name,type:e?.type,direction:e?.direction,maxConnectionsCount:e?.maxConnectionsCount}))),a=te.value,i=a?.map((e=>({name:e?.name,type:e?.type,default:e?._value,min:e?.min,max:e?.max,values:e?.items,step:e?.step,readonly:e?.readonly,dtype:e?.dtype})));I.c.properties=i,I.c.interfaces=o}const t={name:n.node.type,category:K,layer:n.node.layer};switch(e.includes("gotoRelatedGraph")&&d.value.editor.switchToRelatedGraph(e.replace(/^gotoRelatedGraph /,"")),e){case"delete":(0,k.nb)(),u.value.selectedNodes.includes(n.node)||u.value.selectedNodes.push(n.node),u.value.selectedNodes.forEach((e=>(0,C.bf)(e))),u.value.selectedNodes=[],(0,k.wH)();break;case"rename":X.value=n.node.title,v.value=!0,await(0,o.dY)(),f.value.focus(),f.value.select();break;case"disconnect":{(0,k.nb)();let e=[...J.value,...ee.value];u.value.selectedNodes.forEach((t=>{e=e.concat(Object.entries(t.inputs).filter((([e,t])=>!t.hidden&&!e.startsWith("property_"))).map((([,e])=>e)),Object.values(t.outputs).filter((e=>!e.hidden)))})),u.value.connections.filter((t=>void 0!==e.find((e=>e===t.from||e===t.to)))).forEach((e=>{u.value.removeConnection(e)})),(0,k.wH)()}break;case"sidebar":ce();break;case"editSubgraph":{const e=d.value.editor.switchToSubgraph(n.node);Array.isArray(e)&&e.length&&x.A.terminalLog("error","Dataflow is invalid",e);break}case"unwrap":(0,k.nb)(),(0,C.bf)(n.node,!0),(0,k.wH)();break;case"configure":I.x.configurationMenu.visible=!0,I.x.configurationMenu.addNode=!1,I.c.nodeData=t;break;case"property":I.x.propertyMenu=!0;break;case"interface":I.x.interfaceMenu=!0;break;case"layer":I.x.layerMenu=!0;break;case"addSubgraph":{const e=Z.addSubgraphToNode(n.node);Array.isArray(e)&&e.length&&x.A.terminalLog("error","Creating subgraph failed",e);break}case"addAndEditSubgraph":{let e=Z.addSubgraphToNode(n.node);Array.isArray(e)&&e.length&&x.A.terminalLog("error","Creating subgraph failed",e);const t=d.value.displayedGraph.nodes.filter((e=>e.type===n.node.type))[0];e=d.value.editor.switchToSubgraph(t),Array.isArray(e)&&e.length&&x.A.terminalLog("error","Switching to subgraph failed",e);break}case"delete-property":I.x.propertyListMenu=!0;break;case"delete-interface":I.x.interfaceListMenu=!0}},he=e=>{const t=le.value+e.height+200-window.innerHeight;t>0&&(re.value-=t),se.value="visible"},ve=(0,o.EW)((()=>0===ue.value.length&&q||ue.value.length>0)),fe=(0,l.KR)(!1),ge=(0,l.KR)(!1),me=e=>{if(ve.value&&!1===ae.value&&!1===fe.value&&!1===ge.value){ae.value=!0;const t=e.currentTarget;ie.value=e.offsetX,re.value=e.offsetY+t.offsetTop+20,le.value=e.clientY}},ye=(0,m.A)((0,l.lW)(n.node,"position"),n.node.id,(0,w.i)(c)),be=(0,o.EW)((()=>({"--selected":n.selected,"--dragging":ye.dragging.value,"--two-column":!!n.node.twoColumn,"--greyed-out":n.greyedOut,"--hidden":n.hidden,__readonly:d.value.editor.readonly}))),we=(0,o.EW)((()=>({top:`${n.node.position?.y??0}px`,left:`${n.node.position?.x??0}px`,width:`${n.node.width??300}px`}))),Ee=(0,o.EW)((()=>{const e=n.node.highlightedTitle??n.node.title,t=n.node.highlightedType??n.node.type;return""===e||n.node.title===n.node.type?t:`${e} <pre class="subtitle">${t}</pre>`})),_e=e=>{r("select",e)};let Ce,ke;const Ne=()=>{document.removeEventListener("pointermove",ye.onPointerMove),document.removeEventListener("keyboard.escape",Ce),document.removeEventListener("pointerup",ke)};Ce=()=>{Ne()},ke=()=>{ye.onPointerUp(),Ne()};const xe=()=>{u.value.findNodeById(n.node.id).title=X.value,v.value=!1},Ae=()=>{p.value&&d.value.hooks.renderNode.execute({node:n.node,el:p.value})};(0,o.sV)(Ae),(0,o.$u)(Ae);const Ie=(0,_.A)(700,(()=>{ce()})),Se=()=>{const{sidebar:e}=d.value.displayedGraph;e.visible&&(e.nodeId=n.node.id),Ie()},Pe=(0,o.EW)((()=>Object.values([...J.value,...ee.value]).filter((e=>"left"===e.side&&e.port)).sort(((e,t)=>e.sidePosition-t.sidePosition)))),Le=(0,o.EW)((()=>Object.values([...J.value,...ee.value]).filter((e=>"right"===e.side&&e.port)).sort(((e,t)=>e.sidePosition-t.sidePosition)))),Te=e=>{if(!e.length)return[];const t=e.map((e=>e.sidePosition??0)),n=Math.max(...t);let o=0;const a=[];for(let t=0;t<=n;t+=1)e[o]?.sidePosition===t?(a.push(e[o]),o+=1):a.push(void 0);return a},Re=(0,o.EW)((()=>Te(Le.value))),We=(0,o.EW)((()=>Te(Pe.value)));(0,o.wB)(te,(()=>{te.value.forEach((e=>{void 0!==e.setDefaultComponent&&e.setDefaultComponent()}))}),{immediate:!0});const Me=d.value.editor.getNodeIconPath(n.node.type),Oe=d.value.cache[`./${Me}`]??Me,$e=(0,o.EW)((()=>{let e,t=d.value.editor.getStyleIcon(H.value.type);return"object"==typeof t&&null!==t&&(t=Z.getMetadataIcon(t)),void 0!==E.A[t]?e=E.A[t]:void 0!==d.value.cache[`./${t}`]&&(e=E.A.Placeholder,t=d.value.cache[`./${t}`]),{icon:e,name:t}}));let Ge,De,Xe;const He=(0,l.KR)(null),je=(0,l.KR)(null),Ue=(0,l.KR)({top:"0px",left:"0px",display:"none"}),Ve=(0,o.EW)((()=>d.value.editor.readonly?ve.value?{cursor:"pointer",backgroundColor:U.value,color:V.value}:{cursor:"default",backgroundColor:U.value,color:V.value}:{cursor:"drag",backgroundColor:U.value,color:V.value})),Ke=(0,o.EW)((()=>({cursor:"default",backgroundColor:Q.value,color:Y.value}))),Fe=e=>e===De,Be=e=>{let t;"right"===De.side?t=je.value:"left"===De.side&&(t=He.value);let n=[...t.children].findIndex((t=>t.getBoundingClientRect().bottom>e.clientY));Ge=n,-1===n&&(n=t.children.length-1,Ge=t.children.length-1);const o=t.children[n];Ue.value={top:o.offsetTop+o.offsetHeight/2-2.5+"px",display:"block"},"right"===De.side?Ue.value.right="-0.7em":"left"===De.side&&(Ue.value.left="-0.7em")},ze=()=>{(0,C.q6)(n.node,De,De.side,Ge,!0),De=void 0,Ue.value={top:"0px",left:"0px",right:"0px",display:"none"},document.removeEventListener("pointermove",Be),document.removeEventListener("pointerup",ze)},Qe=(e,t)=>{De=e,Be(t),document.addEventListener("pointermove",Be),document.addEventListener("pointerup",ze)},Ye=(0,l.KR)(0),qe=(0,l.KR)(0),Ze=()=>{const e=[];if(void 0!==De){const t=void 0===De.externalName?{value:"SetExternalName",label:"Expose Interface",icon:E.A.Subgraph}:{value:"UnsetExternalName",label:"Privatize Interface",icon:E.A.Subgraph};e.push(t)}return e.push({value:"SpaceUp",label:"Space Up"},{value:"SpaceDown",label:"Space Down"},{value:"MoveUp",label:"Move Up"},{value:"MoveDown",label:"Move Down"}),e},Je=(0,l.KR)(Ze()),et=e=>{switch(e){case"SetExternalName":d.value.editor.exposeInterface(u.value.id,De);break;case"UnsetExternalName":d.value.editor.privatizeInterface(u.value.id,De);break;case"MoveUp":if(0===De.sidePosition){De=void 0;break}Ge=De.sidePosition-1,ze();break;case"MoveDown":Ge=De.sidePosition+1,ze();break;case"SpaceUp":case"SpaceDown":{const t="right"===De.side?Re.value:We.value,n="SpaceDown"===e?(e,t)=>e>t:(e,t)=>e>=t;Object.values(t).forEach((e=>{void 0!==e&&n(e.sidePosition,De.sidePosition)&&(e.sidePosition+=1)}));break}}},tt=(e,t)=>{d.value.editor.readonly||!1!==fe.value||(De=e,Je.value=Ze(),"right"===De.side?(Ye.value=t.currentTarget.offsetLeft+162.5,qe.value=t.currentTarget.offsetTop+12.5):"left"===De.side&&(Ye.value=t.currentTarget.offsetLeft-t.currentTarget.offsetWidth+162.5,qe.value=t.currentTarget.offsetTop+12.5),fe.value=!0)};(0,o.wB)(fe,(()=>{!1===fe.value&&(De=void 0)}));const nt=e=>{e.group.forEach((t=>{n.node.inputs[t].hidden=!e.value}))},ot=e=>{n.node.updateDynamicInterfaces(e)},at=e=>{"left"===e.side?(0,C.q6)(n.node,e,"right"):(0,C.q6)(n.node,e,"left")},it=(0,l.KR)(0),rt=(0,l.KR)(0),st=()=>{const e=[];if(void 0!==Xe){const t=void 0===Xe.externalName?{value:"SetExternalName",label:"Expose Property",icon:E.A.Subgraph}:{value:"UnsetExternalName",label:"Privatize Property",icon:E.A.Subgraph};e.push(t)}return e},lt=(0,l.KR)(st()),dt=e=>{switch(e){case"SetExternalName":d.value.editor.exposeInterface(u.value.id,Xe);break;case"UnsetExternalName":d.value.editor.privatizeInterface(u.value.id,Xe)}};return(0,o.wB)(ge,(()=>{!1===ge.value&&(Xe=void 0)})),(e,t)=>{const r=(0,o.gN)("click-outside"),s=(0,o.gN)("long-press"),c=(0,o.gN)("long-press-to-right");return(0,o.uX)(),(0,o.CE)("div",{id:H.value.id,ref_key:"nodeRef",ref:p,class:(0,a.C4)(["baklava-node",be.value]),style:(0,a.Tr)(we.value),"data-node-type":H.value.type,onPointerdown:t[7]||(t[7]=(0,i.D$)((e=>_e(e)),["left","exact"])),oncontextmenu:"return false;"},[(0,o.Lk)("div",P,[(0,o.Lk)("div",{class:"line",style:(0,a.Tr)(Ue.value)},null,4)]),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",{class:"__title",ref_key:"titleRef",ref:h,style:(0,a.Tr)(Ve.value),onPointerdown:[(0,i.D$)(Se,["left","exact"]),t[4]||(t[4]=(0,i.D$)((e=>{return t=e,void(d.value.editor.readonly||(e=>{u.value.selectedNodes.includes(n.node)||_e(e),ye.onPointerDown(e),document.addEventListener("pointermove",ye.onPointerMove),document.addEventListener("keyboard.escape",Ce),document.addEventListener("pointerup",ke)})(t));var t}),["left"])),(0,i.D$)(me,["right"])]},[void 0!==(0,l.R1)(Oe)?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"__title-icon",src:(0,l.R1)(Oe)},null,8,L)):(0,o.Q3)("",!0),v.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:2,type:"text",class:"baklava-input","onUpdate:modelValue":t[0]||(t[0]=e=>X.value=e),placeholder:"Node Name",ref_key:"renameField",ref:f,onKeydown:[t[1]||(t[1]=e=>e.stopPropagation()),(0,i.jR)(xe,["enter"])]},null,544)),[[i.Jo,X.value],[r,xe]]):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"__title-label",innerHTML:(0,l.R1)(g()).sanitize(Ee.value)},null,8,T)),void 0!==$e.value.name&&null!==$e.value.name?((0,o.uX)(),(0,o.CE)(o.FK,{key:3},[void 0!==$e.value.icon?((0,o.uX)(),(0,o.Wv)((0,o.$y)($e.value.icon),{key:0,class:"__title-icon",imgURI:$e.value.name},null,8,["imgURI"])):((0,o.uX)(),(0,o.CE)("img",{key:1,class:"__title-icon",src:$e.value.name},null,8,R))],64)):(0,o.Q3)("",!0),(0,l.R1)(F)||B.value?((0,o.uX)(),(0,o.Wv)((0,l.R1)(E.A).Subgraph,{key:4,class:"__subgraph-icon"})):(0,o.Q3)("",!0),void 0!==z.value?((0,o.uX)(),(0,o.CE)("div",{key:5,class:"pill",style:(0,a.Tr)(Ke.value),innerHTML:(0,l.R1)(g()).sanitize(z.value)},null,12,W)):(0,o.Q3)("",!0),ae.value?((0,o.uX)(),(0,o.Wv)(b.A,{key:6,modelValue:ae.value,"onUpdate:modelValue":t[2]||(t[2]=e=>ae.value=e),x:ie.value,y:re.value,items:ue.value,urls:(0,l.R1)(j),style:(0,a.Tr)(de.value),onPointerdown:t[3]||(t[3]=(0,i.D$)((()=>{}),["left","stop"])),onClick:pe,onSizeUpdate:he},null,8,["modelValue","x","y","items","urls","style"])):(0,o.Q3)("",!0)],36)),[[s,me,"500"]]),(0,o.Lk)("div",{class:"__content",onPointerdown:(0,i.D$)(me,["right"])},[(0,o.Lk)("div",M,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(ne.value,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,onPointerdown:(0,i.D$)((t=>((e,t)=>{if(!d.value.editor.readonly&&!1===ge.value&&(Xe=e,lt.value=st(),lt.value.length>0)){const e=t.currentTarget;it.value=t.offsetX,rt.value=t.offsetY+e.offsetTop+20,ge.value=!0}})(e,t)),["right","exact"])},[(0,o.eW)((0,a.v_)((0,l.R1)(C.BW)(e.componentName)?`${e.name}:`:"")+" ",1),(0,o.bF)(y.A,{node:H.value,intf:e,toggleGroup:nt,updateDynamicInterfaces:ot},null,8,["node","intf"])],40,O)))),128))]),(0,o.Lk)("div",$,[(0,o.Lk)("div",{class:"__outputs",ref_key:"rightSocketsRefs",ref:je},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Re.value,(e=>((0,o.uX)(),(0,o.CE)(o.FK,null,[e?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(y.A,{key:e.id,onPointerdown:[(0,i.D$)((t=>Qe(e,t)),["left","shift"]),(0,i.D$)((t=>tt(e,t)),["right","exact"])],node:H.value,intf:e,highlighted:n.interfaces?.includes(e),picked:Fe(e),switchSides:at},null,8,["onPointerdown","node","intf","highlighted","picked"])),[[c,void 0,"500"]]):((0,o.uX)(),(0,o.CE)("div",G,""))],64)))),256))],512),(0,o.Lk)("div",{class:"__inputs",ref_key:"leftSocketsRefs",ref:He},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(We.value,(e=>((0,o.uX)(),(0,o.CE)(o.FK,null,[e?(0,o.bo)(((0,o.uX)(),(0,o.Wv)(y.A,{key:e.id,onPointerdown:[(0,i.D$)((t=>Qe(e,t)),["left","shift"]),(0,i.D$)((t=>tt(e,t)),["right"])],node:H.value,intf:e,highlighted:n.interfaces?.includes(e),picked:Fe(e),switchSides:at},null,8,["onPointerdown","node","intf","highlighted","picked"])),[[c,void 0,"500"]]):((0,o.uX)(),(0,o.CE)("div",D,""))],64)))),256))],512)]),fe.value?((0,o.uX)(),(0,o.Wv)(b.A,{key:0,modelValue:fe.value,"onUpdate:modelValue":t[5]||(t[5]=e=>fe.value=e),x:Ye.value,y:qe.value,items:Je.value,style:(0,a.Tr)(de.value),onClick:et},null,8,["modelValue","x","y","items","style"])):(0,o.Q3)("",!0),ge.value?((0,o.uX)(),(0,o.Wv)(b.A,{key:1,modelValue:ge.value,"onUpdate:modelValue":t[6]||(t[6]=e=>ge.value=e),x:it.value,y:rt.value,items:lt.value,style:(0,a.Tr)(de.value),onClick:dt},null,8,["modelValue","x","y","items","style"])):(0,o.Q3)("",!0)],32)],46,S)}}};var H=n(66262);const j=(0,H.A)(X,[["__scopeId","data-v-180097b4"]]);var U=n(62789),V=n(35334),K=n(95012),F=n(274),B=n(5419),z=n(80768),Q=n(51645),Y=n(86585),q=n(29567),Z=n(21370),J=n(26278),ee=n(34076);const te=(0,o.pM)({extends:s.xn,props:{loading:{required:!0,type:Boolean}},components:{CustomNode:j,Panel:Z.A,ParentMenu:J.IM,PipelineManagerConnection:U.A,TemporaryConnection:V.A,Palette:K.A,RectangleSelection:B.A,WelcomeMenu:J.s$,Zoom:Y.A,Return:q.A},emits:["setLoad"],setup(e,{emit:t}){const{el:a,counter:i,nodes:r,connections:d,selectedNodes:v,nodeContainerStyle:f,keyDown:g,keyUp:m}=s.xn.setup(e),y=(0,l.KR)([]),{graph:b}=(0,s.uU)(),w=(0,h.A)(),E=(0,F.n)(),_=N.Ay.getEditorManagerInstance(),C=(0,l.KR)([]),k=(0,l.KR)([]),I=(0,o.EW)((()=>e.viewModel.editor.readonly)),S=(0,o.EW)((()=>e.viewModel.editor.hideHud)),P=(0,l.KR)(null),L=[],T=(0,o.EW)((()=>b.value.scaling)),R=(0,o.EW)((()=>e.viewModel.editor.searchQuery)),W=(0,l.KR)([]);let M=0;const O=(0,o.EW)((()=>({"--scale":T.value,cursor:w.dragging.value?"move":"default"}))),$=(0,o.EW)((()=>e.viewModel.editor.isInSubgraph())),G=(0,o.EW)((()=>e.viewModel.editor.preview)),D=()=>{e.viewModel.displayedGraph.selectedNodes=[]},X=new c.Hx;X.subscribe("editor",(e=>{t("setLoad",e)})),e.viewModel.editor.events.setLoad=X;const H=()=>{b.value.nodes.forEach((e=>{if(b.value.selectedNodes.includes(e))return;const t=P.value.boundingRect;(0,z.A)(b.value,e,t)&&b.value.selectedNodes.push(e)}))};let j=0;const U=e=>{w.onPointerMove(e),E.onMouseMove(e),P.value.onPointerMove(e),P.value.selecting&&(b.value.selectedNodes=[],b.value.nodes.forEach((e=>{const t=P.value.boundingRect;(0,z.A)(b.value,e,t)&&b.value.selectedNodes.push(e)})))},V=e=>{w.onPointerUp(e),E.onMouseUp(),new Date-M<100&&e.target===a.value&&D(),1===j&&(document.removeEventListener("pointerup",V),document.removeEventListener("pointermove",U)),j-=1},K=e=>{new Date-M>=100&&e.target===a.value&&H(),P.value.onPointerUp(),document.removeEventListener("pointerup",K),document.removeEventListener("pointermove",U)},B=()=>{b.value.selectedNodes=L.value,H(),P.value.onPointerUp(),document.removeEventListener("pointerup",B),document.removeEventListener("pointermove",U)};document.addEventListener("pointerdown",(e=>{0!==e.button||e.shiftKey||((e=>{j+=1,e.target===a.value&&w.onPointerDown(e),E.onMouseDown(e),M=new Date})(e),document.addEventListener("pointerup",V),document.addEventListener("pointermove",U)),I.value||(2===e.button&&e.ctrlKey?((e=>{P.value.onPointerDown(e),L.value=b.value.selectedNodes})(e),document.addEventListener("pointerup",B),document.addEventListener("pointermove",U)):2===e.button&&((e=>{e.target===a.value&&(D(),P.value.onPointerDown(e)),M=new Date})(e),document.addEventListener("pointerup",K),document.addEventListener("pointermove",U)))}));const Y=()=>{C.value.splice(0,C.value.length)};(0,o.wB)(d.value,(()=>{Y()})),(0,o.wB)(E?.temporaryConnection,(()=>{if(void 0!==(E??null)&&null!==E?.temporaryConnection)if(E?.temporaryConnection?.value?.from)for(let e=0;e<r.value.length;e+=1)[...Object.values(r.value[e].outputs)||[],...Object.values(r.value[e].inputs)||[]].forEach((e=>{var t;e.port&&e!==E.temporaryConnection.value.from&&(b.value.checkConnection(E.temporaryConnection.value.from,e).connectionAllowed||(t=e,k.value.includes(t)||k.value.push(t)))}));else k.value.splice(0,k.value.length)}));const q=(0,o.EW)((()=>e.viewModel.ignoredLayers)),Z=(0,o.EW)((()=>e.viewModel.layers)),J=(0,o.EW)((()=>{const e=new Set;return Z.value.forEach((t=>{t.nodeInterfaces&&q.value.has(t.name)&&t.nodeInterfaces.forEach(e.add,e)})),e})),te=(0,o.EW)((()=>{const e=new Set;return Z.value.forEach((t=>{t.nodeLayers&&q.value.has(t.name)&&t.nodeLayers.forEach(e.add,e)})),e})),ne=(0,o.EW)((()=>r.value.filter((e=>!te.value.has(e.layer))))),oe=(0,o.EW)((()=>r.value.filter((e=>te.value.has(e.layer))))),ae=(0,o.EW)((()=>oe.value.map((e=>e.id)))),ie=(0,o.EW)((()=>d.value.filter((e=>!(e.from.type?.some((e=>J.value.has(e)))||e.to.type?.some((e=>J.value.has(e)))||ae.value.includes(e.from.nodeId)||ae.value.includes(e.to.nodeId)))))),re=(0,o.EW)((()=>ne.value.filter((t=>e.viewModel.displayedGraph.selectedNodes.includes(t))))),se=(0,A.A)();(0,o.wB)(ne,(async(e,t)=>{if(!se.isConnected())return;if(!_.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),a=[];Object.values(e).forEach((e=>{o.includes(e.id)||a.push(e.save())}));const i=[];Object.values(t).forEach((e=>{n.includes(e.id)||i.push(e.id)}));const r={graph_id:b.value.id,nodes:{added:a,deleted:i}};await se.notifyAboutChange("nodes_on_change",r)})),(0,o.wB)(ie,(async(e,t)=>{if(!se.isConnected())return;if(!_.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),a=[];Object.values(e).forEach((e=>{o.includes(e.id)||a.push({id:e.id,from:e.from.id,to:e.to.id})}));const i=[];Object.values(t).forEach((e=>{n.includes(e.id)||i.push({from:e.from.id,to:e.to.id})}));const r={graph_id:b.value.id,connections:{added:a,deleted:i}};await se.notifyAboutChange("connections_on_change",r)})),(0,o.wB)(re,(async(e,t)=>{if(!se.isConnected())return;if(!_.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),a=[];Object.values(e).forEach((e=>{o.includes(e.id)||a.push(e.id)}));const i=[];Object.values(t).forEach((e=>{n.includes(e.id)||i.push(e.id)}));const r={graph_id:b.value.id,nodes:{selected:a,unselected:i}};await se.notifyAboutChange("nodes_on_highlight",r)}));const le=(0,o.EW)((()=>r.value.map((e=>e.title))));(0,o.wB)([R,le],(()=>{if(void 0===R.value||""===R.value)return W.value=[],void ne.value.forEach((e=>{e.highlightedTitle=e.title,e.highlightedType=e.type}));const e=(t=R.value,ne.value.filter((e=>{const{type:n}=e,o=u().single(t,e.title),a=u().single(t,n);return null!==o&&o.score>-50||null!==a&&a.score>-50?(e.highlightedTitle=u().highlight(o,"<span>","</span>"),e.highlightedType=u().highlight(a,"<span>","</span>"),!0):(e.highlightedTitle=e.title,e.highlightedType=e.type,!1)})));var t;const n=ne.value.filter((t=>!e.includes(t)));W.value=n}));const de=void 0!=={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_SPECIFICATION_PATH,ue=void 0!=={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_DATAFLOW_PATH;async function ce(e){let t,n,o=N.Ay.validateSpecification(e);return o.length?(x.A.terminalLog("error","Specification is invalid",o),_.specificationVersion!==e.version&&x.A.terminalLog("error","Mismatched specification version",`Specification version (${e.version}) differs from the current version (${_.specificationVersion}). It may result in unexpected behaviour. Please refer to https://antmicro.github.io/kenning-pipeline-manager/changelogs.html to see if that is the case.`),o):(({errors:o,warnings:t,info:n}=await _.updateEditorSpecification(e)),Array.isArray(t)&&t.length&&x.A.terminalLog("warning","Issue when loading specification",t),Array.isArray(o)&&o.length?(x.A.terminalLog("error","Specification is invalid",o),Array.isArray(n)&&n.length&&x.A.terminalLog("error","Mismatched specification version",`${n} Please refer to https://antmicro.github.io/kenning-pipeline-manager/changelogs.html to see if that is the case.`)):Array.isArray(n)&&n.length&&x.A.terminalLog("info","Specification loaded",n),o)}async function pe(e){const{errors:t,warnings:n,info:o}=await _.loadDataflow(e);if(Array.isArray(n)&&n.length&&x.A.terminalLog("warning","Issue when loading dataflow",n),Array.isArray(t)&&t.length){const e="Dataflow is invalid";x.A.terminalLog("error",e,t),Array.isArray(o)&&o.length&&x.A.terminalLog("error","Mismatched dataflow version",`${o} Please refer to https://antmicro.github.io/kenning-pipeline-manager/changelogs.html to see if that is the case.`)}else Array.isArray(o)&&o.length&&x.A.terminalLog("info","Dataflow loaded",o);return t}(0,o.sV)((async()=>{window.addEventListener("message",(async e=>{const t=e.data??{};if(t.jsonrpc??=p.JSONRPC,(0,p.isJSONRPCResponse)(t)){if(e.source===window)return;return void Q.Ay.client.receive(t)}if(t.id??=Q.Ay.client.createID(),!(0,p.isJSONRPCRequest)(t))return;let n="register_external_frontend"===t.method?se.registerFrontendApplication(e.source,t):null;n??=e.data.method in Q.D7?await Q.Ay.server.receive(t):await Q.Ay.requestAdvanced(t,{externalApp:se.externalApp}),n&&e.source.postMessage(JSON.parse(JSON.stringify(n)),"*")})),x.A.setShowNotification(!1),_.updateMetadata({}),await(0,ee.NV)(he,X)}));const he=async()=>{const t=window.location.search.replace(/&amp;/g,"&"),o=new URLSearchParams(t);if(o.has("preview")){const t="true"===o.get("preview");e.viewModel.editor.preview=t}let a;if(o.has("spec")){const[e,t]=await(0,N.sA)(o.get("spec"));!1===e?(x.A.terminalLog("error",t),x.A.terminalLog("error",`Failed to load the specification file from: ${o.get("spec")}`)):a=t}else de&&(a=n(63359)({NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_SPECIFICATION_PATH));if(void 0!==a){if(o.has("include")&&(void 0===a.include&&(a.include=[]),a.include.push(o.get("include"))),(await ce(a)).length)return void x.A.restoreShowNotification();let e;if(o.has("graph")){const[t,n]=await(0,N.sA)(o.get("graph"));!1===t?(x.A.terminalLog("error",n),x.A.terminalLog("error",`Failed to load the graph file from: ${o.get("graph")}`)):e=n}else ue&&(e=n(63359)({NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_DATAFLOW_PATH));e&&await pe(e)}x.A.restoreShowNotification()},ve=async e=>(0,ee.NV)((async()=>{const t=x.A.showToast;if(e.length>2)return void t("error",`Up to two files supported, inserted: ${e.length}`);let n;try{const t=async e=>JSON.parse(await e.text());n=await Promise.all(Array.from(e).map(t))}catch(e){return void t("error","Dropped file is not in JSON format")}const o=e=>Boolean(e.nodes||e.include||e.includeGraphs),a=e=>Boolean(e.graphs&&!o(e)),i=n.map((e=>!o(e)&&!a(e)));if(i.every(Boolean))return void(1===n.length?t("error","Provided file is not of Pipeline Manager format"):t("error","Neither of provided files is of Pipeline Manager format"));n=n.filter(((e,t)=>!i[t])),i.some(Boolean)&&t("warning","One of the objects is not of Pipeline Manager format");const r=n.map(o),s=n.map(a);let l,d;r.every(Boolean)?(n.length>1&&t("warning","Two specifications provided, using the first one."),[l]=n):s.every(Boolean)?(n.length>1&&t("warning","Two dataflows provided, using the first one."),[d]=n):r.some(Boolean)&&s.some(Boolean)&&(r[0]?[l,d]=n:[d,l]=n);let u=!0;l&&(se.usesBackend()?(x.A.showToast("warning","Specification is managed by an external application."),u=!1):u=!(await ce(l)).length),u&&d&&await pe(d)}),X),fe=(0,o.EW)((()=>_.baklavaView.welcome&&!_.baklavaView.editor.readonly&&!r.value.length&&!_.editor.isInSubgraph()));return{el:a,counter:i,selectedNodes:v,nodeContainerStyle:f,onRightPointerUp:K,onDrop:async e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy";const t=[];e.dataTransfer.items?[...e.dataTransfer.items].filter((e=>"file"===e.kind)).forEach((e=>t.push(e.getAsFile()))):t.push(...e.dataTransfer.files),await ve(t)},nodes:r,keyDown:g,keyUp:m,selectNode:(t,n)=>{(n&&!n.ctrlKey||!n&&!e.viewModel.commandHandler.pressedKeys.includes("Control"))&&D(),e.viewModel.displayedGraph.selectedNodes.push(t)},rectangleSelection:P,greyedOutNodes:W,temporaryConnection:E.temporaryConnection,temporaryConnectionRender:E.render,mouseWheel:w.onMouseWheel,dragging:w.dragging,changeHoveredConnections:e=>{const t=(e=>{const t=e.map((e=>{const t=window.getComputedStyle(e).zIndex;return{z_index:Number.isNaN(parseInt(t,10))?0:parseInt(t,10),element:e}})),n=t.reduce(((e,t)=>t.z_index>e.z_index?t:e),t[0]),o=y.value.filter((e=>e.containsPoint([n.element]))),a=d.value.filter((e=>o.filter((t=>t.connection===e)).length>0)),i=e.find((e=>!!e.classList?.contains("__port")||!!e.classList?.contains("baklava-node-interface")||null!==e.closest?.(".baklava-node-interface")));let r=[];if(a.length>0){const e=d.value.filter((e=>a.filter((t=>t.from===e.from)).length>0)).at(0);e&&(r=[e])}else if(i){let e=i;e=i.closest(".baklava-node-interface"),e?.id&&(r=d.value.filter((t=>t.from?.id===e.id||t.to?.id===e.id)))}return r})(document.elementsFromPoint(e.clientX,e.clientY));d.value.forEach((e=>{var n;t.includes(e)?(n=e,C.value.includes(n)||C.value.push(n)):(e=>{const t=C.value.indexOf(e);t>=0&&C.value.splice(t,1)})(e)}))},highlightConnections:C,connRefs:y,clearHighlight:Y,readonly:I,hideHud:S,scale:T,visibleConnections:ie,visibleNodes:ne,ignoredNodes:oe,highlightInterfaces:k,editorStyle:O,zoomIn:w.onZoomIn,zoomOut:w.onZoomOut,center:()=>{_.centerZoom()},returnFromSubgraph:()=>{_.returnFromSubgraph()},isInSubgraph:$,preview:G,showWelcome:fe,loadFiles:ve,validating:_.validating}}}),ne=(0,H.A)(te,[["render",function(e,t,n,s,l,d){const u=(0,o.g2)("background"),c=(0,o.g2)("Palette"),p=(0,o.g2)("CustomNode"),h=(0,o.g2)("PipelineManagerConnection"),v=(0,o.g2)("TemporaryConnection"),f=(0,o.g2)("RectangleSelection"),g=(0,o.g2)("Zoom"),m=(0,o.g2)("Return"),y=(0,o.g2)("WelcomeMenu"),b=(0,o.g2)("ParentMenu"),w=(0,o.g2)("Panel");return(0,o.uX)(),(0,o.CE)("div",{ref:"el",tabindex:"-1",class:(0,a.C4)(["baklava-editor",{"baklava-ignore-mouse":!!e.temporaryConnection||e.dragging,"--temporary-connection":!!e.temporaryConnection}]),style:(0,a.Tr)(e.editorStyle),onWheel:t[8]||(t[8]=(0,i.D$)(((...t)=>e.mouseWheel&&e.mouseWheel(...t)),["self"])),onKeydown:t[9]||(t[9]=(...t)=>e.keyDown&&e.keyDown(...t)),onKeyup:t[10]||(t[10]=(...t)=>e.keyUp&&e.keyUp(...t)),onMouseleave:t[11]||(t[11]=t=>!e.readonly&&e.onRightPointerUp),onDrop:t[12]||(t[12]=(0,i.D$)((t=>!e.readonly&&e.onDrop(t)),["prevent"])),onDragenter:t[13]||(t[13]=(0,i.D$)((()=>{}),["prevent"])),onDragover:t[14]||(t[14]=(0,i.D$)((()=>{}),["prevent"])),oncontextmenu:"return false;"},[(0,o.RG)(e.$slots,"background",{},(()=>[(0,o.bF)(u)])),e.validating?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[e.readonly||e.hideHud?(0,o.Q3)("",!0):(0,o.RG)(e.$slots,"palette",{key:0},(()=>[(0,o.bF)(c)])),(0,o.Lk)("div",{class:"node-container",style:(0,a.Tr)(e.nodeContainerStyle),onWheel:t[0]||(t[0]=(...t)=>e.mouseWheel&&e.mouseWheel(...t)),onMouseenter:t[1]||(t[1]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMousemove:t[2]||(t[2]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMouseleave:t[3]||(t[3]=(...t)=>e.clearHighlight&&e.clearHighlight(...t))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.visibleNodes,(t=>((0,o.uX)(),(0,o.Wv)(p,{key:t.id+e.counter.toString(),node:t,selected:e.selectedNodes.includes(t),greyedOut:e.greyedOutNodes.includes(t),interfaces:e.highlightInterfaces,onSelect:n=>e.selectNode(t,n)},null,8,["node","selected","greyedOut","interfaces","onSelect"])))),128)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.ignoredNodes,(t=>((0,o.uX)(),(0,o.Wv)(p,{key:t.id+e.counter.toString(),node:t,hidden:!0},null,8,["node"])))),128))],36),((0,o.uX)(),(0,o.CE)("svg",{class:"connections-container",onMouseenter:t[4]||(t[4]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMousemove:t[5]||(t[5]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMouseleave:t[6]||(t[6]=(...t)=>e.clearHighlight&&e.clearHighlight(...t)),onWheel:t[7]||(t[7]=(...t)=>e.mouseWheel&&e.mouseWheel(...t))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.visibleConnections,(t=>((0,o.uX)(),(0,o.Wv)(h,{key:t.id+e.counter.toString(),connection:t,ref_for:!0,ref:"connRefs",isHighlighted:e.highlightConnections.includes(t)},null,8,["connection","isHighlighted"])))),128)),e.temporaryConnection&&e.temporaryConnectionRender?((0,o.uX)(),(0,o.Wv)(v,{key:0,name:"temporaryConnection","temporary-connection":e.temporaryConnection,connection:e.temporaryConnection},null,8,["temporary-connection","connection"])):(0,o.Q3)("",!0)],32)),(0,o.Lk)("div",r,[(0,o.bF)(f,{ref:"rectangleSelection"},null,512)]),(0,o.bF)(g,{onZoomIn:e.zoomIn,onZoomOut:e.zoomOut,onCenter:e.center,floating:!e.hideHud},null,8,["onZoomIn","onZoomOut","onCenter","floating"]),e.preview&&e.isInSubgraph?((0,o.uX)(),(0,o.Wv)(m,{key:1,onClick:e.returnFromSubgraph},null,8,["onClick"])):(0,o.Q3)("",!0),(0,o.bo)((0,o.bF)(w,{blur:!1,class:"welcome-container-panel"},{default:(0,o.k6)((()=>[(0,o.bF)(b,null,{default:(0,o.k6)((()=>[(0,o.bF)(y,{loadFiles:e.loadFiles},null,8,["loadFiles"])])),_:1})])),_:1},512),[[i.aG,e.showWelcome]])],64))],38)}]])},96422:(e,t,n)=>{n.d(t,{BW:()=>a,bf:()=>r,q6:()=>i});var o=n(63491);function a(e){switch(e){case"InputInterface":case"TextAreaInterface":case"SelectInterface":case"ListInterface":case"TextInterface":case"HexInterface":return!0;default:return!1}}function i(e,t,n,a=void 0,i=!1,r=!0){if(r){const{graph:t}=(0,o.uU)();t.value.editNode(e)}const s=t.sidePosition;t.side=n,void 0!==a&&(t.sidePosition=a);const l=[...Object.values(e.inputs),...Object.values(e.outputs)].find((e=>e.id!==t.id&&e.sidePosition===t.sidePosition&&e.side===t.side));if(void 0!==l)if(void 0!==a&&i)l.sidePosition=s;else{const n=void 0===a?t:l,o=[...Object.values(e.inputs),...Object.values(e.outputs)].filter((e=>e.side===n.side&&!e.hidden)).map((e=>e.sidePosition));let i=0;for(;o.includes(i);)i+=1;n.sidePosition=i}}function r(e,t=!1){const{viewModel:n}=(0,o.if)();if(n.value.editor.isGraphNode(e.type)&&t)n.value.editor.unwrapSubgraph(e);else{const{graph:t}=(0,o.uU)();t.value.removeNode(e)}}}}]);
//# sourceMappingURL=index-7574f2c7.ebecb2a1.js.map