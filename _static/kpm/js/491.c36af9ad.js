"use strict";(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[491],{34250:(e,n,t)=>{t.d(n,{Hx:()=>i,dM:()=>r,Bi:()=>a,vz:()=>s,tz:()=>u});class o{constructor(){this.listenerMap=new Map,this._listeners=[],this.proxyMap=new Map,this.proxies=[]}get listeners(){return this._listeners.concat(this.proxies.flatMap((e=>e())))}subscribe(e,n){this.listenerMap.has(e)&&(console.warn("Already subscribed. Unsubscribing for you.\nPlease check that you don't accidentally use the same token twice to register two different handlers for the same event/hook."),this.unsubscribe(e)),this.listenerMap.set(e,n),this._listeners.push(n)}unsubscribe(e){if(this.listenerMap.has(e)){const n=this.listenerMap.get(e);this.listenerMap.delete(e);const t=this._listeners.indexOf(n);t>=0&&this._listeners.splice(t,1)}}registerProxy(e,n){this.proxyMap.has(e)&&(console.warn("Already subscribed. Unsubscribing for you.\nPlease check that you don't accidentally use the same token twice to register two different proxies for the same event/hook."),this.unregisterProxy(e)),this.proxyMap.set(e,n),this.proxies.push(n)}unregisterProxy(e){if(!this.proxyMap.has(e))return;const n=this.proxyMap.get(e);this.proxyMap.delete(e);const t=this.proxies.indexOf(n);t>=0&&this.proxies.splice(t,1)}}class i extends o{constructor(e){super(),this.entity=e}emit(e){this.listeners.forEach((n=>n(e,this.entity)))}}class a extends o{constructor(e){super(),this.entity=e}emit(e){let n=!1;const t=()=>[n=!0];for(const o of Array.from(this.listeners.values()))if(o(e,t,this.entity),n)return{prevented:!0};return{prevented:!1}}}class l extends o{execute(e,n){let t=e;for(const e of this.listeners)t=e(t,n);return t}}class s extends l{constructor(e){super(),this.entity=e}execute(e){return super.execute(e,this.entity)}}class r extends o{constructor(e){super(),this.entity=e}execute(e){const n=[];for(const t of this.listeners)n.push(t(e,this.entity));return n}}function u(){const e=Symbol(),n=new Map,t=new Set,i=(t,i)=>{i instanceof o&&i.registerProxy(e,(()=>{var e,o;return null!==(o=null===(e=n.get(t))||void 0===e?void 0:e.listeners)&&void 0!==o?o:[]}))},a=e=>{t.add(e);for(const t of n.keys())i(t,e[t])},l=i=>{for(const t of n.keys())i[t]instanceof o&&i[t].unregisterProxy(e);t.delete(i)},s=()=>{t.forEach((e=>l(e))),n.clear()};return new Proxy({},{get:(e,r)=>"addTarget"===r?a:"removeTarget"===r?l:"destroy"===r?s:"string"!=typeof r||r.startsWith("_")?e[r]:(n.has(r)||(e=>{const a=new o;n.set(e,a),t.forEach((n=>i(e,n[e])))})(r),n.get(r))})}},63491:(e,n,t)=>{t.d(n,{AP:()=>Jt,G9:()=>Xn,Gy:()=>v,JZ:()=>In,TE:()=>Qt,V1:()=>cn,XF:()=>Zt,aw:()=>He,b:()=>Je,if:()=>d,jW:()=>bn,lo:()=>Kn,mk:()=>On,oQ:()=>gn,qO:()=>pn,uU:()=>c,xn:()=>zt});var o=t(50953),i=t(20641),a=t(90033),l=t(53751),s=t(46171),r=t(34250);let u=null;function d(){if(!u)throw new Error("providePlugin() must be called before usePlugin()");return{viewModel:u}}function c(){const{viewModel:e}=d();return{graph:(0,o.lW)(e.value,"displayedGraph"),switchGraph:e.value.switchGraph}}function p(e){const{graph:n}=c(),t=(0,o.KR)(null),a=(0,o.KR)(null);return{dragging:(0,i.EW)((()=>!!t.value)),onPointerDown:n=>{t.value={x:n.pageX,y:n.pageY},a.value={x:e.value.x,y:e.value.y}},onPointerMove:o=>{if(t.value){const i=o.pageX-t.value.x,l=o.pageY-t.value.y;e.value.x=a.value.x+i/n.value.scaling,e.value.y=a.value.y+l/n.value.scaling}},onPointerUp:()=>{t.value=null,a.value=null}}}function v(){const{graph:e}=c();return{transform:(n,t)=>[n/e.value.scaling-e.value.panning.x,t/e.value.scaling-e.value.panning.y]}}var m=(e=>(e[e.NONE=0]="NONE",e[e.ALLOWED=1]="ALLOWED",e[e.FORBIDDEN=2]="FORBIDDEN",e))(m||{});const f=(e,n)=>{const t=e.__vccOpts||e;for(const[e,o]of n)t[e]=o;return t},h=f((0,i.pM)({setup(){const{viewModel:e}=d(),{graph:n}=c();return{styles:(0,i.EW)((()=>{const t=e.value.settings.background,o=n.value.panning.x*n.value.scaling,i=n.value.panning.y*n.value.scaling,a=n.value.scaling*t.gridSize,l=a/t.gridDivision;return{backgroundPosition:`left ${o}px top ${i}px`,backgroundSize:`${a}px ${a}px, ${a}px ${a}px ${n.value.scaling>t.subGridVisibleThreshold?`, ${l}px ${l}px, ${l}px ${l}px`:""}`}}))}}}),[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("div",{class:"background",style:(0,a.Tr)(e.styles)},null,4)}]]);var y;const g="undefined"!=typeof window,b=()=>{};g&&(null==(y=null==window?void 0:window.navigator)?void 0:y.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);var w=Object.defineProperty,k=Object.defineProperties,x=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,_=(e,n,t)=>n in e?w(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,N=(e,n)=>{for(var t in n||(n={}))E.call(n,t)&&_(e,t,n[t]);if(C)for(var t of C(n))M.call(n,t)&&_(e,t,n[t]);return e};function I(e){var n;const t="function"==typeof(i=e)?i():(0,o.R1)(i);var i;return null!=(n=null==t?void 0:t.$el)?n:t}const O=g?window:void 0;function S(...e){let n,t,a,l;if("string"==typeof e[0]||Array.isArray(e[0])?([t,a,l]=e,n=O):[n,t,a,l]=e,!n)return b;Array.isArray(t)||(t=[t]),Array.isArray(a)||(a=[a]);const s=[],r=()=>{s.forEach((e=>e())),s.length=0},u=(0,i.wB)((()=>I(n)),(e=>{r(),e&&s.push(...t.flatMap((n=>a.map((t=>((e,n,t)=>(e.addEventListener(n,t,l),()=>e.removeEventListener(n,t,l)))(e,n,t))))))}),{immediate:!0,flush:"post"}),d=()=>{u(),r()};var c;return c=d,(0,o.o5)()&&(0,o.jr)(c),d}function L(e,n,t={}){const{window:o=O,ignore:i=[],capture:a=!0,detectIframe:l=!1}=t;if(!o)return;let s,r=!0;const u=e=>i.some((n=>{if("string"==typeof n)return Array.from(o.document.querySelectorAll(n)).some((n=>n===e.target||e.composedPath().includes(n)));{const t=I(n);return t&&(e.target===t||e.composedPath().includes(t))}})),d=t=>{o.clearTimeout(s);const i=I(e);i&&i!==t.target&&!t.composedPath().includes(i)&&(0===t.detail&&(r=!u(t)),r?n(t):r=!0)},c=[S(o,"click",d,{passive:!0,capture:a}),S(o,"pointerdown",(n=>{const t=I(e);t&&(r=!n.composedPath().includes(t)&&!u(n))}),{passive:!0}),S(o,"pointerup",(e=>{if(0===e.button){const n=e.composedPath();e.composedPath=()=>n,s=o.setTimeout((()=>d(e)),50)}}),{passive:!0}),l&&S(o,"blur",(t=>{var i;const a=I(e);"IFRAME"!==(null==(i=o.document.activeElement)?void 0:i.tagName)||(null==a?void 0:a.contains(o.document.activeElement))||n(t)}))].filter(Boolean);return()=>c.forEach((e=>e()))}g&&window.document,g&&window.navigator,g&&window.location;const R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},W="__vueuse_ssr_handlers__";R[W]=R[W]||{},R[W];var P=Object.defineProperty,X=Object.defineProperties,T=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,$=(e,n,t)=>n in e?P(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;const G={x:0,y:0,pointerId:0,pressure:0,tiltX:0,tiltY:0,width:0,height:0,twist:0,pointerType:null},V=Object.keys(G);var A,B;(B=A||(A={})).UP="UP",B.RIGHT="RIGHT",B.DOWN="DOWN",B.LEFT="LEFT",B.NONE="NONE";var F=Object.defineProperty,H=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,z=(e,n,t)=>n in e?F(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;((e,n)=>{for(var t in n||(n={}))U.call(n,t)&&z(e,t,n[t]);if(H)for(var t of H(n))q.call(n,t)&&z(e,t,n[t])})({linear:function(e){return e}},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});const Q=(0,i.pM)({props:{modelValue:{type:Boolean,default:!1},items:{type:Array,required:!0},x:{type:Number,default:0},y:{type:Number,default:0},isNested:{type:Boolean,default:!1},isFlipped:{type:Object,default:()=>({x:!1,y:!1})},flippable:{type:Boolean,default:!1}},emits:["click","update:modelValue"],setup(e,{emit:n}){let t=null;const a=(0,o.KR)(null),l=(0,o.KR)(-1),s=(0,o.KR)(0),r=(0,o.KR)({x:!1,y:!1}),u=(0,i.EW)((()=>e.flippable&&(r.value.x||e.isFlipped.x))),d=(0,i.EW)((()=>e.flippable&&(r.value.y||e.isFlipped.y))),c=(0,i.EW)((()=>{const n={};return e.isNested||(n.top=(d.value?e.y-s.value:e.y)+"px",n.left=e.x+"px"),n})),p=(0,i.EW)((()=>({"--flipped-x":u.value,"--flipped-y":d.value,"--nested":e.isNested}))),v=(0,i.EW)((()=>e.items.map((e=>({...e,hover:!1})))));return(0,i.wB)([()=>e.y,()=>e.items],(()=>{var n,t,o,i;s.value=30*e.items.length;const l=(null==(t=null==(n=a.value)?void 0:n.parentElement)?void 0:t.offsetWidth)??0,u=(null==(i=null==(o=a.value)?void 0:o.parentElement)?void 0:i.offsetHeight)??0;r.value.x=!e.isNested&&e.x>.75*l,r.value.y=!e.isNested&&e.y+s.value>u-20})),L(a,(()=>{e.modelValue&&n("update:modelValue",!1)})),{el:a,activeMenu:l,flippedX:u,flippedY:d,styles:c,classes:p,itemsWithHoverProperty:v,onClick:e=>{!e.submenu&&e.value&&(n("click",e.value),n("update:modelValue",!1))},onChildClick:t=>{n("click",t),l.value=-1,e.isNested||n("update:modelValue",!1)},onClickOutside:L,onMouseEnter:(n,o)=>{e.items[o].submenu&&(l.value=o,null!==t&&(clearTimeout(t),t=null))},onMouseLeave:(n,o)=>{e.items[o].submenu&&(t=window.setTimeout((()=>{l.value=-1,t=null}),200))}}}}),Y=["onMouseenter","onMouseleave","onClick"],J={class:"flex-fill"},Z={key:0,class:"__submenu-icon",style:{"line-height":"1em"}},ee=[(0,i.Lk)("svg",{width:"13",height:"13",viewBox:"-60 120 250 250"},[(0,i.Lk)("path",{d:"M160.875 279.5625 L70.875 369.5625 L70.875 189.5625 L160.875 279.5625 Z",stroke:"none",fill:"white"})],-1)],ne=f(Q,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("context-menu",!0);return(0,i.uX)(),(0,i.Wv)(l.eB,{name:"slide-fade"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.Lk)("div",{ref:"el",class:(0,a.C4)(["baklava-context-menu",e.classes]),style:(0,a.Tr)(e.styles)},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.itemsWithHoverProperty,((n,t)=>((0,i.uX)(),(0,i.CE)(i.FK,null,[n.isDivider?((0,i.uX)(),(0,i.CE)("div",{key:`d-${t}`,class:"divider"})):((0,i.uX)(),(0,i.CE)("div",{key:`i-${t}`,class:(0,a.C4)(["item",{submenu:!!n.submenu,"--disabled":!!n.disabled}]),onMouseenter:n=>e.onMouseEnter(n,t),onMouseleave:n=>e.onMouseLeave(n,t),onClick:(0,l.D$)((t=>e.onClick(n)),["stop","prevent"])},[(0,i.Lk)("div",J,(0,a.v_)(n.label),1),n.submenu?((0,i.uX)(),(0,i.CE)("div",Z,ee)):(0,i.Q3)("",!0),n.submenu?((0,i.uX)(),(0,i.Wv)(u,{key:1,value:e.activeMenu===t,items:n.submenu,"is-nested":!0,"is-flipped":{x:e.flippedX,y:e.flippedY},flippable:e.flippable,onClick:e.onChildClick},null,8,["value","items","is-flipped","flippable","onClick"])):(0,i.Q3)("",!0)],42,Y))],64)))),256))],6),[[l.aG,e.modelValue]])])),_:1})}]]),te={},oe={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},ie=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("circle",{cx:"12",cy:"12",r:"1"},null,-1),(0,i.Lk)("circle",{cx:"12",cy:"19",r:"1"},null,-1),(0,i.Lk)("circle",{cx:"12",cy:"5",r:"1"},null,-1)],ae=f(te,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",oe,ie)}]]),le=(0,i.pM)({props:{node:{type:Object,required:!0},intf:{type:Object,required:!0}},setup(e){const{viewModel:n}=d(),t=(0,i.WQ)("hoveredOver"),a=(0,o.KR)(null),l=(0,i.EW)((()=>e.intf.connectionCount>0)),s=(0,i.EW)((()=>({"--input":e.intf.isInput,"--output":!e.intf.isInput,"--connected":l.value}))),r=(0,i.EW)((()=>e.intf.component&&0===e.intf.connectionCount&&(e.intf.isInput||!e.intf.port))),u=()=>{a.value&&n.value.hooks.renderInterface.execute({intf:e.intf,el:a.value})};return(0,i.sV)(u),(0,i.$u)(u),{el:a,isConnected:l,classes:s,showComponent:r,startHover:()=>{t(e.intf)},endHover:()=>{t(void 0)},openSidebar:()=>{const t=n.value.displayedGraph.sidebar;t.nodeId=e.node.id,t.optionName=e.intf.name,t.visible=!0}}}}),se=["id"],re={key:2,class:"align-middle"},ue=f(le,[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("div",{id:e.intf.id,ref:"el",class:(0,a.C4)(["baklava-node-interface",e.classes])},[e.intf.port?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"__port",onPointerover:n[0]||(n[0]=(...n)=>e.startHover&&e.startHover(...n)),onPointerout:n[1]||(n[1]=(...n)=>e.endHover&&e.endHover(...n))},null,32)):(0,i.Q3)("",!0),e.showComponent?((0,i.uX)(),(0,i.Wv)((0,i.$y)(e.intf.component),{key:1,modelValue:e.intf.value,"onUpdate:modelValue":n[2]||(n[2]=n=>e.intf.value=n),node:e.node,intf:e.intf,onOpenSidebar:e.openSidebar},null,40,["modelValue","node","intf","onOpenSidebar"])):((0,i.uX)(),(0,i.CE)("span",re,(0,a.v_)(e.intf.name),1))],10,se)}]]),de=["id","data-node-type"],ce=["onPointerdown"],pe={class:"__title-label"},ve={class:"__menu"},me=["onKeydown"],fe={class:"__content"},he={class:"__outputs"},ye={class:"__inputs"},ge=(0,i.pM)({__name:"Node",props:{node:null,selected:{type:Boolean,default:!1}},emits:["select"],setup(e,{emit:n}){const t=e,{viewModel:r}=d(),{graph:u,switchGraph:v}=c(),m=p((0,o.lW)(t.node,"position")),f=(0,o.KR)(null),h=(0,o.KR)(!1),y=(0,o.KR)(""),g=(0,o.KR)(null),b=(0,o.KR)(!1),w=(0,i.EW)((()=>{const e=[{value:"rename",label:"Rename"},{value:"delete",label:"Delete"}];return t.node.type.startsWith(s.cO)&&e.push({value:"editSubgraph",label:"Edit Subgraph"}),e})),k=(0,i.EW)((()=>({"--selected":t.selected,"--dragging":m.dragging.value,"--two-column":!!t.node.twoColumn}))),x=(0,i.EW)((()=>{var e,n;return{top:`${(null==(e=t.node.position)?void 0:e.y)??0}px`,left:`${(null==(n=t.node.position)?void 0:n.x)??0}px`,width:`${t.node.width??200}px`}})),C=(0,i.EW)((()=>Object.values(t.node.inputs).filter((e=>!e.hidden)))),E=(0,i.EW)((()=>Object.values(t.node.outputs).filter((e=>!e.hidden)))),M=()=>{n("select")},_=e=>{m.onPointerDown(e),document.addEventListener("pointermove",m.onPointerMove),document.addEventListener("pointerup",N),M()},N=()=>{m.onPointerUp(),document.removeEventListener("pointermove",m.onPointerMove),document.removeEventListener("pointerup",N)},I=()=>{b.value=!0},O=async e=>{var n;switch(e){case"delete":u.value.removeNode(t.node);break;case"rename":y.value=t.node.title,h.value=!0,await(0,i.dY)(),null==(n=g.value)||n.focus();break;case"editSubgraph":v(t.node.template)}},S=()=>{t.node.title=y.value,h.value=!1},L=()=>{f.value&&r.value.hooks.renderNode.execute({node:t.node,el:f.value})};return(0,i.sV)(L),(0,i.$u)(L),(n,t)=>((0,i.uX)(),(0,i.CE)("div",{id:e.node.id,ref_key:"el",ref:f,class:(0,a.C4)(["baklava-node",(0,o.R1)(k)]),style:(0,a.Tr)((0,o.R1)(x)),"data-node-type":e.node.type,onPointerdown:M},[(0,i.Lk)("div",{class:"__title",onPointerdown:(0,l.D$)(_,["self","stop"])},[h.value?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:1,ref_key:"renameInputEl",ref:g,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),type:"text",class:"baklava-input",placeholder:"Node Name",onBlur:S,onKeydown:(0,l.jR)(S,["enter"])},null,40,me)),[[l.Jo,y.value]]):((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.Lk)("div",pe,(0,a.v_)(e.node.title),1),(0,i.Lk)("div",ve,[(0,i.bF)(ae,{class:"--clickable",onClick:I}),(0,i.bF)(ne,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),x:0,y:0,items:(0,o.R1)(w),onClick:O},null,8,["modelValue","items"])])],64))],40,ce),(0,i.Lk)("div",fe,[(0,i.Lk)("div",he,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(E),(n=>((0,i.uX)(),(0,i.Wv)(ue,{key:n.id,node:e.node,intf:n},null,8,["node","intf"])))),128))]),(0,i.Lk)("div",ye,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(C),(n=>((0,i.uX)(),(0,i.Wv)(ue,{key:n.id,node:e.node,intf:n},null,8,["node","intf"])))),128))])])],46,de))}}),be=(0,i.pM)({props:{x1:{type:Number,required:!0},y1:{type:Number,required:!0},x2:{type:Number,required:!0},y2:{type:Number,required:!0},state:{type:Number,default:m.NONE},isTemporary:{type:Boolean,default:!1}},setup(e){const{viewModel:n}=d(),{graph:t}=c(),o=(e,n)=>[(e+t.value.panning.x)*t.value.scaling,(n+t.value.panning.y)*t.value.scaling];return{d:(0,i.EW)((()=>{const[t,i]=o(e.x1,e.y1),[a,l]=o(e.x2,e.y2);if(n.value.settings.useStraightConnections)return`M ${t} ${i} L ${a} ${l}`;{const e=.3*Math.abs(t-a);return`M ${t} ${i} C ${t+e} ${i}, ${a-e} ${l}, ${a} ${l}`}})),classes:(0,i.EW)((()=>({"--temporary":e.isTemporary,"--allowed":e.state===m.ALLOWED,"--forbidden":e.state===m.FORBIDDEN})))}}}),we=["d"],ke=f(be,[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("path",{class:(0,a.C4)(["baklava-connection",e.classes]),d:e.d},null,10,we)}]]);function xe(e){const n=document.getElementById(e.id),t=null==n?void 0:n.getElementsByClassName("__port");return{node:(null==n?void 0:n.closest(".baklava-node"))??null,interface:n,port:t&&t.length>0?t[0]:null}}const Ce=f((0,i.pM)({components:{"connection-view":ke},props:{connection:{type:Object,required:!0}},setup(e){const{graph:n}=c();let t;const a=(0,o.KR)({x1:0,y1:0,x2:0,y2:0}),l=(0,i.EW)((()=>e.connection.isInDanger?m.FORBIDDEN:m.NONE)),s=(0,i.EW)((()=>{var t;return null==(t=n.value.findNodeById(e.connection.from.nodeId))?void 0:t.position})),r=(0,i.EW)((()=>{var t;return null==(t=n.value.findNodeById(e.connection.to.nodeId))?void 0:t.position})),u=e=>e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0],d=()=>{const n=xe(e.connection.from),o=xe(e.connection.to);n.node&&o.node&&(t||(t=new ResizeObserver((()=>{d()})),t.observe(n.node),t.observe(o.node)));const[i,l]=u(n),[s,r]=u(o);a.value={x1:i,y1:l,x2:s,y2:r}};return(0,i.sV)((async()=>{await(0,i.dY)(),d()})),(0,i.xo)((()=>{t&&t.disconnect()})),(0,i.wB)([s,r],(()=>d()),{deep:!0}),{d:a,state:l}}}),[["render",function(e,n,t,o,a,l){const s=(0,i.g2)("connection-view");return(0,i.uX)(),(0,i.Wv)(s,{x1:e.d.x1,y1:e.d.y1,x2:e.d.x2,y2:e.d.y2,state:e.state},null,8,["x1","y1","x2","y2","state"])}]]);function Ee(e){return e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0]}const Me=f((0,i.pM)({components:{"connection-view":ke},props:{connection:{type:Object,required:!0}},setup(e){const n=(0,i.EW)((()=>e.connection?e.connection.status:m.NONE));return{d:(0,i.EW)((()=>{if(!e.connection)return{input:[0,0],output:[0,0]};const n=Ee(xe(e.connection.from)),t=e.connection.to?Ee(xe(e.connection.to)):[e.connection.mx||n[0],e.connection.my||n[1]];return e.connection.from.isInput?{input:t,output:n}:{input:n,output:t}})),status:n}}}),[["render",function(e,n,t,o,a,l){const s=(0,i.g2)("connection-view");return(0,i.uX)(),(0,i.Wv)(s,{x1:e.d.input[0],y1:e.d.input[1],x2:e.d.output[0],y2:e.d.output[1],state:e.status,"is-temporary":""},null,8,["x1","y1","x2","y2","state"])}]]),_e=(0,i.pM)({setup(){const{graph:e}=c(),n=(0,o.KR)(null),t=(0,o.KR)(300),a=(0,i.EW)((()=>{const n=e.value.sidebar.nodeId;return e.value.nodes.find((e=>e.id===n))})),l=(0,i.EW)((()=>({width:`${t.value}px`}))),s=(0,i.EW)((()=>a.value?[...Object.values(a.value.inputs),...Object.values(a.value.outputs)].filter((e=>e.displayInSidebar&&e.component)):[])),r=e=>{var o,i;const a=(null==(i=null==(o=n.value)?void 0:o.parentElement)?void 0:i.getBoundingClientRect().width)??500;t.value-=e.movementX,t.value<300?t.value=300:t.value>.9*a&&(t.value=.9*a)};return{el:n,graph:e,node:a,styles:l,displayedInterfaces:s,startResize:()=>{window.addEventListener("mousemove",r),window.addEventListener("mouseup",(()=>{window.removeEventListener("mousemove",r)}),{once:!0})},close:()=>{e.value.sidebar.visible=!1}}}}),Ne={class:"__header"},Ie={class:"__node-name"},Oe=f(_e,[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("div",{ref:"el",class:(0,a.C4)(["baklava-sidebar",{"--open":e.graph.sidebar.visible}]),style:(0,a.Tr)(e.styles)},[(0,i.Lk)("div",{class:"__resizer",onMousedown:n[0]||(n[0]=(...n)=>e.startResize&&e.startResize(...n))},null,32),(0,i.Lk)("div",Ne,[(0,i.Lk)("button",{tabindex:"-1",class:"__close",onClick:n[1]||(n[1]=(...n)=>e.close&&e.close(...n))}," Ã— "),(0,i.Lk)("div",Ie,[(0,i.Lk)("b",null,(0,a.v_)(e.node?e.node.title:""),1)])]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.displayedInterfaces,(n=>((0,i.uX)(),(0,i.CE)("div",{key:n.id,class:"__interface"},[((0,i.uX)(),(0,i.Wv)((0,i.$y)(n.component),{modelValue:n.value,"onUpdate:modelValue":e=>n.value=e,node:e.node,intf:n},null,8,["modelValue","onUpdate:modelValue","node","intf"]))])))),128))],6)}]]),Se=f((0,i.pM)({setup(){const{viewModel:e}=d(),{graph:n}=c(),t=(0,o.KR)(null),a=(0,o.KR)(!1);let l,s=!1,r={x1:0,y1:0,x2:0,y2:0};const u=(e,n)=>[(e-r.x1)/(r.x2-r.x1)*l.canvas.clientWidth,(n-r.y1)/(r.y2-r.y1)*l.canvas.clientHeight],p=e=>{if(e){const n=e.querySelector(".__content");if(n){const e=v(n);if(e)return e}const t=v(e);if(t)return t}return"gray"},v=e=>{const n=getComputedStyle(e).backgroundColor;if(n&&"rgba(0, 0, 0, 0)"!==n)return n},m=()=>{const e=t.value.parentElement.offsetWidth,o=t.value.parentElement.offsetHeight,i=e/n.value.scaling-n.value.panning.x,a=o/n.value.scaling-n.value.panning.y;return{x1:-n.value.panning.x,y1:-n.value.panning.y,x2:i,y2:a}},f=e=>{if(s){const[i,a]=(t=e.offsetX,o=e.offsetY,[t*(r.x2-r.x1)/l.canvas.clientWidth+r.x1,o*(r.y2-r.y1)/l.canvas.clientHeight+r.y1]),s=m(),u=(s.x1-s.x2)/2,d=(s.y1-s.y2)/2;n.value.panning.x=-(i+u),n.value.panning.y=-(a+d)}var t,o},h=()=>{s=!1};return(0,i.sV)((()=>{l=t.value.getContext("2d"),l.imageSmoothingQuality="high",(()=>{var t,o;if(!l)return;const i=new Map,s=new Map;for(const e of n.value.nodes){const n=(d=e,document.getElementById(d.id)),a=(null==n?void 0:n.clientWidth)??0,l=(null==n?void 0:n.clientHeight)??0,r=(null==(t=e.position)?void 0:t.x)??0,u=(null==(o=e.position)?void 0:o.y)??0;i.set(e,{x1:r,y1:u,x2:r+a,y2:u+l}),s.set(e,n)}var d;const c={x1:Number.MAX_SAFE_INTEGER,y1:Number.MAX_SAFE_INTEGER,x2:Number.MIN_SAFE_INTEGER,y2:Number.MIN_SAFE_INTEGER};for(const e of i.values())e.x1<c.x1&&(c.x1=e.x1),e.y1<c.y1&&(c.y1=e.y1),e.x2>c.x2&&(c.x2=e.x2),e.y2>c.y2&&(c.y2=e.y2);c.x1-=50,c.y1-=50,c.x2+=50,c.y2+=50,r=c,l.clearRect(0,0,l.canvas.width,l.canvas.height),l.strokeStyle="white";for(const t of n.value.connections){const[n,o]=Ee(xe(t.from)),[i,a]=Ee(xe(t.to)),[s,r]=u(n,o),[d,c]=u(i,a);if(l.beginPath(),l.moveTo(s,r),e.value.settings.useStraightConnections)l.lineTo(d,c);else{const e=.3*Math.abs(s-d);l.bezierCurveTo(s+e,r,d-e,c,d,c)}l.stroke()}l.strokeStyle="lightgray";for(const[e,n]of i.entries()){const[t,o]=u(n.x1,n.y1),[i,a]=u(n.x2,n.y2);l.fillStyle=p(s.get(e)),l.beginPath(),l.rect(t,o,i-t,a-o),l.fill(),l.stroke()}if(a.value){const e=m(),[n,t]=u(e.x1,e.y1),[o,i]=u(e.x2,e.y2);l.fillStyle="rgba(255, 255, 255, 0.2)",l.fillRect(n,t,o-n,i-t)}})()})),{canvas:t,showViewBounds:a,mousedown:e=>{0===e.button&&(s=!0,f(e))},mousemove:f,mouseup:h,mouseenter:()=>{a.value=!0},mouseleave:()=>{a.value=!1,h()}}}}),[["render",function(e,n,t,o,a,s){return(0,i.uX)(),(0,i.CE)("canvas",{ref:"canvas",class:"baklava-minimap",onMouseenter:n[0]||(n[0]=(...n)=>e.mouseenter&&e.mouseenter(...n)),onMouseleave:n[1]||(n[1]=(...n)=>e.mouseleave&&e.mouseleave(...n)),onMousedown:n[2]||(n[2]=(0,l.D$)(((...n)=>e.mousedown&&e.mousedown(...n)),["self"])),onMousemove:n[3]||(n[3]=(0,l.D$)(((...n)=>e.mousemove&&e.mousemove(...n)),["self"])),onMouseup:n[4]||(n[4]=(...n)=>e.mouseup&&e.mouseup(...n))},null,544)}]]),Le=(0,i.pM)({components:{ContextMenu:ne,VerticalDots:ae},props:{type:{type:String,required:!0},title:{type:String,required:!0}},setup(e){const{viewModel:n}=d(),{switchGraph:t}=c(),a=(0,o.KR)(!1),l=(0,i.EW)((()=>e.type.startsWith(s.cO)));return{showContextMenu:a,hasContextMenu:l,contextMenuItems:[{label:"Edit Subgraph",value:"editSubgraph"},{label:"Delete Subgraph",value:"deleteSubgraph"}],openContextMenu:()=>{a.value=!0},onContextMenuClick:o=>{const i=e.type.substring(s.cO.length),a=n.value.editor.graphTemplates.find((e=>e.id===i));if(a)switch(o){case"editSubgraph":t(a);break;case"deleteSubgraph":n.value.editor.removeGraphTemplate(a)}}}}}),Re=["data-node-type"],We={class:"__title"},Pe={class:"__title-label"},Xe={key:0,class:"__menu"},Te=f(Le,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("vertical-dots"),d=(0,i.g2)("context-menu");return(0,i.uX)(),(0,i.CE)("div",{class:"baklava-node --palette","data-node-type":e.type},[(0,i.Lk)("div",We,[(0,i.Lk)("div",Pe,(0,a.v_)(e.title),1),e.hasContextMenu?((0,i.uX)(),(0,i.CE)("div",Xe,[(0,i.bF)(u,{class:"--clickable",onPointerdown:n[0]||(n[0]=(0,l.D$)((()=>{}),["stop","prevent"])),onClick:(0,l.D$)(e.openContextMenu,["stop","prevent"])},null,8,["onClick"]),(0,i.bF)(d,{modelValue:e.showContextMenu,"onUpdate:modelValue":n[1]||(n[1]=n=>e.showContextMenu=n),x:-100,y:0,items:e.contextMenuItems,onClick:e.onContextMenuClick,onPointerdown:n[2]||(n[2]=(0,l.D$)((()=>{}),["stop","prevent"]))},null,8,["modelValue","items","onClick"])])):(0,i.Q3)("",!0)])],8,Re)}]]);let Ke;const De=new Uint8Array(16);function je(){if(!Ke&&(Ke="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ke))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ke(De)}const $e=[];for(let e=0;e<256;++e)$e.push((e+256).toString(16).slice(1));const Ge={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ve(e,n,t){if(Ge.randomUUID&&!n&&!e)return Ge.randomUUID();const o=(e=e||{}).random||(e.rng||je)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n){t=t||0;for(let e=0;e<16;++e)n[t+e]=o[e];return n}return function(e,n=0){return($e[e[n+0]]+$e[e[n+1]]+$e[e[n+2]]+$e[e[n+3]]+"-"+$e[e[n+4]]+$e[e[n+5]]+"-"+$e[e[n+6]]+$e[e[n+7]]+"-"+$e[e[n+8]]+$e[e[n+9]]+"-"+$e[e[n+10]]+$e[e[n+11]]+$e[e[n+12]]+$e[e[n+13]]+$e[e[n+14]]+$e[e[n+15]]).toLowerCase()}(o)}const Ae=(0,i.pM)({props:{intf:{type:Object,required:!0}},setup:e=>({onClick:()=>{e.intf.callback&&e.intf.callback()}})}),Be=["title"],Fe=f(Ae,[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("button",{class:"baklava-button --block",title:e.intf.name,onClick:n[0]||(n[0]=(...n)=>e.onClick&&e.onClick(...n))},(0,a.v_)(e.intf.name),9,Be)}]]);class He extends s.gZ{constructor(e,n){super(e,void 0),this.component=(0,o.IG)(Fe),this.callback=n,this.setPort(!1)}}const Ue=(0,i.pM)({props:{intf:{type:Object,required:!0}}}),qe=["title"],ze=(0,i.Lk)("div",{class:"__checkmark-container"},[(0,i.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18"},[(0,i.Lk)("path",{class:"__checkmark",d:"M 6 5 L 6 10 L 16 10",transform:"rotate(-45 10 10)"})])],-1),Qe={class:"__label"},Ye=f(Ue,[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("div",{class:(0,a.C4)(["baklava-checkbox",{"--checked":e.intf.value}]),title:e.intf.name,onClick:n[0]||(n[0]=n=>e.intf.value=!e.intf.value)},[ze,(0,i.Lk)("div",Qe,(0,a.v_)(e.intf.name),1)],10,qe)}]]);class Je extends s.gZ{constructor(){super(...arguments),this.component=(0,o.IG)(Ye)}}class Ze extends s.gZ{constructor(e,n,t,o){super(e,n),this.min=t,this.max=o}validate(e){return(!this.min||e>=this.min)&&(!this.max||e<=this.max)}}const en=(e,n=3)=>{const t=(0,o.KR)(null),a=(0,o.KR)(!1),l=(0,o.KR)(!1),s=(0,o.KR)("0"),r=(0,i.EW)((()=>{const t=e.value.value.toFixed(n);return t.length>9?e.value.value.toExponential(4):t})),u=n=>!Number.isNaN(n)&&(!function(e){return"validate"in e}(e.value)||e.value.validate(n)),d=n=>{u(n)&&(e.value.value=n)};return(0,i.wB)(s,(()=>{l.value=!1})),{editMode:a,invalid:l,tempValue:s,inputEl:t,stringRepresentation:r,validate:u,setValue:d,enterEditMode:async()=>{s.value=e.value.value.toFixed(n),a.value=!0,await(0,i.dY)(),t.value&&t.value.focus()},leaveEditMode:()=>{const e=parseFloat(s.value);u(e)?(d(e),a.value=!1):l.value=!0}}},nn={},tn={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},on=[(0,i.Lk)("polyline",{points:"6 9 12 15 18 9"},null,-1)],an=f(nn,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",tn,on)}]]),ln=(0,i.pM)({components:{"i-arrow":an},props:{intf:{type:Object,required:!0}},setup(e){const n=en((0,o.lW)(e,"intf"),0);return{...n,increment:()=>{n.setValue(e.intf.value+1)},decrement:()=>{n.setValue(e.intf.value-1)}}}}),sn={class:"baklava-num-input"},rn=["title"],un={class:"__value"},dn={key:1,class:"__content"},cn=f(ln,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("i-arrow");return(0,i.uX)(),(0,i.CE)("div",sn,[(0,i.Lk)("div",{class:"__button --dec",onClick:n[0]||(n[0]=(...n)=>e.decrement&&e.decrement(...n))},[(0,i.bF)(u)]),e.editMode?((0,i.uX)(),(0,i.CE)("div",dn,[(0,i.bo)((0,i.Lk)("input",{ref:"inputEl","onUpdate:modelValue":n[2]||(n[2]=n=>e.tempValue=n),type:"number",class:(0,a.C4)(["baklava-input",{"--invalid":e.invalid}]),style:{"text-align":"right"},onBlur:n[3]||(n[3]=(...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),onKeydown:n[4]||(n[4]=(0,l.jR)(((...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),["enter"]))},null,34),[[l.Jo,e.tempValue]])])):((0,i.uX)(),(0,i.CE)("div",{key:0,class:"__content",onClick:n[1]||(n[1]=(...n)=>e.enterEditMode&&e.enterEditMode(...n))},[(0,i.Lk)("div",{class:"__label",title:e.intf.name},(0,a.v_)(e.intf.name),9,rn),(0,i.Lk)("div",un,(0,a.v_)(e.stringRepresentation),1)])),(0,i.Lk)("div",{class:"__button --inc",onClick:n[5]||(n[5]=(...n)=>e.increment&&e.increment(...n))},[(0,i.bF)(u)])])}]]);class pn extends Ze{constructor(){super(...arguments),this.component=(0,o.IG)(cn)}validate(e){return Number.isInteger(e)&&super.validate(e)}}const vn=(0,i.pM)({components:{"i-arrow":an},props:{intf:{type:Object,required:!0}},setup(e){const n=en((0,o.lW)(e,"intf"));return{...n,increment:()=>{n.setValue(e.intf.value+.1)},decrement:()=>{n.setValue(e.intf.value-.1)}}}}),mn={class:"baklava-num-input"},fn=["title"],hn={class:"__value"},yn={key:1,class:"__content"},gn=f(vn,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("i-arrow");return(0,i.uX)(),(0,i.CE)("div",mn,[(0,i.Lk)("div",{class:"__button --dec",onClick:n[0]||(n[0]=(...n)=>e.decrement&&e.decrement(...n))},[(0,i.bF)(u)]),e.editMode?((0,i.uX)(),(0,i.CE)("div",yn,[(0,i.bo)((0,i.Lk)("input",{ref:"inputEl","onUpdate:modelValue":n[2]||(n[2]=n=>e.tempValue=n),type:"number",class:(0,a.C4)(["baklava-input",{"--invalid":e.invalid}]),style:{"text-align":"right"},onBlur:n[3]||(n[3]=(...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),onKeydown:n[4]||(n[4]=(0,l.jR)(((...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),["enter"]))},null,34),[[l.Jo,e.tempValue]])])):((0,i.uX)(),(0,i.CE)("div",{key:0,class:"__content",onClick:n[1]||(n[1]=(...n)=>e.enterEditMode&&e.enterEditMode(...n))},[(0,i.Lk)("div",{class:"__label",title:e.intf.name},(0,a.v_)(e.intf.name),9,fn),(0,i.Lk)("div",hn,(0,a.v_)(e.stringRepresentation),1)])),(0,i.Lk)("div",{class:"__button --inc",onClick:n[5]||(n[5]=(...n)=>e.increment&&e.increment(...n))},[(0,i.bF)(u)])])}]]);class bn extends Ze{constructor(){super(...arguments),this.component=(0,o.IG)(gn)}}const wn=(0,i.pM)({components:{"i-arrow":an},props:{intf:{type:Object,required:!0}},setup(e){const n=(0,o.KR)(null),t=(0,o.KR)(!1),a=(0,i.EW)((()=>e.intf.items.find((n=>"string"==typeof n?n===e.intf.value:n.value===e.intf.value)))),l=(0,i.EW)((()=>a.value?"string"==typeof a.value?a.value:a.value.text:""));return L(n,(()=>{t.value=!1})),{el:n,open:t,selectedItem:a,selectedText:l,setSelected:n=>{e.intf.value="string"==typeof n?n:n.value}}}}),kn=["title"],xn={class:"__selected"},Cn={class:"__text"},En={class:"__icon"},Mn={class:"__dropdown"},_n={class:"item --header"},Nn=["onClick"],In=f(wn,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("i-arrow");return(0,i.uX)(),(0,i.CE)("div",{ref:"el",class:(0,a.C4)(["baklava-select",{"--open":e.open}]),title:e.intf.name,onClick:n[0]||(n[0]=n=>e.open=!e.open)},[(0,i.Lk)("div",xn,[(0,i.Lk)("div",Cn,(0,a.v_)(e.selectedText),1),(0,i.Lk)("div",En,[(0,i.bF)(u)])]),(0,i.bF)(l.eB,{name:"slide-fade"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.Lk)("div",Mn,[(0,i.Lk)("div",_n,(0,a.v_)(e.intf.name),1),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.intf.items,((n,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:(0,a.C4)(["item",{"--active":n===e.selectedItem}]),onClick:t=>e.setSelected(n)},(0,a.v_)("string"==typeof n?n:n.text),11,Nn)))),128))],512),[[l.aG,e.open]])])),_:1})],10,kn)}]]);class On extends s.gZ{constructor(e,n,t){super(e,n),this.component=(0,o.IG)(In),this.items=t}}const Sn=(0,i.pM)({props:{intf:{type:Object,required:!0}},setup(e){const n=(0,o.KR)(null),t=en((0,o.lW)(e,"intf")),a=(0,o.KR)(!1),l=(0,o.KR)(!1),s=(0,i.EW)((()=>Math.min(100,Math.max(0,100*e.intf.value/(e.intf.max-e.intf.min)))));return{...t,el:n,percentage:s,mousedown:()=>{t.editMode.value||(l.value=!0)},mouseup:()=>{t.editMode.value||(a.value||t.enterEditMode(),l.value=!1,a.value=!1)},mousemove:o=>{if(t.editMode.value)return;const i=Math.max(e.intf.min,Math.min(e.intf.max,(e.intf.max-e.intf.min)*(o.offsetX/n.value.clientWidth)+e.intf.min));l.value&&(t.setValue(i),a.value=!0)},mouseleave:o=>{t.editMode.value||(l.value&&(o.offsetX>=n.value.clientWidth?t.setValue(e.intf.max):o.offsetX<=0&&t.setValue(e.intf.min)),l.value=!1,a.value=!1)}}}}),Ln={key:0,class:"__content"},Rn={class:"__label"},Wn={class:"__value"},Pn={key:1,class:"__content"},Xn=f(Sn,[["render",function(e,n,t,o,s,r){return(0,i.uX)(),(0,i.CE)("div",{ref:"el",class:(0,a.C4)(["baklava-slider",{"baklava-ignore-mouse":!e.editMode}]),onPointerdown:n[3]||(n[3]=(...n)=>e.mousedown&&e.mousedown(...n)),onPointerup:n[4]||(n[4]=(...n)=>e.mouseup&&e.mouseup(...n)),onPointermove:n[5]||(n[5]=(...n)=>e.mousemove&&e.mousemove(...n)),onPointerleave:n[6]||(n[6]=(...n)=>e.mouseleave&&e.mouseleave(...n))},[(0,i.Lk)("div",{class:"__slider",style:(0,a.Tr)({width:e.percentage+"%"})},null,4),e.editMode?((0,i.uX)(),(0,i.CE)("div",Pn,[(0,i.bo)((0,i.Lk)("input",{ref:"inputEl","onUpdate:modelValue":n[0]||(n[0]=n=>e.tempValue=n),type:"number",class:(0,a.C4)(["baklava-input",{"--invalid":e.invalid}]),style:{"text-align":"right"},onBlur:n[1]||(n[1]=(...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),onKeydown:n[2]||(n[2]=(0,l.jR)(((...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),["enter"]))},null,34),[[l.Jo,e.tempValue]])])):((0,i.uX)(),(0,i.CE)("div",Ln,[(0,i.Lk)("div",Rn,(0,a.v_)(e.intf.name),1),(0,i.Lk)("div",Wn,(0,a.v_)(e.stringRepresentation),1)]))],34)}]]),Tn=f((0,i.pM)({props:{intf:{type:Object,required:!0}}}),[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("div",null,(0,a.v_)(e.intf.value),1)}]]);class Kn extends s.gZ{constructor(e,n){super(e,n),this.component=(0,o.IG)(Tn),this.setPort(!1)}}const Dn=(0,i.pM)({props:{intf:{type:Object,required:!0},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup:(e,{emit:n})=>({v:(0,i.EW)({get:()=>e.modelValue,set:e=>{n("update:modelValue",e)}})})}),jn=["placeholder","title"],$n=f(Dn,[["render",function(e,n,t,o,a,s){return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":n[0]||(n[0]=n=>e.v=n),type:"text",class:"baklava-input",placeholder:e.intf.name,title:e.intf.name},null,8,jn),[[l.Jo,e.v]])])}]]);class Gn extends s.gZ{constructor(){super(...arguments),this.component=(0,o.IG)($n)}}const Vn="__baklava_SubgraphInputNode",An="__baklava_SubgraphOutputNode",Bn=(0,s.EA)({type:Vn,title:"Subgraph Input",inputs:{name:()=>new Gn("Name","Input").setPort(!1)},outputs:{placeholder:()=>new s.gZ("Connection",void 0)},onCreate(){this.graphInterfaceId=Ve()}}),Fn=(0,s.EA)({type:An,title:"Subgraph Output",inputs:{name:()=>new Gn("Name","Output").setPort(!1),placeholder:()=>new s.gZ("Connection",void 0)},onCreate(){this.graphInterfaceId=Ve()}});function Hn(e,n,t){if(!n.template)return!1;if((0,s.A9)(n.template)===t)return!0;const o=e.graphTemplates.find((e=>(0,s.A9)(e)===t));return!!o&&o.nodes.filter((e=>e.type.startsWith(s.cO))).some((t=>Hn(e,n,t.type)))}const Un=(0,i.pM)({components:{PaletteEntry:Te},setup(){const{viewModel:e}=d(),{x:n,y:t}=function(e={}){const{target:n=O}=e,t=(0,o.KR)(!1),i=(0,o.KR)(e.initialValue||{});Object.assign(i.value,G,i.value);const a=n=>{t.value=!0,e.pointerTypes&&!e.pointerTypes.includes(n.pointerType)||(i.value=function(e,n,t=!1){return n.reduce(((n,o)=>(o in e&&(t&&void 0===e[o]||(n[o]=e[o])),n)),{})}(n,V,!1))};return n&&(S(n,"pointerdown",a,{passive:!0}),S(n,"pointermove",a,{passive:!0}),S(n,"pointerleave",(()=>t.value=!1),{passive:!0})),l=((e,n)=>{for(var t in n||(n={}))D.call(n,t)&&$(e,t,n[t]);if(K)for(var t of K(n))j.call(n,t)&&$(e,t,n[t]);return e})({},function(e){if(!(0,o.i9)(e))return(0,o.QW)(e);const n=Array.isArray(e.value)?new Array(e.value.length):{};for(const t in e.value)n[t]=(0,o.rY)((()=>({get:()=>e.value[t],set(n){if(Array.isArray(e.value)){const o=[...e.value];o[t]=n,e.value=o}else{const i=(o=N({},e.value),k(o,x({[t]:n})));Object.setPrototypeOf(i,e.value),e.value=i}var o}})));return n}(i)),X(l,T({isInside:t}));var l}(),{transform:a}=v(),l=(0,i.WQ)("editorEl"),s=(0,o.KR)(null),r=(0,i.EW)((()=>{const n=Array.from(e.value.editor.nodeTypes.entries()),t=new Set(n.map((([,e])=>e.category))),o=[];for(const i of t.values()){let t=n.filter((([,e])=>e.category===i));t=e.value.displayedGraph.template?t.filter((([n])=>!Hn(e.value.editor,e.value.displayedGraph,n))):t.filter((([e])=>![Vn,An].includes(e))),t.length>0&&o.push({name:i,nodeTypes:Object.fromEntries(t)})}return o.sort(((e,n)=>"default"===e.name?-1:"default"===n.name||e.name>n.name?1:-1)),o})),u=(0,i.EW)((()=>{if(!s.value||!(null==l?void 0:l.value))return{};const{left:e,top:o}=l.value.getBoundingClientRect();return{top:t.value-o+"px",left:n.value-e+"px"}}));return{draggedNode:s,categories:r,draggedNodeStyles:u,onDragStart:(i,r)=>{s.value={type:i,nodeInformation:r};const u=()=>{const i=(0,o.Kh)(new r.type);e.value.displayedGraph.addNode(i);const d=l.value.getBoundingClientRect(),[c,p]=a(n.value-d.left,t.value-d.top);i.position.x=c,i.position.y=p,s.value=null,document.removeEventListener("pointerup",u)};document.addEventListener("pointerup",u)},mouseX:n,mouseY:t}}}),qn={class:"baklava-node-palette"},zn={key:0},Qn=f(Un,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("PaletteEntry");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",qn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.categories,(n=>((0,i.uX)(),(0,i.CE)("section",{key:n.name},["default"!==n.name?((0,i.uX)(),(0,i.CE)("h1",zn,(0,a.v_)(n.name),1)):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.nodeTypes,((n,t)=>((0,i.uX)(),(0,i.Wv)(u,{key:t,type:t,title:n.title,onPointerdown:o=>e.onDragStart(t,n)},null,8,["type","title","onPointerdown"])))),128))])))),128))]),(0,i.bF)(l.eB,{name:"fade"},{default:(0,i.k6)((()=>[e.draggedNode?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"baklava-dragged-node",style:(0,a.Tr)(e.draggedNodeStyles)},[(0,i.bF)(u,{type:e.draggedNode.type,title:e.draggedNode.nodeInformation.title},null,8,["type","title"])],4)):(0,i.Q3)("",!0)])),_:1})],64)}]]),Yn="SAVE_SUBGRAPH",Jn="CREATE_SUBGRAPH",Zn=[Vn,An],et="DELETE_NODES",nt="SWITCH_TO_MAIN_GRAPH";class tt{constructor(e,n){this.type=e,"addNode"===e?this.nodeId=n:this.nodeState=n}undo(e){"addNode"===this.type?this.removeNode(e):this.addNode(e)}redo(e){"addNode"===this.type&&this.nodeState?this.addNode(e):"removeNode"===this.type&&this.nodeId&&this.removeNode(e)}addNode(e){const n=e.editor.nodeTypes.get(this.nodeState.type);if(!n)return;const t=new n.type;e.addNode(t),t.load(this.nodeState),this.nodeId=t.id}removeNode(e){const n=e.nodes.find((e=>e.id===this.nodeId));n&&(this.nodeState=n.save(),e.removeNode(n))}}class ot{constructor(e,n){if(this.type=e,"addConnection"===e)this.connectionId=n;else{const e=n;this.connectionState={id:e.id,from:e.from.id,to:e.to.id}}}undo(e){"addConnection"===this.type?this.removeConnection(e):this.addConnection(e)}redo(e){"addConnection"===this.type&&this.connectionState?this.addConnection(e):"removeConnection"===this.type&&this.connectionId&&this.removeConnection(e)}addConnection(e){const n=e.findNodeInterface(this.connectionState.from),t=e.findNodeInterface(this.connectionState.to);n&&t&&e.addConnection(n,t)}removeConnection(e){const n=e.connections.find((e=>e.id===this.connectionId));n&&(this.connectionState={id:n.id,from:n.from.id,to:n.to.id},e.removeConnection(n))}}class it{constructor(e){if(this.type="transaction",0===e.length)throw new Error("Can't create a transaction with no steps");this.steps=e}undo(e){for(let n=this.steps.length-1;n>=0;n--)this.steps[n].undo(e)}redo(e){for(let n=0;n<this.steps.length;n++)this.steps[n].redo(e)}}const at="UNDO",lt="REDO",st="START_TRANSACTION",rt="COMMIT_TRANSACTION",ut="COPY",dt="PASTE",ct="CLEAR_CLIPBOARD",pt="OPEN_SIDEBAR";Symbol.toStringTag;const vt={},mt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},ft=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("path",{d:"M9 13l-4 -4l4 -4m-4 4h11a4 4 0 0 1 0 8h-1"},null,-1)],ht=f(vt,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",mt,ft)}]]),yt={},gt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},bt=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("path",{d:"M15 13l4 -4l-4 -4m4 4h-11a4 4 0 0 0 0 8h1"},null,-1)],wt=f(yt,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",gt,bt)}]]),kt={},xt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Ct=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("line",{x1:"5",y1:"12",x2:"19",y2:"12"},null,-1),(0,i.Lk)("line",{x1:"5",y1:"12",x2:"11",y2:"18"},null,-1),(0,i.Lk)("line",{x1:"5",y1:"12",x2:"11",y2:"6"},null,-1)],Et=f(kt,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",xt,Ct)}]]),Mt={},_t={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Nt=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"},null,-1),(0,i.Lk)("rect",{x:"9",y:"3",width:"6",height:"4",rx:"2"},null,-1)],It=f(Mt,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",_t,Nt)}]]),Ot={},St={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Lt=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2"},null,-1),(0,i.Lk)("path",{d:"M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"},null,-1)],Rt=f(Ot,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",St,Lt)}]]),Wt={},Pt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Xt=[(0,i.Lk)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i.Lk)("path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"},null,-1),(0,i.Lk)("circle",{cx:"12",cy:"14",r:"2"},null,-1),(0,i.Lk)("polyline",{points:"14 4 14 8 8 8 8 4"},null,-1)],Tt=f(Wt,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",Pt,Xt)}]]),Kt={},Dt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},jt=[(0,i.Fv)('<path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 3h4v4h-4z"></path><path d="M3 17h4v4h-4z"></path><path d="M17 17h4v4h-4z"></path><path d="M7 17l5 -4l5 4"></path><line x1="12" y1="7" x2="12" y2="13"></line>',6)],$t=f(Kt,[["render",function(e,n){return(0,i.uX)(),(0,i.CE)("svg",Dt,jt)}]]),Gt=(0,i.pM)({props:{command:{type:String,required:!0},title:{type:String,required:!0},icon:{type:Object,required:!1,default:void 0}},setup(){const{viewModel:e}=d();return{viewModel:e}}}),Vt=["disabled","title"],At=f(Gt,[["render",function(e,n,t,o,l,s){return(0,i.uX)(),(0,i.CE)("button",{class:"baklava-toolbar-entry baklava-toolbar-button",disabled:!e.viewModel.commandHandler.canExecuteCommand(e.command),title:e.title,onClick:n[0]||(n[0]=n=>e.viewModel.commandHandler.executeCommand(e.command))},[e.icon?((0,i.uX)(),(0,i.Wv)((0,i.$y)(e.icon),{key:0})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.eW)((0,a.v_)(e.title),1)],64))],8,Vt)}]]),Bt=(0,i.pM)({components:{ToolbarButton:At},setup(){const{viewModel:e}=d();return{isSubgraph:(0,i.EW)((()=>e.value.displayedGraph!==e.value.editor.graph)),commands:[{command:ut,title:"Copy",icon:Rt},{command:dt,title:"Paste",icon:It},{command:at,title:"Undo",icon:ht},{command:lt,title:"Redo",icon:wt},{command:Jn,title:"Create Subgraph",icon:$t}],subgraphCommands:[{command:Yn,title:"Save Subgraph",icon:Tt},{command:nt,title:"Back to Main Graph",icon:Et}]}}}),Ft={class:"baklava-toolbar"},Ht=f(Bt,[["render",function(e,n,t,o,a,l){const s=(0,i.g2)("toolbar-button");return(0,i.uX)(),(0,i.CE)("div",Ft,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.commands,(e=>((0,i.uX)(),(0,i.Wv)(s,{key:e.command,command:e.command,title:e.title,icon:e.icon},null,8,["command","title","icon"])))),128)),e.isSubgraph?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:0},(0,i.pI)(e.subgraphCommands,(e=>((0,i.uX)(),(0,i.Wv)(s,{key:e.command,command:e.command,title:e.title,icon:e.icon},null,8,["command","title","icon"])))),128)):(0,i.Q3)("",!0)])}]]),Ut=(0,i.pM)({components:{Background:h,Node:ge,ConnectionWrapper:Ce,TemporaryConnection:Me,Sidebar:Oe,Minimap:Se,NodePalette:Qn,Toolbar:Ht},props:{viewModel:{type:Object,required:!0}},setup(e){const n=Symbol("EditorToken"),t=(0,o.lW)(e,"viewModel");u=t;const a=(0,o.KR)(null);(0,i.Gt)("editorEl",a);const l=(0,i.EW)((()=>e.viewModel.displayedGraph.nodes)),s=(0,i.EW)((()=>e.viewModel.displayedGraph.connections)),r=(0,i.EW)((()=>e.viewModel.displayedGraph.selectedNodes)),d=function(){const{graph:e}=c();let n=[],t=-1,o={x:0,y:0};const a=p((0,i.EW)((()=>e.value.panning))),l=(0,i.EW)((()=>({"transform-origin":"0 0",transform:`scale(${e.value.scaling}) translate(${e.value.panning.x}px, ${e.value.panning.y}px)`}))),s=(n,t,o)=>{const i=[n/e.value.scaling-e.value.panning.x,t/e.value.scaling-e.value.panning.y],a=[n/o-e.value.panning.x,t/o-e.value.panning.y],l=[a[0]-i[0],a[1]-i[1]];e.value.panning.x+=l[0],e.value.panning.y+=l[1],e.value.scaling=o},r=()=>({ax:n[0].clientX,ay:n[0].clientY,bx:n[1].clientX,by:n[1].clientY});return{styles:l,...a,onPointerDown:e=>{if(n.push(e),a.onPointerDown(e),2===n.length){const{ax:e,ay:n,bx:t,by:i}=r();o={x:e+(t-e)/2,y:n+(i-n)/2}}},onPointerMove:i=>{for(let e=0;e<n.length;e++)if(i.pointerId==n[e].pointerId){n[e]=i;break}if(2==n.length){const{ax:n,ay:i,bx:a,by:l}=r(),u=n-a,d=i-l,c=Math.sqrt(u*u+d*d);if(t>0){const n=e.value.scaling*(1+(c-t)/500);s(o.x,o.y,n)}t=c}else a.onPointerMove(i)},onPointerUp:e=>{n=n.filter((n=>n.pointerId!==e.pointerId)),t=-1,a.onPointerUp()},onMouseWheel:n=>{n.preventDefault();let t=n.deltaY;1===n.deltaMode&&(t*=32);const o=e.value.scaling*(1-t/3e3);s(n.offsetX,n.offsetY,o)}}}(),v=function(){const{graph:e}=c(),n=(0,o.KR)(null),t=(0,o.KR)(null);return(0,i.Gt)("hoveredOver",(o=>{if(t.value=o??null,o&&n.value){n.value.to=o;const t=e.value.checkConnection(n.value.from,n.value.to);if(n.value.status=t.connectionAllowed?m.ALLOWED:m.FORBIDDEN,t.connectionAllowed){const n=t.connectionsInDanger.map((e=>e.id));e.value.connections.forEach((e=>{n.includes(e.id)&&(e.isInDanger=!0)}))}}else!o&&n.value&&(n.value.to=void 0,n.value.status=m.NONE,e.value.connections.forEach((e=>{e.isInDanger=!1})))})),{temporaryConnection:n,onMouseMove:t=>{n.value&&(n.value.mx=t.offsetX/e.value.scaling-e.value.panning.x,n.value.my=t.offsetY/e.value.scaling-e.value.panning.y)},onMouseDown:()=>{if(t.value){const o=e.value.connections.find((e=>e.to===t.value));t.value.isInput&&o?(n.value={status:m.NONE,from:o.from},e.value.removeConnection(o)):n.value={status:m.NONE,from:t.value},n.value.mx=void 0,n.value.my=void 0}},onMouseUp:()=>{n.value&&t.value&&e.value.addConnection(n.value.from,n.value.to),n.value=null}}}(),f=(0,i.EW)((()=>({...d.styles.value}))),h=(0,o.KR)(0);e.viewModel.editor.hooks.load.subscribe(n,(e=>(h.value++,e)));const y=()=>{e.viewModel.displayedGraph.selectedNodes=[]};return{el:a,counter:h,nodes:l,connections:s,selectedNodes:r,nodeContainerStyle:f,onPointerMove:e=>{d.onPointerMove(e),v.onMouseMove(e)},onPointerDown:e=>{0===e.button&&(e.target===a.value&&(y(),d.onPointerDown(e)),v.onMouseDown())},onPointerUp:e=>{d.onPointerUp(e),v.onMouseUp()},keyDown:n=>{"Tab"===n.key&&n.preventDefault(),e.viewModel.commandHandler.handleKeyDown(n)},keyUp:n=>{e.viewModel.commandHandler.handleKeyUp(n)},selectNode:n=>{e.viewModel.commandHandler.pressedKeys.includes("Control")||y(),e.viewModel.displayedGraph.selectedNodes.push(n)},temporaryConnection:v.temporaryConnection,mouseWheel:d.onMouseWheel,dragging:d.dragging}}}),qt={class:"connections-container"},zt=f(Ut,[["render",function(e,n,t,o,s,r){const u=(0,i.g2)("background"),d=(0,i.g2)("toolbar"),c=(0,i.g2)("node-palette"),p=(0,i.g2)("connection-wrapper"),v=(0,i.g2)("temporary-connection"),m=(0,i.g2)("node"),f=(0,i.g2)("sidebar"),h=(0,i.g2)("minimap");return(0,i.uX)(),(0,i.CE)("div",{ref:"el",tabindex:"-1",class:(0,a.C4)(["baklava-editor",{"baklava-ignore-mouse":!!e.temporaryConnection||e.dragging,"--temporary-connection":!!e.temporaryConnection}]),onPointermove:n[0]||(n[0]=(0,l.D$)(((...n)=>e.onPointerMove&&e.onPointerMove(...n)),["self"])),onPointerdown:n[1]||(n[1]=(...n)=>e.onPointerDown&&e.onPointerDown(...n)),onPointerup:n[2]||(n[2]=(...n)=>e.onPointerUp&&e.onPointerUp(...n)),onWheel:n[3]||(n[3]=(0,l.D$)(((...n)=>e.mouseWheel&&e.mouseWheel(...n)),["self"])),onKeydown:n[4]||(n[4]=(...n)=>e.keyDown&&e.keyDown(...n)),onKeyup:n[5]||(n[5]=(...n)=>e.keyUp&&e.keyUp(...n))},[(0,i.RG)(e.$slots,"background",{},(()=>[(0,i.bF)(u)])),(0,i.RG)(e.$slots,"toolbar",{},(()=>[(0,i.bF)(d)])),(0,i.RG)(e.$slots,"palette",{},(()=>[(0,i.bF)(c)])),((0,i.uX)(),(0,i.CE)("svg",qt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.connections,(n=>((0,i.uX)(),(0,i.CE)("g",{key:n.id+e.counter.toString()},[(0,i.RG)(e.$slots,"connection",{connection:n},(()=>[(0,i.bF)(p,{connection:n},null,8,["connection"])]))])))),128)),(0,i.RG)(e.$slots,"temporaryConnection",{temporaryConnection:e.temporaryConnection},(()=>[e.temporaryConnection?((0,i.uX)(),(0,i.Wv)(v,{key:0,connection:e.temporaryConnection},null,8,["connection"])):(0,i.Q3)("",!0)]))])),(0,i.Lk)("div",{class:"node-container",style:(0,a.Tr)(e.nodeContainerStyle)},[(0,i.bF)(l.F,{name:"fade"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.nodes,(n=>(0,i.RG)(e.$slots,"node",{node:n,selected:e.selectedNodes.includes(n),onSelect:t=>e.selectNode(n)},(()=>[((0,i.uX)(),(0,i.Wv)(m,{key:n.id+e.counter.toString(),node:n,selected:e.selectedNodes.includes(n),onSelect:t=>e.selectNode(n)},null,8,["node","selected","onSelect"]))])))),256))])),_:3})],4),(0,i.RG)(e.$slots,"sidebar",{},(()=>[(0,i.bF)(f)])),(0,i.RG)(e.$slots,"minimap",{},(()=>[e.viewModel.settings.enableMinimap?((0,i.uX)(),(0,i.Wv)(h,{key:0})):(0,i.Q3)("",!0)]))],34)}]]),Qt=()=>{const e=(0,o.KR)(new Map),n=(n,t=!1,...o)=>{if(e.value.has(n))return e.value.get(n).execute(...o);if(t)throw new Error(`[CommandHandler] Command ${n} not registered`)},t=function(e){const n=(0,o.KR)([]),t=(0,o.KR)([]);return{pressedKeys:n,handleKeyDown:o=>{n.value.includes(o.key)||n.value.push(o.key),t.value.forEach((t=>{t.keys.every((e=>n.value.includes(e)))&&e(t.commandName)}))},handleKeyUp:e=>{const t=n.value.indexOf(e.key);t>=0&&n.value.splice(t,1)},registerHotkey:(e,n)=>{t.value.push({keys:e,commandName:n})}}}(n);return(0,o.Kh)({registerCommand:(n,t)=>{if(e.value.has(n))throw new Error(`Command "${n}" already exists`);e.value.set(n,t)},executeCommand:n,canExecuteCommand:(n,t=!1,...o)=>{if(!e.value.has(n)){if(t)throw new Error(`[CommandHandler] Command ${n} not registered`);return!1}return e.value.get(n).canExecute(o)},...t})},Yt=e=>!(e instanceof s.TS);function Jt(e){const n=(0,o.KR)(e??new s.KE),t=Symbol("ViewModelToken"),a=(0,o.KR)(null),l=(0,o.nD)(a),{switchGraph:u}=function(e,n){return{switchGraph:t=>{let o;if(Yt(t))o=new s.TS(e.value),t.createGraph(o),o.inputs.forEach((e=>{const n=new Bn;n.inputs.name.value=e.name,n.graphInterfaceId=e.id,o.addNode(n);const t=o.findNodeInterface(e.nodeInterfaceId);t?o.addConnection(n.outputs.placeholder,t):console.warn(`Could not find target interface ${e.nodeInterfaceId} for subgraph input node`)})),o.outputs.forEach((e=>{const n=new Fn;n.inputs.name.value=e.name,n.graphInterfaceId=e.id,o.addNode(n);const t=o.findNodeInterface(e.nodeInterfaceId);t?o.addConnection(t,n.inputs.placeholder):console.warn(`Could not find target interface ${e.nodeInterfaceId} for subgraph input node`)}));else{if(t!==e.value.graph)throw new Error("Can only switch using 'Graph' instance when it is the root graph. Otherwise a 'GraphTemplate' must be used.");o=t}n.value&&n.value!==e.value.graph&&n.value.destroy(),o.panning=o.panning??t.panning??{x:0,y:0},o.scaling=o.scaling??t.scaling??1,o.selectedNodes=o.selectedNodes??[],o.sidebar=o.sidebar??{visible:!1,nodeId:"",optionName:""},n.value=o}}}(n,a),d=(0,i.EW)((()=>l.value&&l.value!==n.value.graph)),c=(0,o.Kh)({useStraightConnections:!1,enableMinimap:!1,background:{gridSize:100,gridDivision:5,subGridVisibleThreshold:.6}}),p=Qt(),v=function(e,n){const t=Symbol("HistoryToken"),a=(0,o.KR)(200),l=(0,o.KR)([]),s=(0,o.KR)(!1),r=(0,o.KR)(-1),u=(0,o.KR)(!1),d=(0,o.KR)([]),c=e=>{if(!s.value)if(u.value)d.value.push(e);else for(r.value!==l.value.length-1&&(l.value=l.value.slice(0,r.value+1)),l.value.push(e),r.value++;l.value.length>a.value;)l.value.shift()},p=()=>0!==l.value.length&&-1!==r.value,v=()=>0!==l.value.length&&r.value<l.value.length-1;return(0,i.wB)(e,((e,n)=>{n&&(n.events.addNode.unsubscribe(t),n.events.removeNode.unsubscribe(t),n.events.addConnection.unsubscribe(t),n.events.removeConnection.unsubscribe(t)),e&&(e.events.addNode.subscribe(t,(e=>{c(new tt("addNode",e.id))})),e.events.removeNode.subscribe(t,(e=>{c(new tt("removeNode",e.save()))})),e.events.addConnection.subscribe(t,(e=>{c(new ot("addConnection",e.id))})),e.events.removeConnection.subscribe(t,(e=>{c(new ot("removeConnection",e))})))}),{immediate:!0}),n.registerCommand(at,{canExecute:p,execute:()=>{p()&&(s.value=!0,l.value[r.value--].undo(e.value),s.value=!1)}}),n.registerCommand(lt,{canExecute:v,execute:()=>{v()&&(s.value=!0,l.value[++r.value].redo(e.value),s.value=!1)}}),n.registerCommand(st,{canExecute:()=>!u.value,execute:()=>{u.value=!0}}),n.registerCommand(rt,{canExecute:()=>u.value,execute:()=>{u.value=!1,d.value.length>0&&(c(new it(d.value)),d.value=[])}}),n.registerHotkey(["Control","z"],at),n.registerHotkey(["Control","y"],lt),(0,o.Kh)({maxSteps:a})}(l,p),m=function(e,n,t){const a=Symbol("ClipboardToken"),l=(0,o.KR)(""),s=(0,o.KR)(""),r=(0,i.EW)((()=>!l.value)),u=(e,n,t)=>{for(const o of e){let e;if(t&&"input"!==t||(e=Object.values(o.inputs).find((e=>e.id===n))),e||t&&"output"!==t||(e=Object.values(o.outputs).find((e=>e.id===n))),e)return e}};return t.registerCommand(ut,{canExecute:()=>!0,execute:()=>{const n=e.value.selectedNodes.flatMap((e=>[...Object.values(e.inputs),...Object.values(e.outputs)])),t=e.value.connections.filter((e=>n.includes(e.from)||n.includes(e.to))).map((e=>({from:e.from.id,to:e.to.id})));s.value=JSON.stringify(t),l.value=JSON.stringify(e.value.selectedNodes.map((e=>e.save())))}}),t.registerHotkey(["Control","c"],ut),t.registerCommand(dt,{canExecute:()=>!r.value,execute:()=>{if(r.value)return;const o=new Map,i=JSON.parse(l.value),d=JSON.parse(s.value),c=[],p=[],v=e.value;t.executeCommand(st);for(const e of i){const t=n.value.nodeTypes.get(e.type);if(!t)return void console.warn(`Node type ${e.type} not registered`);const i=new t.type,l=i.id;c.push(i);const s=e=>{Object.values(e).forEach((e=>{e.hooks.load.subscribe(a,(n=>{const t=Ve();return o.set(n.id,t),e.id=t,e.hooks.load.unsubscribe(a),n}))}))};s(i.inputs),s(i.outputs),i.hooks.beforeLoad.subscribe(a,(e=>{const n=e;return n.position&&(n.position.x+=10,n.position.y+=10),i.hooks.beforeLoad.unsubscribe(a),n})),v.addNode(i),i.load(e),i.id=l,o.set(e.id,l)}for(const e of d){const n=u(c,o.get(e.from),"output"),t=u(c,o.get(e.to),"input");if(!n||!t)continue;const i=v.addConnection(n,t);i&&p.push(i)}return t.executeCommand(rt),{newNodes:c,newConnections:p}}}),t.registerHotkey(["Control","v"],dt),t.registerCommand(ct,{canExecute:()=>!0,execute:()=>{l.value="",s.value=""}}),(0,o.Kh)({isEmpty:r})}(l,n,p),f={renderNode:new r.vz(null),renderInterface:new r.vz(null)};return function(e,n,t){!function(e,n){n.registerCommand(et,{canExecute:()=>e.value.selectedNodes.length>0,execute(){e.value.selectedNodes.forEach((n=>e.value.removeNode(n)))}}),n.registerHotkey(["Delete"],et)}(e,n),function(e,n,t){n.registerCommand(Jn,{canExecute:()=>e.value.selectedNodes.filter((e=>!Zn.includes(e.type))).length>0,execute:()=>{const i=e.value,a=e.value.editor;if(0===i.selectedNodes.length)return;const l=i.selectedNodes.filter((e=>!Zn.includes(e.type))),r=l.flatMap((e=>Object.values(e.inputs))),u=l.flatMap((e=>Object.values(e.outputs))),d=i.connections.filter((e=>!u.includes(e.from)&&r.includes(e.to))),c=i.connections.filter((e=>u.includes(e.from)&&!r.includes(e.to))),p=i.connections.filter((e=>u.includes(e.from)&&r.includes(e.to))),v=d.map((e=>e.to)),m=c.map((e=>e.from)),f=new Map,h=[];for(const e of v){const n=Ve();f.set(e.id,n),h.push({id:n,nodeInterfaceId:e.id,name:e.name})}const y=[];for(const e of m){const n=Ve();f.set(e.id,n),y.push({id:n,nodeInterfaceId:e.id,name:e.name})}const g=(0,o.Kh)(new s.b1({connections:p.map((e=>({id:e.id,from:e.from.id,to:e.to.id}))),inputs:h,outputs:y,nodes:l.map((e=>e.save()))},a));a.addGraphTemplate(g);const b=a.nodeTypes.get((0,s.A9)(g));if(!b)throw new Error("Unable to create subgraph: Could not find corresponding graph node type");const w=(0,o.Kh)(new b.type);i.addNode(w);const k=Math.round(l.map((e=>e.position.x)).reduce(((e,n)=>e+n),0)/l.length),x=Math.round(l.map((e=>e.position.y)).reduce(((e,n)=>e+n),0)/l.length);w.position.x=k,w.position.y=x,d.forEach((e=>{i.removeConnection(e),i.addConnection(e.from,w.inputs[f.get(e.to.id)])})),c.forEach((e=>{i.removeConnection(e),i.addConnection(w.outputs[f.get(e.from.id)],e.to)})),l.forEach((e=>i.removeNode(e))),n.canExecuteCommand(Yn)&&n.executeCommand(Yn),t(g),e.value.panning={...i.panning},e.value.scaling=i.scaling}})}(e,n,t),function(e,n){n.registerCommand(Yn,{canExecute:()=>{var n;return e.value!==(null==(n=e.value.editor)?void 0:n.graph)},execute:()=>{const n=e.value;if(!n.template)throw new Error("Graph template property not set");const t=[],o=[],i=n.nodes.filter((e=>e.type===Vn));for(const e of i){const i=n.connections.filter((n=>n.from===e.outputs.placeholder));i.forEach((n=>{o.push({id:e.graphInterfaceId,name:e.inputs.name.value,nodeInterfaceId:n.to.id})})),t.push(...i)}const a=[],l=n.nodes.filter((e=>e.type===An));for(const e of l){const o=n.connections.filter((n=>n.to===e.inputs.placeholder));o.forEach((n=>{a.push({id:e.graphInterfaceId,name:e.inputs.name.value,nodeInterfaceId:n.from.id})})),t.push(...o)}const s=n.connections.filter((e=>!t.includes(e))),r=n.nodes.filter((e=>e.type!==Vn&&e.type!==An));n.template.update({inputs:o,outputs:a,connections:s.map((e=>({id:e.id,from:e.from.id,to:e.to.id}))),nodes:r.map((e=>e.save()))}),n.template.panning=n.panning,n.template.scaling=n.scaling}})}(e,n),function(e,n,t){n.registerCommand(nt,{canExecute:()=>e.value!==e.value.editor.graph,execute:()=>{n.executeCommand(Yn),t(e.value.editor.graph)}})}(e,n,t)}(l,p,u),function(e,n){!function(e,n){n.registerCommand(pt,{execute:n=>{e.value.sidebar.nodeId=n,e.value.sidebar.visible=!0},canExecute:()=>!0})}(e,n)}(l,p),(0,i.wB)(n,((e,o)=>{o&&(o.events.registerGraph.unsubscribe(t),o.graphEvents.beforeAddNode.unsubscribe(t),e.nodeHooks.beforeLoad.unsubscribe(t),e.nodeHooks.afterSave.unsubscribe(t),e.graphTemplateHooks.beforeLoad.unsubscribe(t),e.graphTemplateHooks.afterSave.unsubscribe(t)),e&&(e.nodeHooks.beforeLoad.subscribe(t,((e,n)=>(n.position=e.position??{x:0,y:0},n.width=e.width??200,n.twoColumn=e.twoColumn??!1,e))),e.nodeHooks.afterSave.subscribe(t,((e,n)=>(e.position=n.position,e.width=n.width,e.twoColumn=n.twoColumn,e))),e.graphTemplateHooks.beforeLoad.subscribe(t,((e,n)=>(n.panning=e.panning,n.scaling=e.scaling,e))),e.graphTemplateHooks.afterSave.subscribe(t,((e,n)=>(e.panning=n.panning,e.scaling=n.scaling,e))),e.graphEvents.beforeAddNode.subscribe(t,(e=>function(e){e.position=e.position??{x:0,y:0},e.disablePointerEvents=!1,e.twoColumn=e.twoColumn??!1,e.width=e.width??200}(e))),n.value.registerNodeType(Bn,{category:"Subgraphs"}),n.value.registerNodeType(Fn,{category:"Subgraphs"}),u(e.graph))}),{immediate:!0}),(0,o.Kh)({editor:n,displayedGraph:l,isSubgraph:d,settings:c,commandHandler:p,history:v,clipboard:m,hooks:f,switchGraph:u})}const Zt=Object.freeze(Object.defineProperty({__proto__:null,Connection:ke,ConnectionWrapper:Ce,TemporaryConnection:Me,Node:ge,NodeInterface:ue,ContextMenu:ne,Minimap:Se,Sidebar:Oe},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=491.c36af9ad.js.map