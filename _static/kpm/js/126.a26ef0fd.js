"use strict";(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[126],{78126:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t){this.scale=t,this.AB=0,this.AD=0,this.A2=0}return t.prototype.addVariable=function(t){var i=this.scale/t.scale,s=t.offset/t.scale,e=t.weight;this.AB+=e*i*s,this.AD+=e*i*t.desiredPosition,this.A2+=e*i*i},t.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},t}();i.PositionStats=s;var e=function(){function t(t,i,s,e){void 0===e&&(e=!1),this.left=t,this.right=i,this.gap=s,this.equality=e,this.active=!1,this.unsatisfiable=!1,this.left=t,this.right=i,this.gap=s,this.equality=e}return t.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},t}();i.Constraint=e;var n=function(){function t(t,i,s){void 0===i&&(i=1),void 0===s&&(s=1),this.desiredPosition=t,this.weight=i,this.scale=s,this.offset=0}return t.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},t.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},t.prototype.visitNeighbours=function(t,i){var s=function(s,e){return s.active&&t!==e&&i(s,e)};this.cOut.forEach((function(t){return s(t,t.right)})),this.cIn.forEach((function(t){return s(t,t.left)}))},t}();i.Variable=n;var o=function(){function t(t){this.vars=[],t.offset=0,this.ps=new s(t.scale),this.addVariable(t)}return t.prototype.addVariable=function(t){t.block=this,this.vars.push(t),this.ps.addVariable(t),this.posn=this.ps.getPosn()},t.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var t=0,i=this.vars.length;t<i;++t)this.ps.addVariable(this.vars[t]);this.posn=this.ps.getPosn()},t.prototype.compute_lm=function(t,i,s){var e=this,n=t.dfdv();return t.visitNeighbours(i,(function(i,o){var r=e.compute_lm(o,t,s);o===i.right?(n+=r*i.left.scale,i.lm=r):(n+=r*i.right.scale,i.lm=-r),s(i)})),n/t.scale},t.prototype.populateSplitBlock=function(t,i){var s=this;t.visitNeighbours(i,(function(i,e){e.offset=t.offset+(e===i.right?i.gap:-i.gap),s.addVariable(e),s.populateSplitBlock(e,t)}))},t.prototype.traverse=function(t,i,s,e){var n=this;void 0===s&&(s=this.vars[0]),void 0===e&&(e=null),s.visitNeighbours(e,(function(e,o){i.push(t(e)),n.traverse(t,i,o,s)}))},t.prototype.findMinLM=function(){var t=null;return this.compute_lm(this.vars[0],null,(function(i){!i.equality&&(null===t||i.lm<t.lm)&&(t=i)})),t},t.prototype.findMinLMBetween=function(t,i){this.compute_lm(t,null,(function(){}));var s=null;return this.findPath(t,null,i,(function(t,i){!t.equality&&t.right===i&&(null===s||t.lm<s.lm)&&(s=t)})),s},t.prototype.findPath=function(t,i,s,e){var n=this,o=!1;return t.visitNeighbours(i,(function(i,r){o||r!==s&&!n.findPath(r,t,s,e)||(o=!0,e(i,r))})),o},t.prototype.isActiveDirectedPathBetween=function(t,i){if(t===i)return!0;for(var s=t.cOut.length;s--;){var e=t.cOut[s];if(e.active&&this.isActiveDirectedPathBetween(e.right,i))return!0}return!1},t.split=function(i){return i.active=!1,[t.createSplitBlock(i.left),t.createSplitBlock(i.right)]},t.createSplitBlock=function(i){var s=new t(i);return s.populateSplitBlock(i,null),s},t.prototype.splitBetween=function(i,s){var e=this.findMinLMBetween(i,s);if(null!==e){var n=t.split(e);return{constraint:e,lb:n[0],rb:n[1]}}return null},t.prototype.mergeAcross=function(t,i,s){i.active=!0;for(var e=0,n=t.vars.length;e<n;++e){var o=t.vars[e];o.offset+=s,this.addVariable(o)}this.posn=this.ps.getPosn()},t.prototype.cost=function(){for(var t=0,i=this.vars.length;i--;){var s=this.vars[i],e=s.position()-s.desiredPosition;t+=e*e*s.weight}return t},t}();i.Block=o;var r=function(){function t(t){this.vs=t;var i=t.length;for(this.list=new Array(i);i--;){var s=new o(t[i]);this.list[i]=s,s.blockInd=i}}return t.prototype.cost=function(){for(var t=0,i=this.list.length;i--;)t+=this.list[i].cost();return t},t.prototype.insert=function(t){t.blockInd=this.list.length,this.list.push(t)},t.prototype.remove=function(t){var i=this.list.length-1,s=this.list[i];this.list.length=i,t!==s&&(this.list[t.blockInd]=s,s.blockInd=t.blockInd)},t.prototype.merge=function(t){var i=t.left.block,s=t.right.block,e=t.right.offset-t.left.offset-t.gap;i.vars.length<s.vars.length?(s.mergeAcross(i,t,e),this.remove(i)):(i.mergeAcross(s,t,-e),this.remove(s))},t.prototype.forEach=function(t){this.list.forEach(t)},t.prototype.updateBlockPositions=function(){this.list.forEach((function(t){return t.updateWeightedPosition()}))},t.prototype.split=function(t){var i=this;this.updateBlockPositions(),this.list.forEach((function(s){var e=s.findMinLM();null!==e&&e.lm<h.LAGRANGIAN_TOLERANCE&&(s=e.left.block,o.split(e).forEach((function(t){return i.insert(t)})),i.remove(s),t.push(e))}))},t}();i.Blocks=r;var h=function(){function t(t,i){this.vs=t,this.cs=i,this.vs=t,t.forEach((function(t){t.cIn=[],t.cOut=[]})),this.cs=i,i.forEach((function(t){t.left.cOut.push(t),t.right.cIn.push(t)})),this.inactive=i.map((function(t){return t.active=!1,t})),this.bs=null}return t.prototype.cost=function(){return this.bs.cost()},t.prototype.setStartingPositions=function(t){this.inactive=this.cs.map((function(t){return t.active=!1,t})),this.bs=new r(this.vs),this.bs.forEach((function(i,s){return i.posn=t[s]}))},t.prototype.setDesiredPositions=function(t){this.vs.forEach((function(i,s){return i.desiredPosition=t[s]}))},t.prototype.mostViolated=function(){for(var i=Number.MAX_VALUE,s=null,e=this.inactive,n=e.length,o=n,r=0;r<n;++r){var h=e[r];if(!h.unsatisfiable){var a=h.slack();if((h.equality||a<i)&&(i=a,s=h,o=r,h.equality))break}}return o!==n&&(i<t.ZERO_UPPERBOUND&&!s.active||s.equality)&&(e[o]=e[n-1],e.length=n-1),s},t.prototype.satisfy=function(){null==this.bs&&(this.bs=new r(this.vs)),this.bs.split(this.inactive);for(var i=null;(i=this.mostViolated())&&(i.equality||i.slack()<t.ZERO_UPPERBOUND&&!i.active);){var s=i.left.block;if(s!==i.right.block)this.bs.merge(i);else{if(s.isActiveDirectedPathBetween(i.right,i.left)){i.unsatisfiable=!0;continue}var e=s.splitBetween(i.left,i.right);if(null===e){i.unsatisfiable=!0;continue}this.bs.insert(e.lb),this.bs.insert(e.rb),this.bs.remove(s),this.inactive.push(e.constraint),i.slack()>=0?this.inactive.push(i):this.bs.merge(i)}}},t.prototype.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,i=this.bs.cost();Math.abs(t-i)>1e-4;)this.satisfy(),t=i,i=this.bs.cost();return i},t.LAGRANGIAN_TOLERANCE=-1e-4,t.ZERO_UPPERBOUND=-1e-10,t}();i.Solver=h,i.removeOverlapInOneDimension=function(t,i,s){for(var o=t.map((function(t){return new n(t.desiredCenter)})),r=[],a=t.length,l=0;l<a-1;l++){var u=t[l],c=t[l+1];r.push(new e(o[l],o[l+1],(u.size+c.size)/2))}var f=o[0],p=o[a-1],v=t[0].size/2,g=t[a-1].size/2,d=null,b=null;return i&&(d=new n(i,1e3*f.weight),o.push(d),r.push(new e(d,f,v))),s&&(b=new n(s,1e3*p.weight),o.push(b),r.push(new e(p,b,g))),new h(o,r).solve(),{newCenters:o.slice(0,t.length).map((function(t){return t.position()})),lowerBound:d?d.position():f.position()-v,upperBound:b?b.position():p.position()+g}}}}]);
//# sourceMappingURL=126.a26ef0fd.js.map